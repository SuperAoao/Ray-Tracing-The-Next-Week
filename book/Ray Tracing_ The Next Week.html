
<!-- saved from url=(0061)https://raytracing.github.io/books/RayTracingTheNextWeek.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=600, initial-scale=1"><style>body{max-width:680px;margin:auto;padding:20px;text-align:justify;line-height:140%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;color:#222;font-family:Palatino,Georgia,"Times New Roman",serif}</style><style>@media print{*{-webkit-print-color-adjust:exact;text-shadow:none !important}}body{counter-reset: h1 paragraph line item list-item}@page{margin:0;size:auto}#mdContextMenu{position:absolute;background:#383838;cursor:default;border:1px solid #999;color:#fff;padding:4px 0px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,"Helvetica Neue",sans-serif;font-size:85%;font-weight:600;border-radius:4px;box-shadow:0px 3px 10px rgba(0,0,0,35%)}#mdContextMenu div{padding:0px 20px}#mdContextMenu div:hover{background:#1659d1}.md code,.md pre{font-family:Menlo,Consolas,monospace;font-size:93%;text-align:left;line-height:140%}.md .mediumToc code,.md longToc code,.md .shortToc code,.md h1 code,.md h2 code,.md h3 code,.md h4 code,.md h5 code,.md h6 code{font-size:unset}.md div.title{font-size:26px;font-weight:800;line-height:120%;text-align:center}.md div.afterTitles{height:10px}.md div.subtitle{text-align:center}.md iframe.textinsert, .md object.textinsert,.md iframe:not(.markdeep){display:block;margin-top:10px;margin-bottom:10px;width:100%;height:75vh;border:1px solid #000;border-radius:4px;background:#f5f5f4}.md .image{display:inline-block}.md img{max-width:100%;page-break-inside:avoid}.md li{text-align:left;text-indent:0}.md pre.listing {width:100%;tab-size:4;-moz-tab-size:4;-o-tab-size:4;counter-reset:line;overflow-x:auto;resize:horizontal}.md pre.listing .linenumbers span.line:before{width:30px;margin-left:-28px;font-size:80%;text-align:right;counter-increment:line;content:counter(line);display:inline-block;padding-right:13px;margin-right:8px;color:#ccc}.md div.tilde{margin:20px 0 -10px;text-align:center}.md .imagecaption,.md .tablecaption,.md .listingcaption{display:inline-block;margin:7px 5px 12px;text-align:justify;font-style:italic}.md img.pixel{image-rendering:-moz-crisp-edges;image-rendering:pixelated}.md blockquote.fancyquote{margin:25px 0 25px;text-align:left;line-height:160%}.md blockquote.fancyquote::before{content:"“";color:#DDD;font-family:Times New Roman;font-size:45px;line-height:0;margin-right:6px;vertical-align:-0.3em}.md span.fancyquote{font-size:118%;color:#777;font-style:italic}.md span.fancyquote::after{content:"”";font-style:normal;color:#DDD;font-family:Times New Roman;font-size:45px;line-height:0;margin-left:6px;vertical-align:-0.3em}.md blockquote.fancyquote .author{width:100%;margin-top:10px;display:inline-block;text-align:right}.md small{font-size:60%}.md big{font-size:150%}.md div.title,contents,.md .tocHeader,.md h1,.md h2,.md h3,.md h4,.md h5,.md h6,.md .shortTOC,.md .mediumTOC,.nonumberh1,.nonumberh2,.nonumberh3,.nonumberh4,.nonumberh5,.nonumberh6{font-family:Verdana,Helvetica,Arial,sans-serif;margin:13.4px 0 13.4px;padding:15px 0 3px;border-top:none;clear:both}.md .tocTop {display:none}.md h1,.md h2,.md h3,.md h4,.md h5,.md h6,.md .nonumberh1,.md .nonumberh2,.md .nonumberh3,.md .nonumberh4,.md .nonumberh5,.md .nonumberh6{page-break-after:avoid;break-after:avoid}.md svg.diagram{display:block;font-family:Menlo,Consolas,monospace;font-size:93%;text-align:center;stroke-linecap:round;stroke-width:2px;page-break-inside:avoid;stroke:#000;fill:#000}.md svg.diagram .opendot{fill:#fff}.md svg.diagram .shadeddot{fill:#CCC}.md svg.diagram .dotteddot{stroke:#000;stroke-dasharray:4;fill:none}.md svg.diagram text{stroke:none}@media print{@page{margin:1in 5mm;transform: scale(150%)}}@media print{.md .pagebreak{page-break-after:always;visibility:hidden}}.md a{font-family:Georgia,Palatino,'Times New Roman'}.md h1,.md .tocHeader,.md .nonumberh1{border-bottom:3px solid;font-size:20px;font-weight:bold;}.md h1,.md .nonumberh1{counter-reset:h2 h3 h4 h5 h6}.md h2,.md .nonumberh2{counter-reset:h3 h4 h5 h6;border-bottom:2px solid #999;color:#555;font-weight:bold;font-size:18px;}.md h3,.md h4,.md h5,.md h6,.md .nonumberh3,.md .nonumberh4,.md .nonumberh5,.md .nonumberh6{font-family:Verdana,Helvetica,Arial,sans-serif;color:#555;font-size:16px;}.md h3{counter-reset:h4 h5 h6}.md h4{counter-reset:h5 h6}.md h5{counter-reset:h6}.md div.table{margin:16px 0 16px 0}.md table{border-collapse:collapse;line-height:140%;page-break-inside:avoid}.md table.table{margin:auto}.md table.calendar{width:100%;margin:auto;font-size:11px;font-family:Verdana,Helvetica,Arial,sans-serif}.md table.calendar th{font-size:16px}.md .today{background:#ECF8FA}.md .calendar .parenthesized{color:#999;font-style:italic}.md table.table th{color:#FFF;background-color:#AAA;border:1px solid #888;padding:8px 15px 8px 15px}.md table.table td{padding:5px 15px 5px 15px;border:1px solid #888}.md table.table tr:nth-child(even){background:#EEE}.md pre.tilde{border-top: 1px solid #CCC;border-bottom: 1px solid #CCC;padding: 5px 0 5px 20px;margin:0 0 0 0;background:#FCFCFC;page-break-inside:avoid}.md a.target{width:0px;height:0px;visibility:hidden;font-size:0px;display:inline-block}.md a:link, .md a:visited{color:#38A;text-decoration:none}.md a:link:hover{text-decoration:underline}.md dt{font-weight:700}.md dl>dd{margin-top:-8px; margin-bottom:8px}.md dl>table{margin:35px 0 30px}.md code{page-break-inside:avoid;} @media print{.md .listing code{white-space:pre-wrap}}.md .endnote{font-size:13px;line-height:15px;padding-left:10px;text-indent:-10px}.md .bib{padding-left:80px;text-indent:-80px;text-align:left}.markdeepFooter{font-size:9px;text-align:right;padding-top:80px;color:#999}.md .mediumTOC{float:right;font-size:12px;line-height:15px;border-left:1px solid #CCC;padding-left:15px;margin:15px 0px 15px 25px}.md .mediumTOC .level1{font-weight:600}.md .longTOC .level1{font-weight:600;display:block;padding-top:12px;margin:0 0 -20px}.md .shortTOC{text-align:center;font-weight:bold;margin-top:15px;font-size:14px}.md .admonition{position:relative;margin:1em 0;padding:.4rem 1rem;border-radius:.2rem;border-left:2.5rem solid rgba(68,138,255,.4);background-color:rgba(68,138,255,.15);}.md .admonition-title{font-weight:bold;border-bottom:solid 1px rgba(68,138,255,.4);padding-bottom:4px;margin-bottom:4px;margin-left: -1rem;padding-left:1rem;margin-right:-1rem;border-color:rgba(68,138,255,.4)}.md .admonition.tip{border-left:2.5rem solid rgba(50,255,90,.4);background-color:rgba(50,255,90,.15)}.md .admonition.tip::before{content:"\24d8";font-weight:bold;font-size:150%;position:relative;top:3px;color:rgba(26,128,46,.8);left:-2.95rem;display:block;width:0;height:0}.md .admonition.tip>.admonition-title{border-color:rgba(50,255,90,.4)}.md .admonition.warn,.md .admonition.warning{border-left:2.5rem solid rgba(255,145,0,.4);background-color:rgba(255,145,0,.15)}.md .admonition.warn::before,.md .admonition.warning::before{content:"\26A0";font-weight:bold;font-size:150%;position:relative;top:2px;color:rgba(128,73,0,.8);left:-2.95rem;display:block;width:0;height:0}.md .admonition.warn>.admonition-title,.md .admonition.warning>.admonition-title{border-color:rgba(255,145,0,.4)}.md .admonition.error{border-left: 2.5rem solid rgba(255,23,68,.4);background-color:rgba(255,23,68,.15)}.md .admonition.error>.admonition-title{border-color:rgba(255,23,68,.4)}.md .admonition.error::before{content: "\2612";font-family:"Arial";font-size:200%;position:relative;color:rgba(128,12,34,.8);top:-2px;left:-3rem;display:block;width:0;height:0}.md .admonition p:last-child{margin-bottom:0}.md li.checked,.md li.unchecked{list-style:none;overflow:visible;text-indent:-1.2em}.md li.checked:before,.md li.unchecked:before{content:"\2611";display:block;float:left;width:1em;font-size:120%}.md li.unchecked:before{content:"\2610"}</style><style>.md h1::before {
content:counter(h1) " ";
counter-increment: h1;margin-right:10px}

.md h2::before {
content:counter(h1) "."counter(h2) " ";
counter-increment: h2;margin-right:10px}

.md h3::before {
content:counter(h1) "."counter(h2) "."counter(h3) " ";
counter-increment: h3;margin-right:10px}

.md h4::before {
content:counter(h1) "."counter(h2) "."counter(h3) "."counter(h4) " ";
counter-increment: h4;margin-right:10px}

.md h5::before {
content:counter(h1) "."counter(h2) "."counter(h3) "."counter(h4) "."counter(h5) " ";
counter-increment: h5;margin-right:10px}

.md h6::before {
content:counter(h1) "."counter(h2) "."counter(h3) "."counter(h4) "."counter(h5) "."counter(h6) " ";
counter-increment: h6;margin-right:10px}

</style><style>.hljs{display:block;overflow-x:auto;padding:0.5em;background:#fff;color:#000;-webkit-text-size-adjust:none}.hljs-comment{color:#006a00}.hljs-keyword{color:#02E}.hljs-literal,.nginx .hljs-title{color:#aa0d91}.method,.hljs-list .hljs-title,.hljs-tag .hljs-title,.setting .hljs-value,.hljs-winutils,.tex .hljs-command,.http .hljs-title,.hljs-request,.hljs-status,.hljs-name{color:#008}.hljs-envvar,.tex .hljs-special{color:#660}.hljs-string{color:#c41a16}.hljs-tag .hljs-value,.hljs-cdata,.hljs-filter .hljs-argument,.hljs-attr_selector,.apache .hljs-cbracket,.hljs-date,.hljs-regexp{color:#080}.hljs-sub .hljs-identifier,.hljs-pi,.hljs-tag,.hljs-tag .hljs-keyword,.hljs-decorator,.ini .hljs-title,.hljs-shebang,.hljs-prompt,.hljs-hexcolor,.hljs-rule .hljs-value,.hljs-symbol,.hljs-symbol .hljs-string,.hljs-number,.css .hljs-function,.hljs-function .hljs-title,.coffeescript .hljs-attribute{color:#A0C}.hljs-function .hljs-title{font-weight:bold;color:#000}.hljs-class .hljs-title,.smalltalk .hljs-class,.hljs-type,.hljs-typename,.hljs-tag .hljs-attribute,.hljs-doctype,.hljs-class .hljs-id,.hljs-built_in,.setting,.hljs-params,.clojure .hljs-attribute{color:#5c2699}.hljs-variable{color:#3f6e74}.css .hljs-tag,.hljs-rule .hljs-property,.hljs-pseudo,.hljs-subst{color:#000}.css .hljs-class,.css .hljs-id{color:#9b703f}.hljs-value .hljs-important{color:#ff7700;font-weight:bold}.hljs-rule .hljs-keyword{color:#c5af75}.hljs-annotation,.apache .hljs-sqbracket,.nginx .hljs-built_in{color:#9b859d}.hljs-preprocessor,.hljs-preprocessor *,.hljs-pragma{color:#643820}.tex .hljs-formula{background-color:#eee;font-style:italic}.diff .hljs-header,.hljs-chunk{color:#808080;font-weight:bold}.diff .hljs-change{background-color:#bccff9}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-comment .hljs-doctag{font-weight:bold}.method .hljs-id{color:#000}</style><style>div.title { padding-top: 40px; } div.afterTitles { height: 15px; }</style>
<link rel="icon" type="image/png" href="https://raytracing.github.io/favicon.png">
<!-- Markdeep: https://casual-effects.com/markdeep/ -->



                                   <style type="text/css" id="tts-styles">[data-tts-block-id].tts-active {background: rgba(206, 225, 255, 0.9) !important;} [data-tts-sentence-id].tts-active {background: rgba(0, 89, 191, 0.7) !important;}</style><script type="text/javascript" src="./Ray Tracing_ The Next Week_files/MathJax.js.下载"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none; box-sizing: content-box}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_test {font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.MathJax_test.mjx-test-display {display: table!important}
.MathJax_test.mjx-test-inline {display: inline!important; margin-right: -1px}
.MathJax_test.mjx-test-default {display: block!important; clear: both}
.MathJax_ex_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60ex}
.MathJax_em_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60em}
.mjx-test-inline .MathJax_left_box {display: inline-block; width: 0; float: left}
.mjx-test-inline .MathJax_right_box {display: inline-block; width: 0; float: right}
.mjx-test-display .MathJax_right_box {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.6') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">@font-face {font-family: MathJax_AMS; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf?V=2.7.6') format('opentype')}
</style><style>/* Copyright (C) Microsoft Corporation. All rights reserved. */

.msreadout-word-highlight:not(.msreadout-inactive-highlight) {
    background: #ffff00 !important;
    color: black !important;
}

.msreadout-line-highlight:not(.msreadout-inactive-highlight) {
    background: #b2d6f3 !important;
    color: black !important;
}

@media screen and (-ms-high-contrast: active) {
    .msreadout-word-highlight:not(.msreadout-inactive-highlight) {
        -ms-high-contrast-adjust: none;
        background-color: Highlight !important;
        color: HighlightText !important;
    }

    .msreadout-line-highlight:not(.msreadout-inactive-highlight) {
        -ms-high-contrast-adjust: none;
        background: yellow !important;
        color: black !important;
    }
}
/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uLy4uLy4uL2Nzcy9yZWFkX291dF9sb3VkX3dlYi5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOERBQThEOztBQUU5RDtJQUNJLDhCQUE4QjtJQUM5Qix1QkFBdUI7QUFDM0I7O0FBRUE7SUFDSSw4QkFBOEI7SUFDOUIsdUJBQXVCO0FBQzNCOztBQUVBO0lBQ0k7UUFDSSw4QkFBOEI7UUFDOUIsc0NBQXNDO1FBQ3RDLCtCQUErQjtJQUNuQzs7SUFFQTtRQUNJLDhCQUE4QjtRQUM5Qiw2QkFBNkI7UUFDN0IsdUJBQXVCO0lBQzNCO0FBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBDb3B5cmlnaHQgKEMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gKi9cclxuXHJcbi5tc3JlYWRvdXQtd29yZC1oaWdobGlnaHQ6bm90KC5tc3JlYWRvdXQtaW5hY3RpdmUtaGlnaGxpZ2h0KSB7XHJcbiAgICBiYWNrZ3JvdW5kOiAjZmZmZjAwICFpbXBvcnRhbnQ7XHJcbiAgICBjb2xvcjogYmxhY2sgIWltcG9ydGFudDtcclxufVxyXG5cclxuLm1zcmVhZG91dC1saW5lLWhpZ2hsaWdodDpub3QoLm1zcmVhZG91dC1pbmFjdGl2ZS1oaWdobGlnaHQpIHtcclxuICAgIGJhY2tncm91bmQ6ICNiMmQ2ZjMgIWltcG9ydGFudDtcclxuICAgIGNvbG9yOiBibGFjayAhaW1wb3J0YW50O1xyXG59XHJcblxyXG5AbWVkaWEgc2NyZWVuIGFuZCAoLW1zLWhpZ2gtY29udHJhc3Q6IGFjdGl2ZSkge1xyXG4gICAgLm1zcmVhZG91dC13b3JkLWhpZ2hsaWdodDpub3QoLm1zcmVhZG91dC1pbmFjdGl2ZS1oaWdobGlnaHQpIHtcclxuICAgICAgICAtbXMtaGlnaC1jb250cmFzdC1hZGp1c3Q6IG5vbmU7XHJcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogSGlnaGxpZ2h0ICFpbXBvcnRhbnQ7XHJcbiAgICAgICAgY29sb3I6IEhpZ2hsaWdodFRleHQgIWltcG9ydGFudDtcclxuICAgIH1cclxuXHJcbiAgICAubXNyZWFkb3V0LWxpbmUtaGlnaGxpZ2h0Om5vdCgubXNyZWFkb3V0LWluYWN0aXZlLWhpZ2hsaWdodCkge1xyXG4gICAgICAgIC1tcy1oaWdoLWNvbnRyYXN0LWFkanVzdDogbm9uZTtcclxuICAgICAgICBiYWNrZ3JvdW5kOiB5ZWxsb3cgIWltcG9ydGFudDtcclxuICAgICAgICBjb2xvcjogYmxhY2sgIWltcG9ydGFudDtcclxuICAgIH1cclxufSJdLCJzb3VyY2VSb290IjoiIn0= */</style></head><body style="visibility: visible;" id="md" class="scrolled"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"><br></div></div><div id="MathJax_Message" style="display: none;"></div><script type="text/x-mathjax-config;executed=true">MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });</script><span style="display:none"><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot; /&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 0em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(3.853em, 1000em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mrow" id="MathJax-Span-2"></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.128em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-1">\newcommand{\n}{\hat{n}}\newcommand{\thetai}{\theta_\mathrm{i}}\newcommand{\thetao}{\theta_\mathrm{o}}\newcommand{\d}[1]{\mathrm{d}#1}\newcommand{\w}{\hat{\omega}}\newcommand{\wi}{\w_\mathrm{i}}\newcommand{\wo}{\w_\mathrm{o}}\newcommand{\wh}{\w_\mathrm{h}}\newcommand{\Li}{L_\mathrm{i}}\newcommand{\Lo}{L_\mathrm{o}}\newcommand{\Le}{L_\mathrm{e}}\newcommand{\Lr}{L_\mathrm{r}}\newcommand{\Lt}{L_\mathrm{t}}\newcommand{\O}{\mathrm{O}}\newcommand{\degrees}{{^{\large\circ}}}\newcommand{\T}{\mathsf{T}}\newcommand{\mathset}[1]{\mathbb{#1}}\newcommand{\Real}{\mathset{R}}\newcommand{\Integer}{\mathset{Z}}\newcommand{\Boolean}{\mathset{B}}\newcommand{\Complex}{\mathset{C}}\newcommand{\un}[1]{\,\mathrm{#1}}</script>
</span>
<span class="md"><p><title>Ray Tracing: The Next Week</title></p><div class="title"> Ray Tracing: The Next Week </div>

<div class="subtitle"> <a href="https://github.com/petershirley">Peter Shirley</a>, <a href="https://github.com/trevordblack">Trevor David Black</a>, <a href="https://github.com/hollasch">Steve Hollasch</a> </div>
<div class="subtitle"> <br> </div>
<div class="subtitle"> Version 4.0.0-alpha.1, 2023-08-06 </div>
<div class="subtitle"> <br> </div>
<div class="subtitle"> Copyright 2018-2023 Peter Shirley. All rights reserved. </div>
<div class="afterTitles"></div>

<p></p>
<div class="longTOC"><div class="tocHeader">Contents</div><p><a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#" class="tocTop">(Top)</a><br>
<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#overview" class="level1"><span class="tocNumber">1&nbsp; </span>Overview</a><br>
<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#motionblur" class="level1"><span class="tocNumber">2&nbsp; </span>Motion Blur</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#motionblur/introductionofspacetimeraytracing" class="level2"><span class="tocNumber">2.1&nbsp; </span>Introduction of SpaceTime Ray Tracing</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#motionblur/managingtime" class="level2"><span class="tocNumber">2.2&nbsp; </span>Managing Time</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#motionblur/updatingthecameratosimulatemotionblur" class="level2"><span class="tocNumber">2.3&nbsp; </span>Updating the Camera to Simulate Motion Blur</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#motionblur/addingmovingspheres" class="level2"><span class="tocNumber">2.4&nbsp; </span>Adding Moving Spheres</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#motionblur/trackingthetimeofrayintersection" class="level2"><span class="tocNumber">2.5&nbsp; </span>Tracking the Time of Ray Intersection</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#motionblur/puttingeverythingtogether" class="level2"><span class="tocNumber">2.6&nbsp; </span>Putting Everything Together</a><br>
<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#boundingvolumehierarchies" class="level1"><span class="tocNumber">3&nbsp; </span>Bounding Volume Hierarchies</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#boundingvolumehierarchies/thekeyidea" class="level2"><span class="tocNumber">3.1&nbsp; </span>The Key Idea</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#boundingvolumehierarchies/hierarchiesofboundingvolumes" class="level2"><span class="tocNumber">3.2&nbsp; </span>Hierarchies of Bounding Volumes</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#boundingvolumehierarchies/axis-alignedboundingboxes(aabbs)" class="level2"><span class="tocNumber">3.3&nbsp; </span>Axis-Aligned Bounding Boxes (AABBs)</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#boundingvolumehierarchies/rayintersectionwithanaabb" class="level2"><span class="tocNumber">3.4&nbsp; </span>Ray Intersection with an AABB</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#boundingvolumehierarchies/anoptimizedaabbhitmethod" class="level2"><span class="tocNumber">3.5&nbsp; </span>An Optimized AABB Hit Method</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#boundingvolumehierarchies/constructingboundingboxesforhittables" class="level2"><span class="tocNumber">3.6&nbsp; </span>Constructing Bounding Boxes for Hittables</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#boundingvolumehierarchies/creatingboundingboxesoflistsofobjects" class="level2"><span class="tocNumber">3.7&nbsp; </span>Creating Bounding Boxes of Lists of Objects</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#boundingvolumehierarchies/thebvhnodeclass" class="level2"><span class="tocNumber">3.8&nbsp; </span>The BVH Node Class</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#boundingvolumehierarchies/splittingbvhvolumes" class="level2"><span class="tocNumber">3.9&nbsp; </span>Splitting BVH Volumes</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#boundingvolumehierarchies/theboxcomparisonfunctions" class="level2"><span class="tocNumber">3.10&nbsp; </span>The Box Comparison Functions</a><br>
<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#texturemapping" class="level1"><span class="tocNumber">4&nbsp; </span>Texture Mapping</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#texturemapping/constantcolortexture" class="level2"><span class="tocNumber">4.1&nbsp; </span>Constant Color Texture</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#texturemapping/solidtextures:acheckertexture" class="level2"><span class="tocNumber">4.2&nbsp; </span>Solid Textures: A Checker Texture</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#texturemapping/renderingthesolidcheckertexture" class="level2"><span class="tocNumber">4.3&nbsp; </span>Rendering The Solid Checker Texture</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#texturemapping/texturecoordinatesforspheres" class="level2"><span class="tocNumber">4.4&nbsp; </span>Texture Coordinates for Spheres</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#texturemapping/accessingtextureimagedata" class="level2"><span class="tocNumber">4.5&nbsp; </span>Accessing Texture Image Data</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#texturemapping/renderingtheimagetexture" class="level2"><span class="tocNumber">4.6&nbsp; </span>Rendering The Image Texture</a><br>
<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#perlinnoise" class="level1"><span class="tocNumber">5&nbsp; </span>Perlin Noise</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#perlinnoise/usingblocksofrandomnumbers" class="level2"><span class="tocNumber">5.1&nbsp; </span>Using Blocks of Random Numbers</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#perlinnoise/smoothingouttheresult" class="level2"><span class="tocNumber">5.2&nbsp; </span>Smoothing out the Result</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#perlinnoise/improvementwithhermitiansmoothing" class="level2"><span class="tocNumber">5.3&nbsp; </span>Improvement with Hermitian Smoothing</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#perlinnoise/tweakingthefrequency" class="level2"><span class="tocNumber">5.4&nbsp; </span>Tweaking The Frequency</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#perlinnoise/usingrandomvectorsonthelatticepoints" class="level2"><span class="tocNumber">5.5&nbsp; </span>Using Random Vectors on the Lattice Points</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#perlinnoise/introducingturbulence" class="level2"><span class="tocNumber">5.6&nbsp; </span>Introducing Turbulence</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#perlinnoise/adjustingthephase" class="level2"><span class="tocNumber">5.7&nbsp; </span>Adjusting the Phase</a><br>
<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#quadrilaterals" class="level1"><span class="tocNumber">6&nbsp; </span>Quadrilaterals</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#quadrilaterals/definingthequadrilateral" class="level2"><span class="tocNumber">6.1&nbsp; </span>Defining the Quadrilateral</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#quadrilaterals/ray-planeintersection" class="level2"><span class="tocNumber">6.2&nbsp; </span>Ray-Plane Intersection</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#quadrilaterals/findingtheplanethatcontainsagivenquadrilateral" class="level2"><span class="tocNumber">6.3&nbsp; </span>Finding the Plane That Contains a Given Quadrilateral</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#quadrilaterals/orientingpointsontheplane" class="level2"><span class="tocNumber">6.4&nbsp; </span>Orienting Points on The Plane</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#quadrilaterals/interiortestingoftheintersectionusinguvcoordinates" class="level2"><span class="tocNumber">6.5&nbsp; </span>Interior Testing of The Intersection Using UV Coordinates</a><br>
<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#lights" class="level1"><span class="tocNumber">7&nbsp; </span>Lights</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#lights/emissivematerials" class="level2"><span class="tocNumber">7.1&nbsp; </span>Emissive Materials</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#lights/addingbackgroundcolortotheraycolorfunction" class="level2"><span class="tocNumber">7.2&nbsp; </span>Adding Background Color to the Ray Color Function</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#lights/turningobjectsintolights" class="level2"><span class="tocNumber">7.3&nbsp; </span>Turning Objects into Lights</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#lights/creatinganempty%E2%80%9Ccornellbox%E2%80%9D" class="level2"><span class="tocNumber">7.4&nbsp; </span>Creating an Empty “Cornell Box”</a><br>
<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#instances" class="level1"><span class="tocNumber">8&nbsp; </span>Instances</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#instances/instancetranslation" class="level2"><span class="tocNumber">8.1&nbsp; </span>Instance Translation</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#instances/instancerotation" class="level2"><span class="tocNumber">8.2&nbsp; </span>Instance Rotation</a><br>
<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#volumes" class="level1"><span class="tocNumber">9&nbsp; </span>Volumes</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#volumes/constantdensitymediums" class="level2"><span class="tocNumber">9.1&nbsp; </span>Constant Density Mediums</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#volumes/renderingacornellboxwithsmokeandfogboxes" class="level2"><span class="tocNumber">9.2&nbsp; </span>Rendering a Cornell Box with Smoke and Fog Boxes</a><br>
<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#ascenetestingallnewfeatures" class="level1"><span class="tocNumber">10&nbsp; </span>A Scene Testing All New Features</a><br>
<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#acknowledgments" class="level1"><span class="tocNumber">11&nbsp; </span>Acknowledgments</a><br>
<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#citingthisbook" class="level1"><span class="tocNumber">12&nbsp; </span>Citing This Book</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#citingthisbook/basicdata" class="level2"><span class="tocNumber">12.1&nbsp; </span>Basic Data</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#citingthisbook/snippets" class="level2"><span class="tocNumber">12.2&nbsp; </span>Snippets</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#citingthisbook/snippets/markdown" class="level3"><span class="tocNumber">12.2.1&nbsp; </span>Markdown</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#citingthisbook/snippets/html" class="level3"><span class="tocNumber">12.2.2&nbsp; </span>HTML</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#citingthisbook/snippets/latexandbibtex" class="level3"><span class="tocNumber">12.2.3&nbsp; </span>LaTeX and BibTex</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#citingthisbook/snippets/biblatex" class="level3"><span class="tocNumber">12.2.4&nbsp; </span>BibLaTeX</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#citingthisbook/snippets/ieee" class="level3"><span class="tocNumber">12.2.5&nbsp; </span>IEEE</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#citingthisbook/snippets/mla:" class="level3"><span class="tocNumber">12.2.6&nbsp; </span>MLA:</a><br>
</p></div><a class="target" name="overview">&nbsp;</a><a class="target" name="overview">&nbsp;</a><a class="target" name="toc1">&nbsp;</a><h1>Overview</h1>
<p>

In Ray Tracing in One Weekend, you built a simple brute force path tracer. In this installment we’ll
add textures, volumes (like fog), rectangles, instances, lights, and<msreadoutspan class="msreadout-line-highlight msreadout-inactive-highlight"> support for lots of objects
using a <msreadoutspan class="msreadout-word-highlight">BVH</msreadoutspan>. When done, you’ll have a “real” ray tracer.

</msreadoutspan></p><p>

A heuristic in ray tracing that many people—including me—believe, is that most optimizations
complicate the code without delivering much speedup. What I will do in this mini-book is go with the
simplest approach in each design decision I make. Check <a href="https://in1weekend.blogspot.com/" class="url">https://in1weekend.blogspot.com/</a> for
readings and references to a more sophisticated approach. However, I strongly encourage you to do no
premature optimization; if it doesn’t show up high in the execution time profile, it doesn’t need
optimization until all the features are supported!

</p><p>

The two hardest parts of this book are the BVH and the Perlin textures. This is why the title
suggests you take a week rather than a weekend for this endeavor. But you can save those for last if
you want a weekend project. Order is not very important for the concepts presented in this book, and
without BVH and Perlin texture you will still get a Cornell Box!

</p><p>

Thanks to everyone who lent a hand on this project. You can find them in the <a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#acknowledgments">acknowledgments</a> section
at the end of this book.

</p>
<a class="target" name="motionblur">&nbsp;</a><a class="target" name="motionblur">&nbsp;</a><a class="target" name="toc2">&nbsp;</a><h1>Motion Blur</h1>
<p>

When you decided to ray trace, you decided that visual quality was worth more than run-time. When
rendering fuzzy reflection and defocus blur, we used multiple samples per pixel. Once you have taken
a step down that road, the good news is that almost <em class="underscore">all</em> effects can be similarly brute-forced.
Motion blur is certainly one of those.

</p><p>

In a real camera, the shutter remains open for a short time interval, during which the camera and
objects in the world may move. To accurately reproduce such a camera shot, we seek an average of
what the camera senses while its shutter is open to the world.

</p>
<a class="target" name="introductionofspacetimeraytracing">&nbsp;</a><a class="target" name="motionblur/introductionofspacetimeraytracing">&nbsp;</a><a class="target" name="toc2.1">&nbsp;</a><h2>Introduction of SpaceTime Ray Tracing</h2>
<p>

We can get a random estimate of a single (simplified) photon by sending a single ray at some random
instant in time while the shutter is open. As long as we can determine where the objects are
supposed to be at that instant, we can get an accurate measure of the light for that ray at that
same instant. This is yet another example of how random (Monte Carlo) ray tracing ends up being
quite simple. Brute force wins again!

</p><p>

</p><div class="together">
Since the “engine” of the ray tracer can just make sure the objects are where they need to be for
each ray, the intersection guts don’t change much. To accomplish this, we need to store the exact
time for each ray:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">ray</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">ray</span>() {}
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-built_in">ray</span>(<span class="hljs-type">const</span> point3&amp; origin, <span class="hljs-type">const</span> vec3&amp; direction) : <span class="hljs-built_in">orig</span>(origin), <span class="hljs-built_in">dir</span>(direction), <span class="hljs-built_in">tm</span>(<span class="hljs-number">0</span>)
<span class="line"></span>    {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">ray</span>(<span class="hljs-type">const</span> point3&amp; origin, <span class="hljs-type">const</span> vec3&amp; direction, <span class="hljs-type">double</span> time = <span class="hljs-number">0.0</span>)
<span class="line"></span>      : <span class="hljs-built_in">orig</span>(origin), <span class="hljs-built_in">dir</span>(direction), <span class="hljs-built_in">tm</span>(time)
<span class="line"></span>    {}</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function">point3 <span class="hljs-title">origin</span><span class="hljs-params">()</span> <span class="hljs-type">const</span>  </span>{ <span class="hljs-keyword">return</span> orig; }
<span class="line"></span>    <span class="hljs-function">vec3 <span class="hljs-title">direction</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> dir; }<div class=" highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">time</span><span class="hljs-params">()</span> <span class="hljs-type">const</span>    </span>{ <span class="hljs-keyword">return</span> tm; }</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function">point3 <span class="hljs-title">at</span><span class="hljs-params">(<span class="hljs-type">double</span> t)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> orig + t*dir;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    point3 orig;
<span class="line"></span>    vec3 dir;<div class=" highlight"><span class="line"></span>    <span class="hljs-type">double</span> tm;</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_time-ray">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;1:</b> <kbd>[ray.h]</kbd> Ray with time information</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="managingtime">&nbsp;</a><a class="target" name="motionblur/managingtime">&nbsp;</a><a class="target" name="toc2.2">&nbsp;</a><h2>Managing Time</h2>
<p>

Before continuing, let's think about time, and how we might manage it across one or more successive
renders. There are two aspects of shutter timing to think about: the time from one shutter opening
to the next shutter opening, and how long the shutter stays open for each frame. Standard movie film
used to be shot at 24 frames per second. Modern digital movies can be 24, 30, 48, 60, 120 or however
many frames per second director wants.

</p><p>

Each frame can have its own shutter speed. This shutter speed need not be — and typically isn't —
the maximum duration of the entire frame. You could have the shutter open for 1/1000th of a second
every frame, or 1/60th of a second.

</p><p>

If you wanted to render a sequence of images, you would need to set up the camera with the
appropriate shutter timings: frame-to-frame period, shutter/render duration, and the total number of
frames (total shot time). If the camera is moving and the world is static, you're good to go.
However, if anything in the world is moving, you would need to add a method to <code>hittable</code> so that
every object could be made aware of the current frame's time period. This method would provide a way
for all animated objects to set up their motion during that frame.

</p><p>

This is fairly straight-forward, and definitely a fun avenue for you to experiment with if you wish.
However, for our purposes right now, we're going to proceed with a much simpler model. We will
render only a single frame, implicitly assuming a start at time = 0 and ending at time = 1. Our
first task is to modify the camera to launch rays with random times in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-3" style="width: 2.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.002em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1001.9em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-4"><span class="mo" id="MathJax-Span-5" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-6" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-7" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-8" style="font-family: MathJax_Main; padding-left: 0.152em;">1</span><span class="mo" id="MathJax-Span-9" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-2">[0,1]</script>, and our second task
will be the creation of an animated sphere class.

</p>
<a class="target" name="updatingthecameratosimulatemotionblur">&nbsp;</a><a class="target" name="motionblur/updatingthecameratosimulatemotionblur">&nbsp;</a><a class="target" name="toc2.3">&nbsp;</a><h2>Updating the Camera to Simulate Motion Blur</h2>
<p>

We need to modify the camera to generate rays at a random instant between the start time and the end
time. Should the camera keep track of the time interval, or should that be up to the user of the
camera when a ray is created? When in doubt, I like to make constructors complicated if it makes
calls simple, so I will make the camera keep track, but that’s a personal preference. Not many
changes are needed to camera because for now it is not allowed to move; it just sends out rays over
a time period.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  ...
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function">ray <span class="hljs-title">get_ray</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Get a randomly-sampled camera ray for the pixel at location i,j, originating from</span>
<span class="line"></span>        <span class="hljs-comment">// the camera defocus disk.</span>
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> pixel_center = pixel00_loc + (i * pixel_delta_u) + (j * pixel_delta_v);
<span class="line"></span>        <span class="hljs-keyword">auto</span> pixel_sample = pixel_center + <span class="hljs-built_in">pixel_sample_square</span>();
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> ray_origin = (defocus_angle &lt;= <span class="hljs-number">0</span>) ? center : <span class="hljs-built_in">defocus_disk_sample</span>();
<span class="line"></span>        <span class="hljs-keyword">auto</span> ray_direction = pixel_sample - ray_origin;<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> ray_time = <span class="hljs-built_in">random_double</span>();
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">ray</span>(ray_origin, ray_direction, ray_time);</div><span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_time-camera">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;2:</b> <kbd>[camera.h]</kbd> Camera with time information</div></center>

<a class="target" name="addingmovingspheres">&nbsp;</a><a class="target" name="motionblur/addingmovingspheres">&nbsp;</a><a class="target" name="toc2.4">&nbsp;</a><h2>Adding Moving Spheres</h2>
<p>

Now to create a moving object.
I’ll update the sphere class so that its center moves linearly from <code>center1</code> at time=0 to <code>center2</code>
at time=1.
(It continues on indefinitely outside that time interval, so it really can be sampled at any time.)

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">sphere</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:<div class=" highlight"><span class="line"></span>    <span class="hljs-comment">// Stationary Sphere</span>
<span class="line"></span>    <span class="hljs-built_in">sphere</span>(point3 _center, <span class="hljs-type">double</span> _radius, shared_ptr&lt;material&gt; _material)
<span class="line"></span>      : <span class="hljs-built_in">center1</span>(_center), <span class="hljs-built_in">radius</span>(_radius), <span class="hljs-built_in">mat</span>(_material), <span class="hljs-built_in">is_moving</span>(<span class="hljs-literal">false</span>) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Moving Sphere</span>
<span class="line"></span>    <span class="hljs-built_in">sphere</span>(point3 _center1, point3 _center2, <span class="hljs-type">double</span> _radius, shared_ptr&lt;material&gt; _material)
<span class="line"></span>      : <span class="hljs-built_in">center1</span>(_center1), <span class="hljs-built_in">radius</span>(_radius), <span class="hljs-built_in">mat</span>(_material), <span class="hljs-built_in">is_moving</span>(<span class="hljs-literal">true</span>)
<span class="line"></span>    {
<span class="line"></span>        center_vec = _center2 - _center1;
<span class="line"></span>    }</div><span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:<div class=" highlight"><span class="line"></span>    point3 center1;</div><span class="line"></span>    <span class="hljs-type">double</span> radius;
<span class="line"></span>    shared_ptr&lt;material&gt; mat;<div class=" highlight"><span class="line"></span>    <span class="hljs-type">bool</span> is_moving;
<span class="line"></span>    vec3 center_vec;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">point3 <span class="hljs-title">center</span><span class="hljs-params">(<span class="hljs-type">double</span> time)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Linearly interpolate from center1 to center2 according to time, where t=0 yields</span>
<span class="line"></span>        <span class="hljs-comment">// center1, and t=1 yields center2.</span>
<span class="line"></span>        <span class="hljs-keyword">return</span> center0 + time*center_vec;
<span class="line"></span>    }</div><span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_moving-sphere">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;3:</b> <kbd>[sphere.h]</kbd> A moving sphere</div></center>
<p>


An alternative to making special stationary spheres is to just make them all move, but stationary
spheres have the same begin and end position. I’m on the fence about that trade-off between simpler
code and more efficient stationary spheres, so let your design taste guide you.

</p><p>

</p><div class="together">
The updated <code>sphere::hit()</code> function is almost identical to the old <code>sphere::hit()</code> function:
<code>center</code> just needs to query a function <code>sphere_center(time)</code>:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">sphere</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{<div class=" highlight"><span class="line"></span>        point3 center = is_moving ? <span class="hljs-built_in">sphere_center</span>(r.<span class="hljs-built_in">time</span>()) : center1;</div><span class="line"></span>        vec3 oc = r.<span class="hljs-built_in">origin</span>() - center;
<span class="line"></span>        <span class="hljs-keyword">auto</span> a = r.<span class="hljs-built_in">direction</span>().<span class="hljs-built_in">length_squared</span>();
<span class="line"></span>        <span class="hljs-keyword">auto</span> half_b = <span class="hljs-built_in">dot</span>(oc, r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> c = oc.<span class="hljs-built_in">length_squared</span>() - radius*radius;
<span class="line"></span>        ...
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_moving-sphere-hit">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;4:</b> <kbd>[sphere.h]</kbd> Moving sphere hit function</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
We need to implement the new <code>interval::contains()</code> method mentioned above:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">interval</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">contains</span><span class="hljs-params">(<span class="hljs-type">double</span> x)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> min &lt;= x &amp;&amp; x &lt;= max;
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_interval-contains">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;5:</b> <kbd>interval.h</kbd> interval::contains() method</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="trackingthetimeofrayintersection">&nbsp;</a><a class="target" name="motionblur/trackingthetimeofrayintersection">&nbsp;</a><a class="target" name="toc2.5">&nbsp;</a><h2>Tracking the Time of Ray Intersection</h2>
<p>

Now that rays have a time property, we need to update the <code>material::scatter()</code> methods to account
for the time of intersection:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">lambertian</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">auto</span> scatter_direction = rec.normal + <span class="hljs-built_in">random_unit_vector</span>();
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Catch degenerate scatter direction</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (scatter_direction.<span class="hljs-built_in">near_zero</span>())
<span class="line"></span>            scatter_direction = rec.normal;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>        scattered = <span class="hljs-built_in">ray</span>(rec.p, scatter_direction, r_in.<span class="hljs-built_in">time</span>());</div><span class="line"></span>        attenuation = albedo;
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">metal</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        vec3 reflected = <span class="hljs-built_in">reflect</span>(<span class="hljs-built_in">unit_vector</span>(r_in.<span class="hljs-built_in">direction</span>()), rec.normal);<div class=" highlight"><span class="line"></span>        scattered = <span class="hljs-built_in">ray</span>(rec.p, reflected + fuzz*<span class="hljs-built_in">random_in_unit_sphere</span>(), r_in.<span class="hljs-built_in">time</span>());</div><span class="line"></span>        attenuation = albedo;
<span class="line"></span>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">dot</span>(scattered.<span class="hljs-built_in">direction</span>(), rec.normal) &gt; <span class="hljs-number">0</span>);
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">dielectric</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        ...<div class=" highlight"><span class="line"></span>        scattered = <span class="hljs-built_in">ray</span>(rec.p, direction, r_in.<span class="hljs-built_in">time</span>());</div><span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_material-time">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;6:</b> <kbd>[material.h]</kbd>
        Handle ray time in the material::scatter() methods
    </div></center>

<a class="target" name="puttingeverythingtogether">&nbsp;</a><a class="target" name="motionblur/puttingeverythingtogether">&nbsp;</a><a class="target" name="toc2.6">&nbsp;</a><h2>Putting Everything Together</h2>
<p>

The code below takes the example diffuse spheres from the scene at the end of the last book, and
makes them move during the image render. Each sphere moves from its center <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-10" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.8em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-11"><span class="texatom" id="MathJax-Span-12"><span class="mrow" id="MathJax-Span-13"><span class="mi" id="MathJax-Span-14" style="font-family: MathJax_Main-bold;">C</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3">\mathbf{C}</script> at time
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-15" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1002.2em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-16"><span class="mi" id="MathJax-Span-17" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-18" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-19" style="font-family: MathJax_Main; padding-left: 0.302em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-4">t=0</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-20" style="width: 7.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.103em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1006em, 2.603em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-21"><span class="texatom" id="MathJax-Span-22"><span class="mrow" id="MathJax-Span-23"><span class="mi" id="MathJax-Span-24" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-25" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mo" id="MathJax-Span-26" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="mn" id="MathJax-Span-27" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-28" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-29" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">r</span><span class="texatom" id="MathJax-Span-30"><span class="mrow" id="MathJax-Span-31"><span class="mo" id="MathJax-Span-32" style="font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-33" style="font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-34" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-35" style="font-family: MathJax_Main; padding-left: 0.152em;">0</span><span class="mo" id="MathJax-Span-36" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo>+</mo><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn><mo>,</mo><mn>0</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">\mathbf{C} + (0, r/2, 0)</script> at time <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-37" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1002.2em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-38"><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-40" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-41" style="font-family: MathJax_Main; padding-left: 0.302em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-6">t=1</script>:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> ground_material = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">-1000</span>,<span class="hljs-number">0</span>), <span class="hljs-number">1000</span>, ground_material));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> a = <span class="hljs-number">-11</span>; a &lt; <span class="hljs-number">11</span>; a++) {
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> b = <span class="hljs-number">-11</span>; b &lt; <span class="hljs-number">11</span>; b++) {
<span class="line"></span>            <span class="hljs-keyword">auto</span> choose_mat = <span class="hljs-built_in">random_double</span>();
<span class="line"></span>            <span class="hljs-function">point3 <span class="hljs-title">center</span><span class="hljs-params">(a + <span class="hljs-number">0.9</span>*random_double(), <span class="hljs-number">0.2</span>, b + <span class="hljs-number">0.9</span>*random_double())</span></span>;
<span class="line"></span>
<span class="line"></span>            <span class="hljs-keyword">if</span> ((center - <span class="hljs-built_in">point3</span>(<span class="hljs-number">4</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0</span>)).<span class="hljs-built_in">length</span>() &gt; <span class="hljs-number">0.9</span>) {
<span class="line"></span>                shared_ptr&lt;material&gt; sphere_material;
<span class="line"></span>
<span class="line"></span>                <span class="hljs-keyword">if</span> (choose_mat &lt; <span class="hljs-number">0.8</span>) {
<span class="line"></span>                    <span class="hljs-comment">// diffuse</span>
<span class="line"></span>                    <span class="hljs-keyword">auto</span> albedo = color::<span class="hljs-built_in">random</span>() * color::<span class="hljs-built_in">random</span>();
<span class="line"></span>                    sphere_material = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(albedo);<div class=" highlight"><span class="line"></span>                    <span class="hljs-keyword">auto</span> center2 = center + <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">random_double</span>(<span class="hljs-number">0</span>,<span class="hljs-number">.5</span>), <span class="hljs-number">0</span>);
<span class="line"></span>                    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(center, center2, <span class="hljs-number">0.2</span>, sphere_material));</div><span class="line"></span>                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (choose_mat &lt; <span class="hljs-number">0.95</span>) {
<span class="line"></span>                ...
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;<div class=" highlight"><span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;</div><span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>
<span class="line"></span>    cam.vfov     = <span class="hljs-number">20</span>;
<span class="line"></span>    cam.lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">13</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>);
<span class="line"></span>    cam.lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>    cam.vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.defocus_angle = <span class="hljs-number">0.02</span>;
<span class="line"></span>    cam.focus_dist    = <span class="hljs-number">10.0</span>;
<span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-spheres-moving">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;7:</b>
    <kbd>[main.cc]</kbd> Last book's final scene, but with moving spheres</div></center>
<p>


</p><div class="together">
This gives the following result:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.01-bouncing-spheres.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.01-bouncing-spheres.png"></a><center><span class="imagecaption"><span class="num">Image 1:</span> Bouncing spheres
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="boundingvolumehierarchies">&nbsp;</a><a class="target" name="boundingvolumehierarchies">&nbsp;</a><a class="target" name="toc3">&nbsp;</a><h1>Bounding Volume Hierarchies</h1>
<p>

This part is by far the most difficult and involved part of the ray tracer we are working on. I am
sticking it in this chapter so the code can run faster, and because it refactors <code>hittable</code> a
little, and when I add rectangles and boxes we won't have to go back and refactor them.

</p><p>

The ray-object intersection is the main time-bottleneck in a ray tracer, and the time is linear with
the number of objects. But it’s a repeated search on the same model, so we ought to be able to make
it a logarithmic search in the spirit of binary search. Because we are sending millions to billions
of rays on the same model, we can do an analog of sorting the model, and then each ray intersection
can be a sublinear search. The two most common families of sorting are to 1) divide the space, and
2) divide the objects. The latter is usually much easier to code up and just as fast to run for most
models.

</p>
<a class="target" name="thekeyidea">&nbsp;</a><a class="target" name="boundingvolumehierarchies/thekeyidea">&nbsp;</a><a class="target" name="toc3.1">&nbsp;</a><h2>The Key Idea</h2>
<p>

The key idea of a bounding volume over a set of primitives is to find a volume that fully encloses
(bounds) all the objects. For example, suppose you computed a sphere that bounds 10 objects. Any ray
that misses the bounding sphere definitely misses all ten objects inside. If the ray hits the
bounding sphere, then it might hit one of the ten objects. So the bounding code is always of the
form:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">if</span> (ray hits bounding <span class="hljs-keyword">object</span>)
<span class="line"></span>    <span class="hljs-keyword">return</span> whether ray hits bounded objects
<span class="line"></span><span class="hljs-keyword">else</span>
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></code></pre><p>

A key thing is we are dividing objects into subsets. We are not dividing the screen or the volume.
Any object is in just one bounding volume, but bounding volumes can overlap.

</p>
<a class="target" name="hierarchiesofboundingvolumes">&nbsp;</a><a class="target" name="boundingvolumehierarchies/hierarchiesofboundingvolumes">&nbsp;</a><a class="target" name="toc3.2">&nbsp;</a><h2>Hierarchies of Bounding Volumes</h2>
<p>

To make things sub-linear we need to make the bounding volumes hierarchical. For example, if we
divided a set of objects into two groups, red and blue, and used rectangular bounding volumes, we’d
have:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/fig-2.01-bvol-hierarchy.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing_ The Next Week_files/fig-2.01-bvol-hierarchy.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_bvol-hierarchy">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;1:</b> Bounding volume hierarchy</span></center></div></center>

<p></p><p>

</p><div class="together">
Note that the blue and red bounding volumes are contained in the purple one, but they might overlap,
and they are not ordered — they are just both inside. So the tree shown on the right has no concept
of ordering in the left and right children; they are simply inside. The code would be:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">if</span> (hits purple)
<span class="line"></span>    hit0 = hits blue enclosed <span class="hljs-type">objects</span>
<span class="line"></span>    <span class="hljs-variable">hit1</span> <span class="hljs-operator">=</span> hits red enclosed objects
<span class="line"></span>    <span class="hljs-title function_">if</span> <span class="hljs-params">(hit0 or hit1)</span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> and info of closer hit
<span class="line"></span><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></code></pre><p>

</p></div>

<p></p>
<a class="target" name="axis-alignedboundingboxes(aabbs)">&nbsp;</a><a class="target" name="boundingvolumehierarchies/axis-alignedboundingboxes(aabbs)">&nbsp;</a><a class="target" name="toc3.3">&nbsp;</a><h2>Axis-Aligned Bounding Boxes (AABBs)</h2>
<p>

To get that all to work we need a way to make good divisions, rather than bad ones, and a way to
intersect a ray with a bounding volume. A ray bounding volume intersection needs to be fast, and
bounding volumes need to be pretty compact. In practice for most models, axis-aligned boxes work
better than the alternatives, but this design choice is always something to keep in mind if you
encounter unusual types of models.

</p><p>

From now on we will call axis-aligned bounding rectangular parallelepiped (really, that is what they
need to be called if precise) <em class="underscore">axis-aligned bounding boxes</em>, or AABBs. Any method you want to use to
intersect a ray with an AABB is fine. And all we need to know is whether or not we hit it; we don’t
need hit points or normals or any of the stuff we need to display the object.

</p><p>

</p><div class="together">
Most people use the “slab” method. This is based on the observation that an n-dimensional AABB is
just the intersection of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-42" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.6em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-43"><span class="mi" id="MathJax-Span-44" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">n</script> axis-aligned intervals, often called “slabs”. An interval is just the
points between two endpoints, <em class="underscore">e.g.</em>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-45" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-46"><span class="mi" id="MathJax-Span-47" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">x</script> such that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-48" style="width: 5.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1004.3em, 2.353em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-49"><span class="mn" id="MathJax-Span-50" style="font-family: MathJax_Main;">3</span><span class="mo" id="MathJax-Span-51" style="font-family: MathJax_Main; padding-left: 0.302em;">&lt;</span><span class="mi" id="MathJax-Span-52" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">x</span><span class="mo" id="MathJax-Span-53" style="font-family: MathJax_Main; padding-left: 0.302em;">&lt;</span><span class="mn" id="MathJax-Span-54" style="font-family: MathJax_Main; padding-left: 0.302em;">5</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.122em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>3</mn><mo>&lt;</mo><mi>x</mi><mo>&lt;</mo><mn>5</mn></math></span></span><script type="math/tex" id="MathJax-Element-9">3 < x < 5</script>, or more succinctly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-55" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-56"><span class="mi" id="MathJax-Span-57" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-10">x</script> in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-58" style="width: 2.752em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.202em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.1em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-59"><span class="mo" id="MathJax-Span-60" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-61" style="font-family: MathJax_Main;">3</span><span class="mo" id="MathJax-Span-62" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-63" style="font-family: MathJax_Main; padding-left: 0.152em;">5</span><span class="mo" id="MathJax-Span-64" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>3</mn><mo>,</mo><mn>5</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-11">(3,5)</script>.
In 2D, two intervals overlapping makes a 2D AABB (a rectangle):

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/fig-2.02-2d-aabb.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing_ The Next Week_files/fig-2.02-2d-aabb.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_2d-aabb">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;2:</b> 2D axis-aligned bounding box</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

For a ray to hit one interval we first need to figure out whether the ray hits the boundaries. For
example, again in 2D, this is the ray parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-65" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.202em, 1000.8em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-66"><span class="msubsup" id="MathJax-Span-67"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-68" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="mn" id="MathJax-Span-69" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mn>0</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-12">t_0</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-70" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.202em, 1000.8em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-71"><span class="msubsup" id="MathJax-Span-72"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-73" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="mn" id="MathJax-Span-74" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-13">t_1</script>. (If the ray is parallel to the
plane, its intersection with the plane will be undefined.)

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/fig-2.03-ray-slab.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing_ The Next Week_files/fig-2.03-ray-slab.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_ray-slab">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;3:</b> Ray-slab intersection</span></center></div></center>

<p></p><p>

In 3D, those boundaries are planes. The equations for the planes are <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-75" style="width: 3.702em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.702em, 1002.95em, 2.603em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-76"><span class="mi" id="MathJax-Span-77" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-78" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-79" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-80" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-81" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-14">x = x_0</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-82" style="width: 3.702em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.702em, 1002.95em, 2.603em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-83"><span class="mi" id="MathJax-Span-84" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-85" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-86" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-87" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-88" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-15">x = x_1</script>. Where
does the ray hit that plane? Recall that the ray can be thought of as just a function that given a
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-89" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-90"><span class="mi" id="MathJax-Span-91" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-16">t</script> returns a location <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-92" style="width: 2.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1001.85em, 2.603em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-93"><span class="texatom" id="MathJax-Span-94"><span class="mrow" id="MathJax-Span-95"><span class="mi" id="MathJax-Span-96" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-97" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-98" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-99" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-17">\mathbf{P}(t)</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-100" style="width: 7.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1006.3em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-101"><span class="texatom" id="MathJax-Span-102"><span class="mrow" id="MathJax-Span-103"><span class="mi" id="MathJax-Span-104" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-105" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-106" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-107" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-108" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-109" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-110"><span class="mi" id="MathJax-Span-111" style="font-family: MathJax_Main-bold;">A</span></span></span><span class="mo" id="MathJax-Span-112" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-113" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">t</span><span class="texatom" id="MathJax-Span-114"><span class="mrow" id="MathJax-Span-115"><span class="mi" id="MathJax-Span-116" style="font-family: MathJax_Main-bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-18"> \mathbf{P}(t) = \mathbf{A} + t \mathbf{b} </script>

</p><p>

This equation applies to all three of the x/y/z coordinates. For example, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-117" style="width: 8.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.803em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1006.8em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-118"><span class="mi" id="MathJax-Span-119" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-120" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-121" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-122" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-123" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-124" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-125" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.753em;"><span class="mi" id="MathJax-Span-126" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-127" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-128" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">t</span><span class="msubsup" id="MathJax-Span-129"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-130" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-131" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>A</mi><mi>x</mi></msub><mo>+</mo><mi>t</mi><msub><mi>b</mi><mi>x</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-19">x(t) = A_x + t b_x</script>. This
ray hits the plane <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-132" style="width: 3.702em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.702em, 1002.95em, 2.603em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-133"><span class="mi" id="MathJax-Span-134" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-135" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-136" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-137" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-138" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>=</mo><msub><mi>x</mi><mn>0</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-20">x = x_0</script> at the parameter <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-139" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-140"><span class="mi" id="MathJax-Span-141" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-21">t</script> that satisfies this equation:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-142" style="width: 8.152em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1006.5em, 2.603em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-143"><span class="msubsup" id="MathJax-Span-144"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-145" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-146" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-147" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-148" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-149" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.753em;"><span class="mi" id="MathJax-Span-150" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-151" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="msubsup" id="MathJax-Span-152" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-153" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="mn" id="MathJax-Span-154" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-155"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-156" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-157" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>x</mi><mn>0</mn></msub><mo>=</mo><msub><mi>A</mi><mi>x</mi></msub><mo>+</mo><msub><mi>t</mi><mn>0</mn></msub><msub><mi>b</mi><mi>x</mi></msub></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-22"> x_0 = A_x + t_0 b_x </script>

</p><p>

Thus <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-158" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-159"><span class="mi" id="MathJax-Span-160" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-23">t</script> at that hitpoint is:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-161" style="width: 7.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.753em, 1005.95em, 3.302em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-162"><span class="msubsup" id="MathJax-Span-163"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-164" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="mn" id="MathJax-Span-165" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-166" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-167" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 3.552em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.152em, 1003.4em, 4.303em, -999.998em); top: -4.697em; left: 50%; margin-left: -1.698em;"><span class="mrow" id="MathJax-Span-168"><span class="msubsup" id="MathJax-Span-169"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-170" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-171" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-172" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-173" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-174" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.753em;"><span class="mi" id="MathJax-Span-175" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1000.9em, 4.303em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.447em;"><span class="msubsup" id="MathJax-Span-176"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-177" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-178" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1003.55em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.552em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.941em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>t</mi><mn>0</mn></msub><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>−</mo><msub><mi>A</mi><mi>x</mi></msub></mrow><msub><mi>b</mi><mi>x</mi></msub></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-24"> t_0 = \frac{x_0 - A_x}{b_x} </script>

</p><p>

We get the similar expression for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-179" style="width: 1.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.403em, 1001em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-180"><span class="msubsup" id="MathJax-Span-181"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-182" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-183" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-25">x_1</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-184" style="width: 7.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.753em, 1005.95em, 3.302em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-185"><span class="msubsup" id="MathJax-Span-186"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-187" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="mn" id="MathJax-Span-188" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-189" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-190" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 3.552em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.152em, 1003.4em, 4.303em, -999.998em); top: -4.697em; left: 50%; margin-left: -1.698em;"><span class="mrow" id="MathJax-Span-191"><span class="msubsup" id="MathJax-Span-192"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-193" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-194" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-195" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-196" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-197" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.753em;"><span class="mi" id="MathJax-Span-198" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1000.9em, 4.303em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.447em;"><span class="msubsup" id="MathJax-Span-199"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-200" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-201" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1003.55em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.552em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.941em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>t</mi><mn>1</mn></msub><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>A</mi><mi>x</mi></msub></mrow><msub><mi>b</mi><mi>x</mi></msub></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-26"> t_1 = \frac{x_1 - A_x}{b_x} </script>

</p><p>

</p><div class="together">
The key observation to turn that 1D math into a hit test is that for a hit, the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-202" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-203"><span class="mi" id="MathJax-Span-204" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-27">t</script>-intervals need
to overlap. For example, in 2D the green and blue overlapping only happens if there is a hit:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/fig-2.04-ray-slab-interval.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing_ The Next Week_files/fig-2.04-ray-slab-interval.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_ray-slab-interval">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;4:</b> Ray-slab <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-205" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-206"><span class="mi" id="MathJax-Span-207" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-28">t</script>-interval overlap
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="rayintersectionwithanaabb">&nbsp;</a><a class="target" name="boundingvolumehierarchies/rayintersectionwithanaabb">&nbsp;</a><a class="target" name="toc3.4">&nbsp;</a><h2>Ray Intersection with an AABB</h2>
<p>

The following pseudocode determines whether the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-208" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-209"><span class="mi" id="MathJax-Span-210" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-29">t</script> intervals in the slab overlap:

</p><pre class="listing tilde"><code><span class="line"></span>compute (tx0, tx1)
<span class="line"></span>compute (ty0, ty1)
<span class="line"></span><span class="hljs-keyword">return</span> overlap?( (tx0, tx1), (ty0, ty1))</code></pre><p>

</p><div class="together">
That is awesomely simple, and the fact that the 3D version also works is why people love the
slab method:

<p></p><pre class="listing tilde"><code><span class="line"></span>compute (tx0, tx1)
<span class="line"></span>compute (ty0, ty1)
<span class="line"></span>compute (tz0, tz1)
<span class="line"></span><span class="hljs-keyword">return</span> overlap ? ((tx0, tx1), (ty0, ty1), (tz0, tz1))</code></pre><p>

</p></div>

<p></p><p>

There are some caveats that make this less pretty than it first appears. First, suppose the ray is
travelling in the negative <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-211" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.6em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-212"><span class="texatom" id="MathJax-Span-213"><span class="mrow" id="MathJax-Span-214"><span class="mi" id="MathJax-Span-215" style="font-family: MathJax_Main-bold;">x</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-30">\mathbf{x}</script> direction. The interval <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-216" style="width: 4.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1003.5em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-217"><span class="mo" id="MathJax-Span-218" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-219"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-220" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-221"><span class="mrow" id="MathJax-Span-222"><span class="mi" id="MathJax-Span-223" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span class="mn" id="MathJax-Span-224" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-225" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-226" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-227" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-228"><span class="mrow" id="MathJax-Span-229"><span class="mi" id="MathJax-Span-230" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span class="mn" id="MathJax-Span-231" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-232" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>x</mi><mn>0</mn></mrow></msub><mo>,</mo><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>x</mi><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-31">(t_{x0}, t_{x1})</script> as computed above
might be reversed, <em class="underscore">e.g.</em> something like <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;7&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-233" style="width: 2.752em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.202em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.1em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-234"><span class="mo" id="MathJax-Span-235" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-236" style="font-family: MathJax_Main;">7</span><span class="mo" id="MathJax-Span-237" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-238" style="font-family: MathJax_Main; padding-left: 0.152em;">3</span><span class="mo" id="MathJax-Span-239" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>7</mn><mo>,</mo><mn>3</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-32">(7, 3)</script>. Second, the divide in there could give us
infinities. And if the ray origin is on one of the slab boundaries, we can get a <code>NaN</code>. There are
many ways these issues are dealt with in various ray tracers’ AABB. (There are also vectorization
issues like SIMD which we will not discuss here. Ingo Wald’s papers are a great place to start if
you want to go the extra mile in vectorization for speed.) For our purposes, this is unlikely to be
a major bottleneck as long as we make it reasonably fast, so let’s go for simplest, which is often
fastest anyway! First let’s look at computing the intervals:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-240" style="width: 7.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.753em, 1006.35em, 3.302em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-241"><span class="msubsup" id="MathJax-Span-242"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-243" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-244"><span class="mrow" id="MathJax-Span-245"><span class="mi" id="MathJax-Span-246" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span class="mn" id="MathJax-Span-247" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-248" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-249" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 3.552em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.152em, 1003.4em, 4.303em, -999.998em); top: -4.697em; left: 50%; margin-left: -1.698em;"><span class="mrow" id="MathJax-Span-250"><span class="msubsup" id="MathJax-Span-251"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-252" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-253" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-254" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-255" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-256" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.753em;"><span class="mi" id="MathJax-Span-257" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1000.9em, 4.303em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.447em;"><span class="msubsup" id="MathJax-Span-258"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-259" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-260" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1003.55em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.552em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.941em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>x</mi><mn>0</mn></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>−</mo><msub><mi>A</mi><mi>x</mi></msub></mrow><msub><mi>b</mi><mi>x</mi></msub></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-33"> t_{x0} = \frac{x_0 - A_x}{b_x} </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-261" style="width: 7.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.753em, 1006.35em, 3.302em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-262"><span class="msubsup" id="MathJax-Span-263"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-264" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-265"><span class="mrow" id="MathJax-Span-266"><span class="mi" id="MathJax-Span-267" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span class="mn" id="MathJax-Span-268" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-269" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-270" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 3.552em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.152em, 1003.4em, 4.303em, -999.998em); top: -4.697em; left: 50%; margin-left: -1.698em;"><span class="mrow" id="MathJax-Span-271"><span class="msubsup" id="MathJax-Span-272"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-273" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-274" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-275" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-276" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-277" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.753em;"><span class="mi" id="MathJax-Span-278" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1000.9em, 4.303em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.447em;"><span class="msubsup" id="MathJax-Span-279"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-280" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-281" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1003.55em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.552em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.941em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>x</mi><mn>1</mn></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>A</mi><mi>x</mi></msub></mrow><msub><mi>b</mi><mi>x</mi></msub></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-34"> t_{x1} = \frac{x_1 - A_x}{b_x} </script>

</p><p>

One troublesome thing is that perfectly valid rays will have <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-282" style="width: 3.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1002.75em, 2.452em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-283"><span class="msubsup" id="MathJax-Span-284"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-285" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-286" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-287" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-288" style="font-family: MathJax_Main; padding-left: 0.302em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>b</mi><mi>x</mi></msub><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-35">b_x = 0</script>, causing division by zero.
Some of those rays are inside the slab, and some are not. Also, the zero will have a ± sign when
using IEEE floating point. The good news for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-289" style="width: 3.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1002.75em, 2.452em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-290"><span class="msubsup" id="MathJax-Span-291"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-292" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-293" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-294" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-295" style="font-family: MathJax_Main; padding-left: 0.302em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>b</mi><mi>x</mi></msub><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-36">b_x = 0</script> is that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-296" style="width: 1.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.202em, 1001.2em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-297"><span class="msubsup" id="MathJax-Span-298"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-299" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-300"><span class="mrow" id="MathJax-Span-301"><span class="mi" id="MathJax-Span-302" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span class="mn" id="MathJax-Span-303" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>x</mi><mn>0</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-37">t_{x0}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-304" style="width: 1.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.202em, 1001.2em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-305"><span class="msubsup" id="MathJax-Span-306"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-307" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-308"><span class="mrow" id="MathJax-Span-309"><span class="mi" id="MathJax-Span-310" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span class="mn" id="MathJax-Span-311" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>x</mi><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-38">t_{x1}</script> will both be +∞
or both be -∞ if not between <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-312" style="width: 1.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.403em, 1001em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-313"><span class="msubsup" id="MathJax-Span-314"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-315" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-316" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>0</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-39">x_0</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-317" style="width: 1.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.403em, 1001em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-318"><span class="msubsup" id="MathJax-Span-319"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-320" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-321" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-40">x_1</script>. So, using min and max should get us the right answers:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;min&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-322" style="width: 16.203em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.953em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.753em, 1012.85em, 3.302em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-323"><span class="msubsup" id="MathJax-Span-324"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-325" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-326"><span class="mrow" id="MathJax-Span-327"><span class="mi" id="MathJax-Span-328" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span class="mn" id="MathJax-Span-329" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-330" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-331" style="font-family: MathJax_Main; padding-left: 0.302em;">min</span><span class="mo" id="MathJax-Span-332" style="font-family: MathJax_Main;">(</span><span class="mfrac" id="MathJax-Span-333"><span style="display: inline-block; position: relative; width: 3.552em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.152em, 1003.4em, 4.303em, -999.998em); top: -4.697em; left: 50%; margin-left: -1.698em;"><span class="mrow" id="MathJax-Span-334"><span class="msubsup" id="MathJax-Span-335"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-336" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-337" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-338" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-339" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-340" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.753em;"><span class="mi" id="MathJax-Span-341" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1000.9em, 4.303em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.447em;"><span class="msubsup" id="MathJax-Span-342"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-343" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-344" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1003.55em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.552em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-345" style="font-family: MathJax_Main;">,</span><span class="mfrac" id="MathJax-Span-346" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 3.552em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.152em, 1003.4em, 4.303em, -999.998em); top: -4.697em; left: 50%; margin-left: -1.698em;"><span class="mrow" id="MathJax-Span-347"><span class="msubsup" id="MathJax-Span-348"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-349" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-350" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-351" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-352" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-353" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.753em;"><span class="mi" id="MathJax-Span-354" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1000.9em, 4.303em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.447em;"><span class="msubsup" id="MathJax-Span-355"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-356" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-357" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1003.55em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.552em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-358" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.941em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>x</mi><mn>0</mn></mrow></msub><mo>=</mo><mo movablelimits="true" form="prefix">min</mo><mo stretchy="false">(</mo><mfrac><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>−</mo><msub><mi>A</mi><mi>x</mi></msub></mrow><msub><mi>b</mi><mi>x</mi></msub></mfrac><mo>,</mo><mfrac><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>A</mi><mi>x</mi></msub></mrow><msub><mi>b</mi><mi>x</mi></msub></mfrac><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-41"> t_{x0} = \min(
     \frac{x_0 - A_x}{b_x},
     \frac{x_1 - A_x}{b_x})
  </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;max&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-359" style="width: 16.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.753em, 1013.05em, 3.302em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-360"><span class="msubsup" id="MathJax-Span-361"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-362" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-363"><span class="mrow" id="MathJax-Span-364"><span class="mi" id="MathJax-Span-365" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span class="mn" id="MathJax-Span-366" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-367" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-368" style="font-family: MathJax_Main; padding-left: 0.302em;">max</span><span class="mo" id="MathJax-Span-369" style="font-family: MathJax_Main;">(</span><span class="mfrac" id="MathJax-Span-370"><span style="display: inline-block; position: relative; width: 3.552em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.152em, 1003.4em, 4.303em, -999.998em); top: -4.697em; left: 50%; margin-left: -1.698em;"><span class="mrow" id="MathJax-Span-371"><span class="msubsup" id="MathJax-Span-372"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-373" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-374" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-375" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-376" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-377" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.753em;"><span class="mi" id="MathJax-Span-378" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1000.9em, 4.303em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.447em;"><span class="msubsup" id="MathJax-Span-379"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-380" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-381" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1003.55em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.552em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-382" style="font-family: MathJax_Main;">,</span><span class="mfrac" id="MathJax-Span-383" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 3.552em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.152em, 1003.4em, 4.303em, -999.998em); top: -4.697em; left: 50%; margin-left: -1.698em;"><span class="mrow" id="MathJax-Span-384"><span class="msubsup" id="MathJax-Span-385"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-386" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-387" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-388" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-389" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-390" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.753em;"><span class="mi" id="MathJax-Span-391" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1000.9em, 4.303em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.447em;"><span class="msubsup" id="MathJax-Span-392"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-393" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-394" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1003.55em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.552em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-395" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.941em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>x</mi><mn>1</mn></mrow></msub><mo>=</mo><mo movablelimits="true" form="prefix">max</mo><mo stretchy="false">(</mo><mfrac><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>−</mo><msub><mi>A</mi><mi>x</mi></msub></mrow><msub><mi>b</mi><mi>x</mi></msub></mfrac><mo>,</mo><mfrac><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>A</mi><mi>x</mi></msub></mrow><msub><mi>b</mi><mi>x</mi></msub></mfrac><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-42"> t_{x1} = \max(
     \frac{x_0 - A_x}{b_x},
     \frac{x_1 - A_x}{b_x})
  </script>

</p><p>

The remaining troublesome case if we do that is if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-396" style="width: 3.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1002.75em, 2.452em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-397"><span class="msubsup" id="MathJax-Span-398"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-399" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.453em;"><span class="mi" id="MathJax-Span-400" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-401" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-402" style="font-family: MathJax_Main; padding-left: 0.302em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>b</mi><mi>x</mi></msub><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-43">b_x = 0</script> and either <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-403" style="width: 6.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.303em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1005.25em, 2.603em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-404"><span class="msubsup" id="MathJax-Span-405"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-406" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-407" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-408" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-409" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-410" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.753em;"><span class="mi" id="MathJax-Span-411" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-412" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-413" style="font-family: MathJax_Main; padding-left: 0.302em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>0</mn></msub><mo>−</mo><msub><mi>A</mi><mi>x</mi></msub><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-44">x_0 - A_x = 0</script> or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-414" style="width: 6.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.303em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1005.25em, 2.603em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-415"><span class="msubsup" id="MathJax-Span-416"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-417" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.552em;"><span class="mn" id="MathJax-Span-418" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-419" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-420" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-421" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.753em;"><span class="mi" id="MathJax-Span-422" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-423" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-424" style="font-family: MathJax_Main; padding-left: 0.302em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>A</mi><mi>x</mi></msub><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-45">x_1 -
A_x = 0</script> so we get a <code>NaN</code>. In that case we can probably accept either hit or no hit answer, but
we’ll revisit that later.

</p><p>

Now, let’s look at that overlap function. Suppose we can assume the intervals are not reversed (so
the first value is less than the second value in the interval) and we want to return true in that
case. The boolean overlap that also computes the overlap interval <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-425" style="width: 3.152em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.502em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.4em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-426"><span class="mo" id="MathJax-Span-427" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-428" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mo" id="MathJax-Span-429" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-430" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-431" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>f</mi><mo>,</mo><mi>F</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-46">(f, F)</script> of intervals <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-432" style="width: 3.202em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.45em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-433"><span class="mo" id="MathJax-Span-434" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-435" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-436" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-437" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">D</span><span class="mo" id="MathJax-Span-438" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>d</mi><mo>,</mo><mi>D</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-47">(d, D)</script> and
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-439" style="width: 3.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.452em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.35em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-440"><span class="mo" id="MathJax-Span-441" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-442" style="font-family: MathJax_Math-italic;">e</span><span class="mo" id="MathJax-Span-443" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-444" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mo" id="MathJax-Span-445" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>e</mi><mo>,</mo><mi>E</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-48">(e, E)</script> would be:

</p><pre class="listing tilde"><code><span class="line"></span>bool overlap<span class="hljs-punctuation">(</span>d<span class="hljs-punctuation">,</span> D<span class="hljs-punctuation">,</span> e<span class="hljs-punctuation">,</span> E<span class="hljs-punctuation">,</span> f<span class="hljs-punctuation">,</span> <span class="hljs-built_in">F</span><span class="hljs-punctuation">)</span>
<span class="line"></span>    f <span class="hljs-operator">=</span> <span class="hljs-built_in">max</span><span class="hljs-punctuation">(</span>d<span class="hljs-punctuation">,</span> e<span class="hljs-punctuation">)</span>
<span class="line"></span>    <span class="hljs-built_in">F</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">min</span><span class="hljs-punctuation">(</span>D<span class="hljs-punctuation">,</span> E<span class="hljs-punctuation">)</span>
<span class="line"></span>    <span class="hljs-built_in">return</span> <span class="hljs-punctuation">(</span>f <span class="hljs-operator">&lt;</span> <span class="hljs-built_in">F</span><span class="hljs-punctuation">)</span></code></pre><p>

If there are any <code>NaN</code>s running around there, the compare will return false so we need to be sure
our bounding boxes have a little padding if we care about grazing cases (and we probably should
because in a ray tracer all cases come up eventually). Here's the implementation:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">interval</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> max - min;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">interval <span class="hljs-title">expand</span><span class="hljs-params">(<span class="hljs-type">double</span> delta)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">auto</span> padding = delta/<span class="hljs-number">2</span>;
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">interval</span>(min - padding, max + padding);
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_interval-contains">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;8:</b> <kbd>interval.h</kbd> interval::expand() method</div></center>
<pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> AABB_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> AABB_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">aabb</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    interval x, y, z;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">aabb</span>() {} <span class="hljs-comment">// The default AABB is empty, since intervals are empty by default.</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">aabb</span>(<span class="hljs-type">const</span> interval&amp; ix, <span class="hljs-type">const</span> interval&amp; iy, <span class="hljs-type">const</span> interval&amp; iz)
<span class="line"></span>      : <span class="hljs-built_in">x</span>(ix), <span class="hljs-built_in">y</span>(iy), <span class="hljs-built_in">z</span>(iz) { }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">aabb</span>(<span class="hljs-type">const</span> point3&amp; a, <span class="hljs-type">const</span> point3&amp; b) {
<span class="line"></span>        <span class="hljs-comment">// Treat the two points a and b as extrema for the bounding box, so we don't require a</span>
<span class="line"></span>        <span class="hljs-comment">// particular minimum/maximum coordinate order.</span>
<span class="line"></span>        x = <span class="hljs-built_in">interval</span>(<span class="hljs-built_in">fmin</span>(a[<span class="hljs-number">0</span>],b[<span class="hljs-number">0</span>]), <span class="hljs-built_in">fmax</span>(a[<span class="hljs-number">0</span>],b[<span class="hljs-number">0</span>]));
<span class="line"></span>        y = <span class="hljs-built_in">interval</span>(<span class="hljs-built_in">fmin</span>(a[<span class="hljs-number">1</span>],b[<span class="hljs-number">1</span>]), <span class="hljs-built_in">fmax</span>(a[<span class="hljs-number">1</span>],b[<span class="hljs-number">1</span>]));
<span class="line"></span>        z = <span class="hljs-built_in">interval</span>(<span class="hljs-built_in">fmin</span>(a[<span class="hljs-number">2</span>],b[<span class="hljs-number">2</span>]), <span class="hljs-built_in">fmax</span>(a[<span class="hljs-number">2</span>],b[<span class="hljs-number">2</span>]));
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">const</span> interval&amp; <span class="hljs-title">axis</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">if</span> (n == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> y;
<span class="line"></span>        <span class="hljs-keyword">if</span> (n == <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> z;
<span class="line"></span>        <span class="hljs-keyword">return</span> x;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> a = <span class="hljs-number">0</span>; a &lt; <span class="hljs-number">3</span>; a++) {
<span class="line"></span>            <span class="hljs-keyword">auto</span> t0 = <span class="hljs-built_in">fmin</span>((<span class="hljs-built_in">axis</span>(a).min - r.<span class="hljs-built_in">origin</span>()[a]) / r.<span class="hljs-built_in">direction</span>()[a],
<span class="line"></span>                           (<span class="hljs-built_in">axis</span>(a).max - r.<span class="hljs-built_in">origin</span>()[a]) / r.<span class="hljs-built_in">direction</span>()[a]);
<span class="line"></span>            <span class="hljs-keyword">auto</span> t1 = <span class="hljs-built_in">fmax</span>((<span class="hljs-built_in">axis</span>(a).min - r.<span class="hljs-built_in">origin</span>()[a]) / r.<span class="hljs-built_in">direction</span>()[a],
<span class="line"></span>                           (<span class="hljs-built_in">axis</span>(a).max - r.<span class="hljs-built_in">origin</span>()[a]) / r.<span class="hljs-built_in">direction</span>()[a]);
<span class="line"></span>            <span class="hljs-type">ray_t</span>.min = <span class="hljs-built_in">fmax</span>(t0, <span class="hljs-type">ray_t</span>.min);
<span class="line"></span>            <span class="hljs-type">ray_t</span>.max = <span class="hljs-built_in">fmin</span>(t1, <span class="hljs-type">ray_t</span>.max);
<span class="line"></span>            <span class="hljs-keyword">if</span> (<span class="hljs-type">ray_t</span>.max &lt;= <span class="hljs-type">ray_t</span>.min)
<span class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>        }
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_aabb">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;9:</b> <kbd>[aabb.h]</kbd> Axis-aligned bounding box class</div></center>

<a class="target" name="anoptimizedaabbhitmethod">&nbsp;</a><a class="target" name="boundingvolumehierarchies/anoptimizedaabbhitmethod">&nbsp;</a><a class="target" name="toc3.5">&nbsp;</a><h2>An Optimized AABB Hit Method</h2>
<p>

In reviewing this intersection method, Andrew Kensler at Pixar tried some experiments and proposed
the following version of the code. It works extremely well on many compilers, and I have adopted it
as my go-to method:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">aabb</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> a = <span class="hljs-number">0</span>; a &lt; <span class="hljs-number">3</span>; a++) {
<span class="line"></span>            <span class="hljs-keyword">auto</span> invD = <span class="hljs-number">1</span> / r.<span class="hljs-built_in">direction</span>()[a];
<span class="line"></span>            <span class="hljs-keyword">auto</span> orig = r.<span class="hljs-built_in">origin</span>()[a];
<span class="line"></span>
<span class="line"></span>            <span class="hljs-keyword">auto</span> t0 = (<span class="hljs-built_in">axis</span>(a).min - orig) * invD;
<span class="line"></span>            <span class="hljs-keyword">auto</span> t1 = (<span class="hljs-built_in">axis</span>(a).max - orig) * invD;
<span class="line"></span>
<span class="line"></span>            <span class="hljs-keyword">if</span> (invD &lt; <span class="hljs-number">0</span>)
<span class="line"></span>                std::<span class="hljs-built_in">swap</span>(t0, t1);
<span class="line"></span>
<span class="line"></span>            <span class="hljs-keyword">if</span> (t0 &gt; <span class="hljs-type">ray_t</span>.min) <span class="hljs-type">ray_t</span>.min = t0;
<span class="line"></span>            <span class="hljs-keyword">if</span> (t1 &lt; <span class="hljs-type">ray_t</span>.max) <span class="hljs-type">ray_t</span>.max = t1;
<span class="line"></span>
<span class="line"></span>            <span class="hljs-keyword">if</span> (<span class="hljs-type">ray_t</span>.max &lt;= <span class="hljs-type">ray_t</span>.min)
<span class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>        }
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_aabb-hit">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;10:</b> <kbd>[aabb.h]</kbd> Axis-aligned bounding box hit function</div></center>

<a class="target" name="constructingboundingboxesforhittables">&nbsp;</a><a class="target" name="boundingvolumehierarchies/constructingboundingboxesforhittables">&nbsp;</a><a class="target" name="toc3.6">&nbsp;</a><h2>Constructing Bounding Boxes for Hittables</h2>
<p>

We now need to add a function to compute the bounding boxes of all the hittables. Then we will make
a hierarchy of boxes over all the primitives, and the individual primitives—like spheres—will live
at the leaves.

</p><p>

Recall that <code>interval</code> values constructed without arguments will be empty by default. Since an
<code>aabb</code> object has an interval for each of its three dimensions, each of these will then be empty by
default, and therefore <code>aabb</code> objects will be empty by default. Thus, some objects may have empty
bounding volumes. For example, consider a <code>hittable_list</code> object with no children. Happily, the way
we've designed our interval class, the math all works out.

</p><p>

Finally, recall that some objects may be animated. Such objects should return their bounds over the
entire range of motion, from time=0 to time=1.

</p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"aabb.h"</span></span></div><span class="line"></span>...
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">hittable</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> aabb <span class="hljs-title">bounding_box</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;</div><span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_hittable-bbox">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;11:</b> <kbd>[hittable.h]</kbd> Hittable class with bounding-box</div></center>
<p>


For a stationary sphere, the <code>bounding_box</code> function is easy:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">sphere</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-comment">// Stationary Sphere</span><div class=" highlight"><span class="line"></span>    <span class="hljs-built_in">sphere</span>(point3 _center, <span class="hljs-type">double</span> _radius, shared_ptr&lt;material&gt; _material)
<span class="line"></span>      : <span class="hljs-built_in">center1</span>(_center), <span class="hljs-built_in">radius</span>(_radius), <span class="hljs-built_in">mat</span>(_material), <span class="hljs-built_in">is_moving</span>(<span class="hljs-literal">false</span>)
<span class="line"></span>    {
<span class="line"></span>        <span class="hljs-keyword">auto</span> rvec = <span class="hljs-built_in">vec3</span>(radius, radius, radius);
<span class="line"></span>        bbox = <span class="hljs-built_in">aabb</span>(center1 - rvec, center1 + rvec);
<span class="line"></span>    }</div><span class="line"></span>    ...<div class=" highlight"><span class="line"></span>    <span class="hljs-function">aabb <span class="hljs-title">bounding_box</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-keyword">return</span> bbox; }</div><span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    point3 center1;
<span class="line"></span>    <span class="hljs-type">double</span> radius;
<span class="line"></span>    shared_ptr&lt;material&gt; mat;
<span class="line"></span>    <span class="hljs-type">bool</span> is_moving;
<span class="line"></span>    vec3 center_vec;<div class=" highlight"><span class="line"></span>    aabb bbox;</div><span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_sphere-bbox">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;12:</b> <kbd>[sphere.h]</kbd> Sphere with bounding box</div></center>
<p>


For a moving sphere, we want the bounds of its entire range of motion. To do this, we can take the
box of the sphere at time=0, and the box of the sphere at time=1, and compute the box around those
two boxes.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">sphere</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-comment">// Moving Sphere</span>
<span class="line"></span>    <span class="hljs-built_in">sphere</span>(point3 _center1, point3 _center2, <span class="hljs-type">double</span> _radius, shared_ptr&lt;material&gt; _material)
<span class="line"></span>      : <span class="hljs-built_in">center1</span>(_center1), <span class="hljs-built_in">radius</span>(_radius), <span class="hljs-built_in">mat</span>(_material), <span class="hljs-built_in">is_moving</span>(<span class="hljs-literal">true</span>)
<span class="line"></span>    {<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> rvec = <span class="hljs-built_in">vec3</span>(radius, radius, radius);
<span class="line"></span>        <span class="hljs-function">aabb <span class="hljs-title">box1</span><span class="hljs-params">(_center1 - rvec, _center1 + rvec)</span></span>;
<span class="line"></span>        <span class="hljs-function">aabb <span class="hljs-title">box2</span><span class="hljs-params">(_center2 - rvec, _center2 + rvec)</span></span>;
<span class="line"></span>        bbox = <span class="hljs-built_in">aabb</span>(box1, box2);</div><span class="line"></span>
<span class="line"></span>        center_vec = _center2 - _center1;
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_moving-sphere-bbox">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;13:</b> <kbd>[sphere.h]</kbd> Moving sphere with bounding box</div></center>
<p>


</p><div class="together">
Now we need a new <code>aabb</code> constructor that takes two boxes as input.
First, we'll add a new interval constructor that takes two intervals as input:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">interval</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">interval</span>(<span class="hljs-type">const</span> interval&amp; a, <span class="hljs-type">const</span> interval&amp; b)
<span class="line"></span>      : <span class="hljs-built_in">min</span>(<span class="hljs-built_in">fmin</span>(a.min, b.min)), <span class="hljs-built_in">max</span>(<span class="hljs-built_in">fmax</span>(a.max, b.max)) {}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_interval-from-intervals">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;14:</b> <kbd>[interval.h]</kbd>
        Interval constructor from two intervals
    </div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Now we can use this to construct an axis-aligned bounding box from two input boxes.

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">aabb</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...<div class=" highlight"><span class="line"></span>    <span class="hljs-built_in">aabb</span>(<span class="hljs-type">const</span> aabb&amp; box0, <span class="hljs-type">const</span> aabb&amp; box1) {
<span class="line"></span>        x = <span class="hljs-built_in">interval</span>(box0.x, box1.x);
<span class="line"></span>        y = <span class="hljs-built_in">interval</span>(box0.y, box1.y);
<span class="line"></span>        z = <span class="hljs-built_in">interval</span>(box0.z, box1.z);
<span class="line"></span>    }</div><div class=" highlight"><span class="line"></span>    ...
<span class="line"></span>};</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_aabb-from-two-aabb">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;15:</b> <kbd>[aabb.h]</kbd> AABB constructor from two AABB inputs</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="creatingboundingboxesoflistsofobjects">&nbsp;</a><a class="target" name="boundingvolumehierarchies/creatingboundingboxesoflistsofobjects">&nbsp;</a><a class="target" name="toc3.7">&nbsp;</a><h2>Creating Bounding Boxes of Lists of Objects</h2>
<p>

Now we'll update the <code>hittable_list</code> object, computing the bounds of its children. We'll update the
bounding box incrementally as each new child is added.

</p><pre class="listing tilde"><code><span class="line"></span>...<div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"aabb.h"</span></span></div><span class="line"></span>...
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">hittable_list</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    std::vector&lt;shared_ptr&lt;hittable&gt;&gt; objects;
<span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(shared_ptr&lt;hittable&gt; object)</span> </span>{
<span class="line"></span>        objects.<span class="hljs-built_in">push_back</span>(object);<div class=" highlight"><span class="line"></span>        bbox = <span class="hljs-built_in">aabb</span>(bbox, object-&gt;<span class="hljs-built_in">bounding_box</span>());</div><span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">double</span> ray_tmin, <span class="hljs-type">double</span> ray_tmax, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        ...
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-function">aabb <span class="hljs-title">bounding_box</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-keyword">return</span> bbox; }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    aabb bbox;</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_hit-list-bbox">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;16:</b> <kbd>[hittable_list.h]</kbd> Hittable list with bounding box</div></center>

<a class="target" name="thebvhnodeclass">&nbsp;</a><a class="target" name="boundingvolumehierarchies/thebvhnodeclass">&nbsp;</a><a class="target" name="toc3.8">&nbsp;</a><h2>The BVH Node Class</h2>
<p>

A BVH is also going to be a <code>hittable</code> — just like lists of <code>hittable</code>s. It’s really a container,
but it can respond to the query “does this ray hit you?”. One design question is whether we have two
classes, one for the tree, and one for the nodes in the tree; or do we have just one class and have
the root just be a node we point to. The <code>hit</code> function is pretty straightforward: check whether the
box for the node is hit, and if so, check the children and sort out any details.

</p><p>

</p><div class="together">
I am a fan of the one class design when feasible. Here is such a class:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> BVH_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> BVH_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable_list.h"</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">bvh_node</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">bvh_node</span>(<span class="hljs-type">const</span> hittable_list&amp; list) : <span class="hljs-built_in">bvh_node</span>(list.objects, <span class="hljs-number">0</span>, list.objects.<span class="hljs-built_in">size</span>()) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">bvh_node</span>(<span class="hljs-type">const</span> std::vector&lt;shared_ptr&lt;hittable&gt;&gt;&amp; src_objects, <span class="hljs-type">size_t</span> start, <span class="hljs-type">size_t</span> end) {
<span class="line"></span>        <span class="hljs-comment">// To be implemented later.</span>
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">if</span> (!box.<span class="hljs-built_in">hit</span>(r, <span class="hljs-type">ray_t</span>))
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-type">bool</span> hit_left = left-&gt;<span class="hljs-built_in">hit</span>(r, <span class="hljs-type">ray_t</span>, rec);
<span class="line"></span>        <span class="hljs-type">bool</span> hit_right = right-&gt;<span class="hljs-built_in">hit</span>(r, <span class="hljs-built_in">interval</span>(<span class="hljs-type">ray_t</span>.min, hit_left ? rec.t : <span class="hljs-type">ray_t</span>.max), rec);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> hit_left || hit_right;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">aabb <span class="hljs-title">bounding_box</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-keyword">return</span> bbox; }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    shared_ptr&lt;hittable&gt; left;
<span class="line"></span>    shared_ptr&lt;hittable&gt; right;
<span class="line"></span>    aabb bbox;
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_bvh">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;17:</b> <kbd>[bvh.h]</kbd> Bounding volume hierarchy</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="splittingbvhvolumes">&nbsp;</a><a class="target" name="boundingvolumehierarchies/splittingbvhvolumes">&nbsp;</a><a class="target" name="toc3.9">&nbsp;</a><h2>Splitting BVH Volumes</h2>
<p>

The most complicated part of any efficiency structure, including the BVH, is building it. We do this
in the constructor. A cool thing about BVHs is that as long as the list of objects in a <code>bvh_node</code>
gets divided into two sub-lists, the hit function will work. It will work best if the division is
done well, so that the two children have smaller bounding boxes than their parent’s bounding box,
but that is for speed not correctness. I’ll choose the middle ground, and at each node split the
list along one axis. I’ll go for simplicity:

</p><p>

</p><ol start="1">
  <li class="number">randomly choose an axis
</li>
  <li class="number">sort the primitives (<code>using std::sort</code>)
</li>
  <li class="number">put half in each subtree</li></ol>

<p></p><p>

When the list coming in is two elements, I put one in each subtree and end the recursion. The
traversal algorithm should be smooth and not have to check for null pointers, so if I just have one
element I duplicate it in each subtree. Checking explicitly for three elements and just following
one recursion would probably help a little, but I figure the whole method will get optimized later.
The following code uses three methods—<code>box_x_compare</code>, <code>box_y_compare_</code>, and <code>box_z_compare</code>—that
we haven't yet defined.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">bvh_node</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-built_in">bvh_node</span>(<span class="hljs-type">const</span> std::vector&lt;shared_ptr&lt;hittable&gt;&gt;&amp; src_objects, <span class="hljs-type">size_t</span> start, <span class="hljs-type">size_t</span> end) {
<span class="line"></span>        <span class="hljs-keyword">auto</span> objects = src_objects; <span class="hljs-comment">// Create a modifiable array of the source scene objects</span>
<span class="line"></span>
<span class="line"></span>        <span class="hljs-type">int</span> axis = <span class="hljs-built_in">random_int</span>(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>);
<span class="line"></span>        <span class="hljs-keyword">auto</span> comparator = (axis == <span class="hljs-number">0</span>) ? box_x_compare
<span class="line"></span>                        : (axis == <span class="hljs-number">1</span>) ? box_y_compare
<span class="line"></span>                                      : box_z_compare;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-type">size_t</span> object_span = end - start;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (object_span == <span class="hljs-number">1</span>) {
<span class="line"></span>            left = right = objects[start];
<span class="line"></span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (object_span == <span class="hljs-number">2</span>) {
<span class="line"></span>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">comparator</span>(objects[start], objects[start+<span class="hljs-number">1</span>])) {
<span class="line"></span>                left = objects[start];
<span class="line"></span>                right = objects[start+<span class="hljs-number">1</span>];
<span class="line"></span>            } <span class="hljs-keyword">else</span> {
<span class="line"></span>                left = objects[start+<span class="hljs-number">1</span>];
<span class="line"></span>                right = objects[start];
<span class="line"></span>            }
<span class="line"></span>        } <span class="hljs-keyword">else</span> {
<span class="line"></span>            std::<span class="hljs-built_in">sort</span>(objects.<span class="hljs-built_in">begin</span>() + start, objects.<span class="hljs-built_in">begin</span>() + end, comparator);
<span class="line"></span>
<span class="line"></span>            <span class="hljs-keyword">auto</span> mid = start + object_span/<span class="hljs-number">2</span>;
<span class="line"></span>            left = <span class="hljs-built_in">make_shared</span>&lt;bvh_node&gt;(objects, start, mid);
<span class="line"></span>            right = <span class="hljs-built_in">make_shared</span>&lt;bvh_node&gt;(objects, mid, end);
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        bbox = <span class="hljs-built_in">aabb</span>(left-&gt;<span class="hljs-built_in">bounding_box</span>(), right-&gt;<span class="hljs-built_in">bounding_box</span>());
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_bvh-node">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;18:</b> <kbd>[bvh.h]</kbd> Bounding volume hierarchy node</div></center>
<p>


</p><div class="together">
This uses a new function: <code>random_int()</code>:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">random_int</span><span class="hljs-params">(<span class="hljs-type">int</span> min, <span class="hljs-type">int</span> max)</span> </span>{
<span class="line"></span>    <span class="hljs-comment">// Returns a random integer in [min,max].</span>
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-built_in">random_double</span>(min, max+<span class="hljs-number">1</span>));
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_random-int">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;19:</b> <kbd>[rtweekend.h]</kbd> A function to return random integers in a range</div></center>
<p>


</p></div>

<p></p><p>

The check for whether there is a bounding box at all is in case you sent in something like an
infinite plane that doesn’t have a bounding box. We don’t have any of those primitives, so it
shouldn’t happen until you add such a thing.

</p>
<a class="target" name="theboxcomparisonfunctions">&nbsp;</a><a class="target" name="boundingvolumehierarchies/theboxcomparisonfunctions">&nbsp;</a><a class="target" name="toc3.10">&nbsp;</a><h2>The Box Comparison Functions</h2>
<p>

Now we need to implement the box comparison functions, used by <code>std::sort()</code>. To do this, create a
generic comparator returns true if the first argument is less than the second, given an additional
axis index argument. Then define axis-specific comparison functions that use the generic comparison
function.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">bvh_node</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  ...
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">bool</span> <span class="hljs-title">box_compare</span><span class="hljs-params">(
<span class="line"></span>        <span class="hljs-type">const</span> shared_ptr&lt;hittable&gt; a, <span class="hljs-type">const</span> shared_ptr&lt;hittable&gt; b, <span class="hljs-type">int</span> axis_index
<span class="line"></span>    )</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> a-&gt;<span class="hljs-built_in">bounding_box</span>().<span class="hljs-built_in">axis</span>(axis_index).min &lt; b-&gt;<span class="hljs-built_in">bounding_box</span>().<span class="hljs-built_in">axis</span>(axis_index).min;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">bool</span> <span class="hljs-title">box_x_compare</span> <span class="hljs-params">(<span class="hljs-type">const</span> shared_ptr&lt;hittable&gt; a, <span class="hljs-type">const</span> shared_ptr&lt;hittable&gt; b)</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">box_compare</span>(a, b, <span class="hljs-number">0</span>);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">bool</span> <span class="hljs-title">box_y_compare</span> <span class="hljs-params">(<span class="hljs-type">const</span> shared_ptr&lt;hittable&gt; a, <span class="hljs-type">const</span> shared_ptr&lt;hittable&gt; b)</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">box_compare</span>(a, b, <span class="hljs-number">1</span>);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">bool</span> <span class="hljs-title">box_z_compare</span> <span class="hljs-params">(<span class="hljs-type">const</span> shared_ptr&lt;hittable&gt; a, <span class="hljs-type">const</span> shared_ptr&lt;hittable&gt; b)</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">box_compare</span>(a, b, <span class="hljs-number">2</span>);
<span class="line"></span>    }
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_bvh-x-comp">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;20:</b> <kbd>[bvh.h]</kbd> BVH comparison function, X-axis</div></center>
<p>


At this point, we're ready to use our new BVH code. Let's use it on our random spheres scene.

</p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> material2 = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.4</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.1</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">-4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>, material2));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> material3 = <span class="hljs-built_in">make_shared</span>&lt;metal&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.7</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.5</span>), <span class="hljs-number">0.0</span>);
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>, material3));
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    world = <span class="hljs-built_in">hittable_list</span>(<span class="hljs-built_in">make_shared</span>&lt;bvh_node&gt;(world));</div><span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_random-spheres-bvh">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;21:</b> <kbd>[main.cc]</kbd> Random spheres, using BVH</div></center>

<a class="target" name="texturemapping">&nbsp;</a><a class="target" name="texturemapping">&nbsp;</a><a class="target" name="toc4">&nbsp;</a><h1>Texture Mapping</h1>
<p>

<em class="underscore">Texture mapping</em> in computer graphics is the process of applying a material effect to an object in
the scene. The “texture” part is the effect, and the “mapping” part is in the mathematical sense of
mapping one space onto another. This effect could be any material property: color, shininess, bump
geometry (called <em class="underscore">Bump Mapping</em>), or even material existence (to create cut-out regions of the
surface).

</p><p>

The most common type of texture mapping maps an image onto the surface of an object, defining the
color at each point on the object’s surface. In practice, we implement the process in reverse: given
some point on the object, we’ll look up the color defined by the texture map.

</p><p>

To begin with, we'll make the texture colors procedural, and will create a texture map of constant
color. Most programs keep constant RGB colors and textures in different classes, so feel free to do
something different, but I am a big believer in this architecture because it's great being able to
make any color a texture.

</p><p>

In order to perform the texture lookup, we need a <em class="underscore">texture coordinate</em>. This coordinate can be
defined in many ways, and we'll develop this idea as we progress. For now, we'll pass in two
dimensional texture coordinates. By convention, texture coordinates are named <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-446" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.55em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-447"><span class="mi" id="MathJax-Span-448" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math></span></span><script type="math/tex" id="MathJax-Element-49">u</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-449" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-450"><span class="mi" id="MathJax-Span-451" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-50">v</script>. For a
constant texture, every <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-452" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.15em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-453"><span class="mo" id="MathJax-Span-454" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-455" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-456" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-457" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span><span class="mo" id="MathJax-Span-458" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-51">(u,v)</script> pair yields a constant color, so we can actually ignore the
coordinates completely. However, other texture types will need these coordinates, so we keep these
in the method interface.

</p><p>

The primary method of our texture classes is the <code>color value(...)</code> method, which returns the
texture color given the input coordinates. In addition to taking the point's texture coordinates <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-459" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.55em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-460"><span class="mi" id="MathJax-Span-461" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math></span></span><script type="math/tex" id="MathJax-Element-52">u</script>
and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-462" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-463"><span class="mi" id="MathJax-Span-464" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-53">v</script>, we also provide the position of the point in question, for reasons that will become
apparent later.

</p>
<a class="target" name="constantcolortexture">&nbsp;</a><a class="target" name="texturemapping/constantcolortexture">&nbsp;</a><a class="target" name="toc4.1">&nbsp;</a><h2>Constant Color Texture</h2>
<pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> TEXTURE_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> TEXTURE_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">texture</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">texture</span>() = <span class="hljs-keyword">default</span>;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> color <span class="hljs-title">value</span><span class="hljs-params">(<span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">solid_color</span> : <span class="hljs-keyword">public</span> texture {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">solid_color</span>(color c) : <span class="hljs-built_in">color_value</span>(c) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">solid_color</span>(<span class="hljs-type">double</span> red, <span class="hljs-type">double</span> green, <span class="hljs-type">double</span> blue) : <span class="hljs-built_in">solid_color</span>(<span class="hljs-built_in">color</span>(red,green,blue)) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">value</span><span class="hljs-params">(<span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> color_value;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    color color_value;
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_texture">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;22:</b> <kbd>[texture.h]</kbd> A texture class</div></center>
<p>


We'll need to update the <code>hit_record</code> structure to store the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-465" style="width: 1.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.502em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.552em, 1001.5em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-466"><span class="mi" id="MathJax-Span-467" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-468" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-469" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>,</mo><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-54">u,v</script> surface coordinates of the
ray-object hit point.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">hit_record</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    vec3 p;
<span class="line"></span>    vec3 normal;
<span class="line"></span>    shared_ptr&lt;material&gt; mat;
<span class="line"></span>    <span class="hljs-type">double</span> t;<div class=" highlight"><span class="line"></span>    <span class="hljs-type">double</span> u;
<span class="line"></span>    <span class="hljs-type">double</span> v;</div><span class="line"></span>    <span class="hljs-type">bool</span> front_face;
<span class="line"></span>    ...</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_hit-record-uv">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;23:</b> <kbd>[hittable.h]</kbd> Adding <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-470" style="width: 1.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.502em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.552em, 1001.5em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-471"><span class="mi" id="MathJax-Span-472" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-473" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-474" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>,</mo><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-55">u,v</script> coordinates to the <code>hit_record</code></div></center>
<p>


We will also need to compute <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-475" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.15em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-476"><span class="mo" id="MathJax-Span-477" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-478" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-479" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-480" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span><span class="mo" id="MathJax-Span-481" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-56">(u,v)</script> texture coordinates for a given point on each type of
<code>hittable</code>.

</p>
<a class="target" name="solidtextures:acheckertexture">&nbsp;</a><a class="target" name="texturemapping/solidtextures:acheckertexture">&nbsp;</a><a class="target" name="toc4.2">&nbsp;</a><h2>Solid Textures: A Checker Texture</h2>
<p>

A solid (or spatial) texture depends only on the position of each point in 3D space. You can think
of a solid texture as if it's coloring all of the points in space itself, instead of coloring a
given object in that space. For this reason, the object can move through the colors of the texture
as it changes position, though usually you would to fix the relationship between the object and the
solid texture.

</p><p>

To explore spatial textures, we'll implement a spatial <code>checker_texture</code> class, which implements a
three-dimensional checker pattern. Since a spatial texture function is driven by a given position in
space, the texture <code>value()</code> function ignores the <code>u</code> and <code>v</code> parameters, and uses only the <code>p</code>
parameter.

</p><p>

To accomplish the checkered pattern, we'll first compute the floor of each component of the input
point. We could truncate the coordinates, but that would pull values toward zero, which would give
us the same color on both sides of zero. The floor function will always shift values to the integer
value on the left (toward negative infinity). Given these three integer results
(<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x230A;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x230B;&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x230A;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x230B;&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x230A;&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x230B;&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-482" style="width: 6.353em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.053em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1004.9em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-483"><span class="mo" id="MathJax-Span-484" style="font-family: MathJax_Main;">⌊</span><span class="mi" id="MathJax-Span-485" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-486" style="font-family: MathJax_Main;">⌋</span><span class="mo" id="MathJax-Span-487" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-488" style="font-family: MathJax_Main; padding-left: 0.152em;">⌊</span><span class="mi" id="MathJax-Span-489" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-490" style="font-family: MathJax_Main;">⌋</span><span class="mo" id="MathJax-Span-491" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-492" style="font-family: MathJax_Main; padding-left: 0.152em;">⌊</span><span class="mi" id="MathJax-Span-493" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-494" style="font-family: MathJax_Main;">⌋</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">⌊</mo><mi>x</mi><mo fence="false" stretchy="false">⌋</mo><mo>,</mo><mo fence="false" stretchy="false">⌊</mo><mi>y</mi><mo fence="false" stretchy="false">⌋</mo><mo>,</mo><mo fence="false" stretchy="false">⌊</mo><mi>z</mi><mo fence="false" stretchy="false">⌋</mo></math></span></span><script type="math/tex" id="MathJax-Element-57">\lfloor x \rfloor, \lfloor y \rfloor, \lfloor z \rfloor</script>) we take their sum and compute the
result modulo two, which gives us either 0 or 1. Zero maps to the even color, and one to the odd
color.

</p><p>

Finally, we add a scaling factor to the texture, to allow us to control the size of the checker
pattern in the scene.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">checker_texture</span> : <span class="hljs-keyword">public</span> texture {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">checker_texture</span>(<span class="hljs-type">double</span> _scale, shared_ptr&lt;texture&gt; _even, shared_ptr&lt;texture&gt; _odd)
<span class="line"></span>      : <span class="hljs-built_in">inv_scale</span>(<span class="hljs-number">1.0</span> / _scale), <span class="hljs-built_in">even</span>(_even), <span class="hljs-built_in">odd</span>(_odd) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">checker_texture</span>(<span class="hljs-type">double</span> _scale, color c1, color c2)
<span class="line"></span>      : <span class="hljs-built_in">inv_scale</span>(<span class="hljs-number">1.0</span> / _scale),
<span class="line"></span>        <span class="hljs-built_in">even</span>(<span class="hljs-built_in">make_shared</span>&lt;solid_color&gt;(c1)),
<span class="line"></span>        <span class="hljs-built_in">odd</span>(<span class="hljs-built_in">make_shared</span>&lt;solid_color&gt;(c2))
<span class="line"></span>    {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">value</span><span class="hljs-params">(<span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">auto</span> xInteger = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(std::<span class="hljs-built_in">floor</span>(inv_scale * p.<span class="hljs-built_in">x</span>()));
<span class="line"></span>        <span class="hljs-keyword">auto</span> yInteger = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(std::<span class="hljs-built_in">floor</span>(inv_scale * p.<span class="hljs-built_in">y</span>()));
<span class="line"></span>        <span class="hljs-keyword">auto</span> zInteger = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(std::<span class="hljs-built_in">floor</span>(inv_scale * p.<span class="hljs-built_in">z</span>()));
<span class="line"></span>
<span class="line"></span>        <span class="hljs-type">bool</span> isEven = (xInteger + yInteger + zInteger) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> isEven ? even-&gt;<span class="hljs-built_in">value</span>(u, v, p) : odd-&gt;<span class="hljs-built_in">value</span>(u, v, p);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    <span class="hljs-type">double</span> inv_scale;
<span class="line"></span>    shared_ptr&lt;texture&gt; even;
<span class="line"></span>    shared_ptr&lt;texture&gt; odd;
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_checker-texture">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;24:</b> <kbd>[texture.h]</kbd> Checkered texture</div></center>
<p>


Those checker odd/even parameters can point to a constant texture or to some other procedural
texture. This is in the spirit of shader networks introduced by Pat Hanrahan back in the 1980s.

</p><p>

</p><div class="together">
If we add this to our <code>random_scene()</code> function’s base sphere:

<p></p><pre class="listing tilde"><code><span class="line"></span>...<div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"texture.h"</span></span></div><span class="line"></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">random_spheres</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">auto</span> checker = <span class="hljs-built_in">make_shared</span>&lt;checker_texture&gt;(<span class="hljs-number">0.32</span>, <span class="hljs-built_in">color</span>(<span class="hljs-number">.2</span>, <span class="hljs-number">.3</span>, <span class="hljs-number">.1</span>), <span class="hljs-built_in">color</span>(<span class="hljs-number">.9</span>, <span class="hljs-number">.9</span>, <span class="hljs-number">.9</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">-1000</span>,<span class="hljs-number">0</span>), <span class="hljs-number">1000</span>, <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(checker)));</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> a = <span class="hljs-number">-11</span>; a &lt; <span class="hljs-number">11</span>; a++) {
<span class="line"></span>    ...
<span class="line"></span>}
<span class="line"></span>...</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_checker-example">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;25:</b> <kbd>[main.cc]</kbd> Checkered texture in use</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
We get:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.02-checker-ground.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.02-checker-ground.png"></a><center><span class="imagecaption"><span class="num">Image 2:</span> Spheres on checkered ground
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="renderingthesolidcheckertexture">&nbsp;</a><a class="target" name="texturemapping/renderingthesolidcheckertexture">&nbsp;</a><a class="target" name="toc4.3">&nbsp;</a><h2>Rendering The Solid Checker Texture</h2>
<p>

We're going to add a second scene to our program, and will add more scenes after that as we progress
through this book. To help with this, we'll set up a switch statement to select the desired scene
for a given run. It's a crude approach, but we're trying to keep things dead simple and focus on the
raytracing. You may want to use a different approach in your own raytracer, such as supporting
command-line arguments.

</p><p>

</p><div class="together">
Here's what our main.cc looks like after refactoring for our single random spheres scene. Rename
<code>main()</code> to <code>random_spheres()</code>, and add a new <code>main()</code> function to call it:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"camera.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"color.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable_list.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"material.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"sphere.h"</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">random_spheres</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> ground_material = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">-1000</span>,<span class="hljs-number">0</span>), <span class="hljs-number">1000</span>, ground_material));
<span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    <span class="hljs-built_in">random_spheres</span>();
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-scenes">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;26:</b> <kbd>[main.cc]</kbd> Main dispatching to selected scene</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Now add a scene with two checkered spheres, one atop the other.

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"camera.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"color.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable_list.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"material.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"sphere.h"</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">random_spheres</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">two_spheres</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> checker = <span class="hljs-built_in">make_shared</span>&lt;checker_texture&gt;(<span class="hljs-number">0.8</span>, <span class="hljs-built_in">color</span>(<span class="hljs-number">.2</span>, <span class="hljs-number">.3</span>, <span class="hljs-number">.1</span>), <span class="hljs-built_in">color</span>(<span class="hljs-number">.9</span>, <span class="hljs-number">.9</span>, <span class="hljs-number">.9</span>));
<span class="line"></span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">-10</span>, <span class="hljs-number">0</span>), <span class="hljs-number">10</span>, <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(checker)));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>), <span class="hljs-number">10</span>, <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(checker)));
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>
<span class="line"></span>    cam.vfov     = <span class="hljs-number">20</span>;
<span class="line"></span>    cam.lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">13</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>);
<span class="line"></span>    cam.lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>    cam.vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.defocus_angle = <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">switch</span> (<span class="hljs-number">2</span>) {
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-built_in">random_spheres</span>(); <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-built_in">two_spheres</span>();    <span class="hljs-keyword">break</span>;
<span class="line"></span>    }</div><span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-two-spheres">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;27:</b> <kbd>[main.cc]</kbd> Two textured spheres</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
We get this result:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.03-checker-spheres.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.03-checker-spheres.png"></a><center><span class="imagecaption"><span class="num">Image 3:</span> Checkered spheres
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

You may think the result looks a bit odd. Since <code>checker_texture</code> is a spatial texture, we're really
looking at the surface of the sphere cutting through the three-dimensional checker space. There are
many situations where this is perfect, or at least sufficient. In many other situations, we really
want to get a consistent effect on the surface of our objects. That approach is covered next.

</p>
<a class="target" name="texturecoordinatesforspheres">&nbsp;</a><a class="target" name="texturemapping/texturecoordinatesforspheres">&nbsp;</a><a class="target" name="toc4.4">&nbsp;</a><h2>Texture Coordinates for Spheres</h2>
<p>

Constant-color textures use no coordinates. Solid (or spatial) textures use the coordinates of a
point in space. Now it's time to make use of the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-495" style="width: 1.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.502em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.552em, 1001.5em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-496"><span class="mi" id="MathJax-Span-497" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-498" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-499" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>,</mo><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-58">u,v</script> texture coordinates. These coordinates
specify the location on 2D source image (or in some 2D parameterized space). To get this, we need a
way to find the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-500" style="width: 1.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.502em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.552em, 1001.5em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-501"><span class="mi" id="MathJax-Span-502" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-503" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-504" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>,</mo><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-59">u,v</script> coordinates of any point on the surface of a 3D object. This mapping is
completely arbitrary, but generally you'd like to cover the entire surface, and be able to scale,
orient and stretch the 2D image in a way that makes some sense. We'll start with deriving a scheme
to get the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-505" style="width: 1.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.502em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.552em, 1001.5em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-506"><span class="mi" id="MathJax-Span-507" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-508" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-509" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi><mo>,</mo><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-60">u,v</script> coordinates of a sphere.

</p><p>

For spheres, texture coordinates are usually based on some form of longitude and latitude, <em class="underscore">i.e.</em>,
spherical coordinates. So we compute <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-510" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.15em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-511"><span class="mo" id="MathJax-Span-512" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-513" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-514" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-515" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">ϕ</span><span class="mo" id="MathJax-Span-516" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>ϕ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-61">(\theta,\phi)</script> in spherical coordinates, where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-517" style="width: 0.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.453em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.45em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-518"><span class="mi" id="MathJax-Span-519" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-62">\theta</script> is the
angle up from the bottom pole (that is, up from -Y), and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-520" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.6em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-521"><span class="mi" id="MathJax-Span-522" style="font-family: MathJax_Math-italic;">ϕ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϕ</mi></math></span></span><script type="math/tex" id="MathJax-Element-63">\phi</script> is the angle around the Y-axis (from
-X to +Z to +X to -Z back to -X).

</p><p>

We want to map <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-523" style="width: 0.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.453em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.45em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-524"><span class="mi" id="MathJax-Span-525" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-64">\theta</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-526" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.6em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-527"><span class="mi" id="MathJax-Span-528" style="font-family: MathJax_Math-italic;">ϕ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϕ</mi></math></span></span><script type="math/tex" id="MathJax-Element-65">\phi</script> to texture coordinates <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-529" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.55em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-530"><span class="mi" id="MathJax-Span-531" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math></span></span><script type="math/tex" id="MathJax-Element-66">u</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-532" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-533"><span class="mi" id="MathJax-Span-534" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-67">v</script> each in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-535" style="width: 2.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.002em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1001.9em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-536"><span class="mo" id="MathJax-Span-537" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-538" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-539" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-540" style="font-family: MathJax_Main; padding-left: 0.152em;">1</span><span class="mo" id="MathJax-Span-541" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-68">[0,1]</script>, where
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-542" style="width: 7.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.053em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1005.95em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-543"><span class="mo" id="MathJax-Span-544" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-545" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-546" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-547" style="font-family: MathJax_Main; padding-left: 0.302em;">0</span><span class="mo" id="MathJax-Span-548" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-549" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span><span class="mo" id="MathJax-Span-550" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-551" style="font-family: MathJax_Main; padding-left: 0.302em;">0</span><span class="mo" id="MathJax-Span-552" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>u</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>v</mi><mo>=</mo><mn>0</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-69">(u=0,v=0)</script> maps to the bottom-left corner of the texture. Thus the normalization from
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-553" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.15em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-554"><span class="mo" id="MathJax-Span-555" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-556" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-557" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-558" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">ϕ</span><span class="mo" id="MathJax-Span-559" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>ϕ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-70">(\theta,\phi)</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-560" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.15em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-561"><span class="mo" id="MathJax-Span-562" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-563" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-564" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-565" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span><span class="mo" id="MathJax-Span-566" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-71">(u,v)</script> would be:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-567" style="width: 4.202em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.802em, 1003.35em, 3.152em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-568"><span class="mi" id="MathJax-Span-569" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-570" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-571" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.152em, 1000.6em, 4.353em, -999.998em); top: -4.697em; left: 50%; margin-left: -0.297em;"><span class="mi" id="MathJax-Span-572" style="font-family: MathJax_Math-italic;">ϕ</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.202em, 1001.05em, 4.152em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.547em;"><span class="mrow" id="MathJax-Span-573"><span class="mn" id="MathJax-Span-574" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-575" style="font-family: MathJax_Math-italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1001.2em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.203em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.691em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>u</mi><mo>=</mo><mfrac><mi>ϕ</mi><mrow><mn>2</mn><mi>π</mi></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-72"> u = \frac{\phi}{2\pi} </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-576" style="width: 3.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.752em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.753em, 1002.75em, 3.152em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-577"><span class="mi" id="MathJax-Span-578" style="font-family: MathJax_Math-italic;">v</span><span class="mo" id="MathJax-Span-579" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-580" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 0.703em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.152em, 1000.45em, 4.152em, -999.998em); top: -4.697em; left: 50%; margin-left: -0.247em;"><span class="mi" id="MathJax-Span-581" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.402em, 1000.55em, 4.152em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.297em;"><span class="mi" id="MathJax-Span-582" style="font-family: MathJax_Math-italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1000.7em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.703em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.753em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>v</mi><mo>=</mo><mfrac><mi>θ</mi><mi>π</mi></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-73"> v = \frac{\theta}{\pi} </script>

</p><p>

To compute <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-583" style="width: 0.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.453em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.45em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-584"><span class="mi" id="MathJax-Span-585" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-74">\theta</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-586" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.6em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-587"><span class="mi" id="MathJax-Span-588" style="font-family: MathJax_Math-italic;">ϕ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϕ</mi></math></span></span><script type="math/tex" id="MathJax-Element-75">\phi</script> for a given point on the unit sphere centered at the origin, we start
with the equations for the corresponding Cartesian coordinates:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-76-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left right left right left right left right left right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mspace width=&quot;1em&quot; /&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-589" style="width: 10.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(-1.248em, 1008.4em, 2.802em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-590"><span class="mtable" id="MathJax-Span-591"><span style="display: inline-block; position: relative; width: 8.203em; height: 0px; margin-right: 0.152em; margin-left: 0.152em;"><span style="position: absolute; clip: rect(2.252em, 1000.5em, 5.702em, -999.998em); top: -4.147em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -5.298em; right: 0em;"><span class="mtd" id="MathJax-Span-592"><span class="mrow" id="MathJax-Span-593"><span class="mi" id="MathJax-Span-594" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.948em; right: 0em;"><span class="mtd" id="MathJax-Span-605"><span class="mrow" id="MathJax-Span-606"><span class="mi" id="MathJax-Span-607" style="font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -2.598em; right: 0em;"><span class="mtd" id="MathJax-Span-623"><span class="mrow" id="MathJax-Span-624"><span class="mi" id="MathJax-Span-625" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.152em;"></span></span><span style="position: absolute; clip: rect(2.502em, 1007.55em, 6.503em, -999.998em); top: -4.697em; left: 0.552em;"><span style="display: inline-block; position: relative; width: 7.653em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1004.8em, 4.402em, -999.998em); top: -5.298em; left: 0em;"><span class="mtd" id="MathJax-Span-595"><span class="mrow" id="MathJax-Span-596"><span class="mi" id="MathJax-Span-597"></span><span class="mo" id="MathJax-Span-598" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-599" style="font-family: MathJax_Main; padding-left: 0.302em;">−</span><span class="mi" id="MathJax-Span-600" style="font-family: MathJax_Main; padding-left: 0.152em;">cos</span><span class="mo" id="MathJax-Span-601"></span><span class="mo" id="MathJax-Span-602" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-603" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-604" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.103em, 1007.55em, 4.402em, -999.998em); top: -3.948em; left: 0em;"><span class="mtd" id="MathJax-Span-608"><span class="mrow" id="MathJax-Span-609"><span class="mi" id="MathJax-Span-610"></span><span class="mo" id="MathJax-Span-611" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-612" style="font-family: MathJax_Main; padding-left: 0.302em;">−</span><span class="mi" id="MathJax-Span-613" style="font-family: MathJax_Main; padding-left: 0.152em;">cos</span><span class="mo" id="MathJax-Span-614"></span><span class="mo" id="MathJax-Span-615" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-616" style="font-family: MathJax_Math-italic;">ϕ</span><span class="mo" id="MathJax-Span-617" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-618" style="font-family: MathJax_Main; padding-left: 0.152em;">sin</span><span class="mo" id="MathJax-Span-619"></span><span class="mo" id="MathJax-Span-620" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-621" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-622" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.103em, 1007.5em, 4.402em, -999.998em); top: -2.598em; left: 0em;"><span class="mtd" id="MathJax-Span-626"><span class="mrow" id="MathJax-Span-627"><span class="mi" id="MathJax-Span-628"></span><span class="mo" id="MathJax-Span-629" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mspace" id="MathJax-Span-630" style="height: 0em; vertical-align: 0em; width: 1.002em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-631" style="font-family: MathJax_Main; padding-left: 0.302em;">sin</span><span class="mo" id="MathJax-Span-632"></span><span class="mo" id="MathJax-Span-633" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-634" style="font-family: MathJax_Math-italic;">ϕ</span><span class="mo" id="MathJax-Span-635" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-636" style="font-family: MathJax_Main; padding-left: 0.152em;">sin</span><span class="mo" id="MathJax-Span-637"></span><span class="mo" id="MathJax-Span-638" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-639" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-640" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.702em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.122em; border-left: 0px solid; width: 0px; height: 4.816em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mtr><mtd><mi>y</mi></mtd><mtd><mi></mi><mo>=</mo><mo>−</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><mi>x</mi></mtd><mtd><mi></mi><mo>=</mo><mo>−</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>ϕ</mi><mo stretchy="false">)</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><mi>z</mi></mtd><mtd><mi></mi><mo>=</mo><mspace width="1em"></mspace><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>ϕ</mi><mo stretchy="false">)</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-76"> \begin{align*}
      y &= -\cos(\theta)            \\
      x &= -\cos(\phi) \sin(\theta) \\
      z &= \quad\sin(\phi) \sin(\theta)
     \end{align*}
  </script>

</p><p>

We need to invert these equations to solve for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-77-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-641" style="width: 0.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.453em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.45em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-642"><span class="mi" id="MathJax-Span-643" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-77">\theta</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-78-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-644" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.6em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-645"><span class="mi" id="MathJax-Span-646" style="font-family: MathJax_Math-italic;">ϕ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϕ</mi></math></span></span><script type="math/tex" id="MathJax-Element-78">\phi</script>. Because of the lovely <code>&lt;cmath&gt;</code>
function <code>atan2()</code>, which takes any pair of numbers proportional to sine and cosine and returns the
angle, we can pass in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-79-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-647" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-648"><span class="mi" id="MathJax-Span-649" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-79">x</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-650" style="width: 0.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.453em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.45em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-651"><span class="mi" id="MathJax-Span-652" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-80">z</script> (the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-653" style="width: 3.152em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.502em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.4em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-654"><span class="mi" id="MathJax-Span-655" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-656"></span><span class="mo" id="MathJax-Span-657" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-658" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-659" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-81">\sin(\theta)</script> cancel) to solve for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-660" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.6em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-661"><span class="mi" id="MathJax-Span-662" style="font-family: MathJax_Math-italic;">ϕ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϕ</mi></math></span></span><script type="math/tex" id="MathJax-Element-82">\phi</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;atan2&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-663" style="width: 9.353em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.453em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1007.35em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-664"><span class="mi" id="MathJax-Span-665" style="font-family: MathJax_Math-italic;">ϕ</span><span class="mo" id="MathJax-Span-666" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-667" style="font-family: MathJax_Main; padding-left: 0.302em;">atan2</span><span class="mo" id="MathJax-Span-668"></span><span class="mo" id="MathJax-Span-669" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-670" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-671" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-672" style="font-family: MathJax_Main; padding-left: 0.152em;">−</span><span class="mi" id="MathJax-Span-673" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-674" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>ϕ</mi><mo>=</mo><mi>atan2</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>z</mi><mo>,</mo><mo>−</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-83"> \phi = \operatorname{atan2}(z, -x) </script>

</p><p>

<code>atan2()</code> returns values in the range <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-84-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-675" style="width: 1.702em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1001.35em, 2.402em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-676"><span class="mo" id="MathJax-Span-677" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-678" style="font-family: MathJax_Math-italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mi>π</mi></math></span></span><script type="math/tex" id="MathJax-Element-84">-\pi</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-85-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-679" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.55em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-680"><span class="mi" id="MathJax-Span-681" style="font-family: MathJax_Math-italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>π</mi></math></span></span><script type="math/tex" id="MathJax-Element-85">\pi</script>, but they go from 0 to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-86-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-682" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.55em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-683"><span class="mi" id="MathJax-Span-684" style="font-family: MathJax_Math-italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>π</mi></math></span></span><script type="math/tex" id="MathJax-Element-86">\pi</script>, then flip to
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-87-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-685" style="width: 1.702em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1001.35em, 2.402em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-686"><span class="mo" id="MathJax-Span-687" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-688" style="font-family: MathJax_Math-italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mi>π</mi></math></span></span><script type="math/tex" id="MathJax-Element-87">-\pi</script> and proceed back to zero. While this is mathematically correct, we want <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-88-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-689" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.55em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-690"><span class="mi" id="MathJax-Span-691" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math></span></span><script type="math/tex" id="MathJax-Element-88">u</script> to range from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-89-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-692" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.45em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-693"><span class="mn" id="MathJax-Span-694" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-89">0</script>
to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-90-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-695" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.45em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-696"><span class="mn" id="MathJax-Span-697" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-90">1</script>, not from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-91-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-698" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.45em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-699"><span class="mn" id="MathJax-Span-700" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-91">0</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-92-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-701" style="width: 1.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.502em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1001.45em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-702"><span class="mn" id="MathJax-Span-703" style="font-family: MathJax_Main;">1</span><span class="texatom" id="MathJax-Span-704"><span class="mrow" id="MathJax-Span-705"><span class="mo" id="MathJax-Span-706" style="font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-707" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-92">1/2</script> and then from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-93-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-708" style="width: 2.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.302em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.25em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-709"><span class="mo" id="MathJax-Span-710" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-711" style="font-family: MathJax_Main;">1</span><span class="texatom" id="MathJax-Span-712"><span class="mrow" id="MathJax-Span-713"><span class="mo" id="MathJax-Span-714" style="font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-715" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mn>1</mn><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-93">-1/2</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-94-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-716" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.45em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-717"><span class="mn" id="MathJax-Span-718" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-94">0</script>. Fortunately,

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-95-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;atan2&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;atan2&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-719" style="width: 17.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.203em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1014.15em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-720"><span class="mi" id="MathJax-Span-721" style="font-family: MathJax_Main;">atan2</span><span class="mo" id="MathJax-Span-722"></span><span class="mo" id="MathJax-Span-723" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-724" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-725" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-726" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">b</span><span class="mo" id="MathJax-Span-727" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-728" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-729" style="font-family: MathJax_Main; padding-left: 0.302em;">atan2</span><span class="mo" id="MathJax-Span-730"></span><span class="mo" id="MathJax-Span-731" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-732" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-733" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-734" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-735" style="font-family: MathJax_Main; padding-left: 0.152em;">−</span><span class="mi" id="MathJax-Span-736" style="font-family: MathJax_Math-italic;">b</span><span class="mo" id="MathJax-Span-737" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-738" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-739" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-740" style="font-family: MathJax_Main;">,</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>atan2</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mi>atan2</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo>−</mo><mi>a</mi><mo>,</mo><mo>−</mo><mi>b</mi><mo stretchy="false">)</mo><mo>+</mo><mi>π</mi><mo>,</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-95"> \operatorname{atan2}(a,b) = \operatorname{atan2}(-a,-b) + \pi, </script>

</p><p>

and the second formulation yields values from <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-96-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-741" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.45em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-742"><span class="mn" id="MathJax-Span-743" style="font-family: MathJax_Main;">0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-96">0</script> continuously to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-97-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-744" style="width: 1.353em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.052em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1001.05em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-745"><span class="mn" id="MathJax-Span-746" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-747" style="font-family: MathJax_Math-italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mi>π</mi></math></span></span><script type="math/tex" id="MathJax-Element-97">2\pi</script>. Thus, we can compute
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-98-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-748" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.6em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-749"><span class="mi" id="MathJax-Span-750" style="font-family: MathJax_Math-italic;">ϕ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϕ</mi></math></span></span><script type="math/tex" id="MathJax-Element-98">\phi</script> as

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-99-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;atan2&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-751" style="width: 11.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.203em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1009.2em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-752"><span class="mi" id="MathJax-Span-753" style="font-family: MathJax_Math-italic;">ϕ</span><span class="mo" id="MathJax-Span-754" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-755" style="font-family: MathJax_Main; padding-left: 0.302em;">atan2</span><span class="mo" id="MathJax-Span-756"></span><span class="mo" id="MathJax-Span-757" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-758" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-759" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-760" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-761" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">x</span><span class="mo" id="MathJax-Span-762" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-763" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-764" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>ϕ</mi><mo>=</mo><mi>atan2</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo>−</mo><mi>z</mi><mo>,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>π</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-99"> \phi = \operatorname{atan2}(-z, x) + \pi </script>

</p><p>

The derivation for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-100-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-765" style="width: 0.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.453em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.45em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-766"><span class="mi" id="MathJax-Span-767" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-100">\theta</script> is more straightforward:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-101-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;arccos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-768" style="width: 8.203em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.553em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1006.45em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-769"><span class="mi" id="MathJax-Span-770" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-771" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-772" style="font-family: MathJax_Main; padding-left: 0.302em;">arccos</span><span class="mo" id="MathJax-Span-773"></span><span class="mo" id="MathJax-Span-774" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-775" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-776" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-777" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>θ</mi><mo>=</mo><mi>arccos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo>−</mo><mi>y</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-101"> \theta = \arccos(-y) </script>

</p><p>

</p><div class="together">
So for a sphere, the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-102-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-778" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.15em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-779"><span class="mo" id="MathJax-Span-780" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-781" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-782" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-783" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span><span class="mo" id="MathJax-Span-784" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-102">(u,v)</script> coord computation is accomplished by a utility function that takes
points on the unit sphere centered at the origin, and computes <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-103-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-785" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.55em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-786"><span class="mi" id="MathJax-Span-787" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math></span></span><script type="math/tex" id="MathJax-Element-103">u</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-104-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-788" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-789"><span class="mi" id="MathJax-Span-790" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-104">v</script>:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">sphere</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  ...
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...<div class=" highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">get_sphere_uv</span><span class="hljs-params">(<span class="hljs-type">const</span> point3&amp; p, <span class="hljs-type">double</span>&amp; u, <span class="hljs-type">double</span>&amp; v)</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// p: a given point on the sphere of radius one, centered at the origin.</span>
<span class="line"></span>        <span class="hljs-comment">// u: returned value [0,1] of angle around the Y axis from X=-1.</span>
<span class="line"></span>        <span class="hljs-comment">// v: returned value [0,1] of angle from Y=-1 to Y=+1.</span>
<span class="line"></span>        <span class="hljs-comment">//     &lt;1 0 0&gt; yields &lt;0.50 0.50&gt;       &lt;-1  0  0&gt; yields &lt;0.00 0.50&gt;</span>
<span class="line"></span>        <span class="hljs-comment">//     &lt;0 1 0&gt; yields &lt;0.50 1.00&gt;       &lt; 0 -1  0&gt; yields &lt;0.50 0.00&gt;</span>
<span class="line"></span>        <span class="hljs-comment">//     &lt;0 0 1&gt; yields &lt;0.25 0.50&gt;       &lt; 0  0 -1&gt; yields &lt;0.75 0.50&gt;</span>
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> theta = <span class="hljs-built_in">acos</span>(-p.<span class="hljs-built_in">y</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> phi = <span class="hljs-built_in">atan2</span>(-p.<span class="hljs-built_in">z</span>(), p.<span class="hljs-built_in">x</span>()) + pi;
<span class="line"></span>
<span class="line"></span>        u = phi / (<span class="hljs-number">2</span>*pi);
<span class="line"></span>        v = theta / pi;
<span class="line"></span>    }</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_get-sphere-uv">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;28:</b> <kbd>[sphere.h]</kbd> get_sphere_uv function</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Update the <code>sphere::hit()</code> function to use this function to update the hit record UV coordinates.

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">sphere</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        ...
<span class="line"></span>
<span class="line"></span>        rec.t = root;
<span class="line"></span>        rec.p = r.<span class="hljs-built_in">at</span>(rec.t);
<span class="line"></span>        vec3 outward_normal = (rec.p - center) / radius;
<span class="line"></span>        rec.<span class="hljs-built_in">set_face_normal</span>(r, outward_normal);<div class=" highlight"><span class="line"></span>        <span class="hljs-built_in">get_sphere_uv</span>(outward_normal, rec.u, rec.v);</div><span class="line"></span>        rec.mat = mat;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_get-sphere-uv-call">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;29:</b> <kbd>[sphere.h]</kbd> Sphere UV coordinates from hit</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Now we can make textured materials by replacing the <code>const color&amp; a</code> with a texture pointer:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"texture.h"</span></span></div><span class="line"></span>
<span class="line"></span>...
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">lambertian</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>  <span class="hljs-keyword">public</span>:<div class=" highlight"><span class="line"></span>    <span class="hljs-built_in">lambertian</span>(<span class="hljs-type">const</span> color&amp; a) : <span class="hljs-built_in">albedo</span>(<span class="hljs-built_in">make_shared</span>&lt;solid_color&gt;(a)) {}
<span class="line"></span>    <span class="hljs-built_in">lambertian</span>(shared_ptr&lt;texture&gt; a) : <span class="hljs-built_in">albedo</span>(a) {}</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">auto</span> scatter_direction = rec.normal + <span class="hljs-built_in">random_unit_vector</span>();
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Catch degenerate scatter direction</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (scatter_direction.<span class="hljs-built_in">near_zero</span>())
<span class="line"></span>            scatter_direction = rec.normal;
<span class="line"></span>
<span class="line"></span>        scattered = <span class="hljs-built_in">ray</span>(rec.p, scatter_direction, r_in.<span class="hljs-built_in">time</span>());<div class=" highlight"><span class="line"></span>        attenuation = albedo-&gt;<span class="hljs-built_in">value</span>(rec.u, rec.v, rec.p);</div><span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:<div class=" highlight"><span class="line"></span>    shared_ptr&lt;texture&gt; albedo;</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_lambertian-textured">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;30:</b> <kbd>[material.h]</kbd> Lambertian material with texture</div></center>
<p>


</p></div>

<p></p><p>

From the hitpoint <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-105-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-791" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-792"><span class="texatom" id="MathJax-Span-793"><span class="mrow" id="MathJax-Span-794"><span class="mi" id="MathJax-Span-795" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-105">\mathbf{P}</script>, we compute the surface coordinates <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-106-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-796" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.15em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-797"><span class="mo" id="MathJax-Span-798" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-799" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-800" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-801" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span><span class="mo" id="MathJax-Span-802" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-106">(u,v)</script>. We then use these to
index into our procedural solid texture (like marble). We can also read in an image and use the
2D <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-107-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-803" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.15em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-804"><span class="mo" id="MathJax-Span-805" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-806" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-807" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-808" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span><span class="mo" id="MathJax-Span-809" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-107">(u,v)</script> texture coordinate to index into the image.

</p><p>

A direct way to use scaled <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-108-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-810" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.15em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-811"><span class="mo" id="MathJax-Span-812" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-813" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-814" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-815" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span><span class="mo" id="MathJax-Span-816" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-108">(u,v)</script> in an image is to round the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-109-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-817" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.55em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-818"><span class="mi" id="MathJax-Span-819" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math></span></span><script type="math/tex" id="MathJax-Element-109">u</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-110-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-820" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-821"><span class="mi" id="MathJax-Span-822" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-110">v</script> to integers, and use that
as <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-111-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-823" style="width: 2.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1001.85em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-824"><span class="mo" id="MathJax-Span-825" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-826" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-827" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-828" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">j</span><span class="mo" id="MathJax-Span-829" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-111">(i,j)</script> pixels. This is awkward, because we don’t want to have to change the code when we change
image resolution. So instead, one of the the most universal unofficial standards in graphics is to
use texture coordinates instead of image pixel coordinates. These are just some form of fractional
position in the image. For example, for pixel <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-112-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-830" style="width: 2.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1001.85em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-831"><span class="mo" id="MathJax-Span-832" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-833" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-834" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-835" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">j</span><span class="mo" id="MathJax-Span-836" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-112">(i,j)</script> in an <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-113-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-837" style="width: 1.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.302em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.152em, 1001.3em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-838"><span class="msubsup" id="MathJax-Span-839"><span style="display: inline-block; position: relative; width: 1.302em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.9em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-840" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.802em;"><span class="mi" id="MathJax-Span-841" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>N</mi><mi>x</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-113">N_x</script> by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-114-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-842" style="width: 1.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.152em, 1001.25em, 1.453em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-843"><span class="msubsup" id="MathJax-Span-844"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.9em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-845" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.802em;"><span class="mi" id="MathJax-Span-846" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>N</mi><mi>y</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-114">N_y</script> image, the image texture
position is:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-115-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-847" style="width: 6.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.802em, 1005.25em, 3.302em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-848"><span class="mi" id="MathJax-Span-849" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-850" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-851" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 3.103em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.202em, 1000.3em, 4.152em, -999.998em); top: -4.697em; left: 50%; margin-left: -0.148em;"><span class="mi" id="MathJax-Span-852" style="font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1002.9em, 4.303em, -999.998em); top: -3.298em; left: 50%; margin-left: -1.498em;"><span class="mrow" id="MathJax-Span-853"><span class="msubsup" id="MathJax-Span-854"><span style="display: inline-block; position: relative; width: 1.302em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.9em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-855" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.802em;"><span class="mi" id="MathJax-Span-856" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-857" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="mn" id="MathJax-Span-858" style="font-family: MathJax_Main; padding-left: 0.202em;">1</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1003.1em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.103em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.878em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>u</mi><mo>=</mo><mfrac><mi>i</mi><mrow><msub><mi>N</mi><mi>x</mi></msub><mo>−</mo><mn>1</mn></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-115"> u = \frac{i}{N_x-1} </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-116-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-859" style="width: 6.403em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.103em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.802em, 1005.1em, 3.452em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-860"><span class="mi" id="MathJax-Span-861" style="font-family: MathJax_Math-italic;">v</span><span class="mo" id="MathJax-Span-862" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-863" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 3.052em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.202em, 1000.4em, 4.353em, -999.998em); top: -4.697em; left: 50%; margin-left: -0.198em;"><span class="mi" id="MathJax-Span-864" style="font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1002.85em, 4.452em, -999.998em); top: -3.298em; left: 50%; margin-left: -1.448em;"><span class="mrow" id="MathJax-Span-865"><span class="msubsup" id="MathJax-Span-866"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.9em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-867" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.802em;"><span class="mi" id="MathJax-Span-868" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-869" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="mn" id="MathJax-Span-870" style="font-family: MathJax_Main; padding-left: 0.202em;">1</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1003.05em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.052em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.309em; border-left: 0px solid; width: 0px; height: 3.003em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>v</mi><mo>=</mo><mfrac><mi>j</mi><mrow><msub><mi>N</mi><mi>y</mi></msub><mo>−</mo><mn>1</mn></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-116"> v = \frac{j}{N_y-1} </script>

</p><p>

This is just a fractional position.

</p>
<a class="target" name="accessingtextureimagedata">&nbsp;</a><a class="target" name="texturemapping/accessingtextureimagedata">&nbsp;</a><a class="target" name="toc4.5">&nbsp;</a><h2>Accessing Texture Image Data</h2>
<p>

Now it's time to create a texture class that holds an image. I am going to use my favorite image
utility, <a href="https://github.com/nothings/stb">stb_image</a>. It reads image data into a big array of unsigned chars. These are just
packed RGBs with each component in the range [0,255] (black to full white). To help make loading our
image files even easier, we provide a helper class to manage all this — <code>rtw_image</code>. The following
listing assumes that you have copied the <code>stb_image.h</code> header into a folder called <code>external</code>.
Adjust according to your directory structure.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> RTW_STB_IMAGE_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> RTW_STB_IMAGE_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-comment">// Disable strict warnings for this header from the Microsoft Visual C++ compiler.</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _MSC_VER</span>
<span class="line"></span>    <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> <span class="hljs-keyword">warning</span> (push, 0)</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> STB_IMAGE_IMPLEMENTATION</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> STBI_FAILURE_USERMSG</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"external/stb_image.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">rtw_image</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">rtw_image</span>() : <span class="hljs-built_in">data</span>(<span class="hljs-literal">nullptr</span>) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">rtw_image</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* image_filename) {
<span class="line"></span>        <span class="hljs-comment">// Loads image data from the specified file. If the RTW_IMAGES environment variable is</span>
<span class="line"></span>        <span class="hljs-comment">// defined, looks only in that directory for the image file. If the image was not found,</span>
<span class="line"></span>        <span class="hljs-comment">// searches for the specified image file first from the current directory, then in the</span>
<span class="line"></span>        <span class="hljs-comment">// images/ subdirectory, then the _parent's_ images/ subdirectory, and then _that_</span>
<span class="line"></span>        <span class="hljs-comment">// parent, on so on, for six levels up. If the image was not loaded successfully,</span>
<span class="line"></span>        <span class="hljs-comment">// width() and height() will return 0.</span>
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> filename = std::<span class="hljs-built_in">string</span>(image_filename);
<span class="line"></span>        <span class="hljs-keyword">auto</span> imagedir = <span class="hljs-built_in">getenv</span>(<span class="hljs-string">"RTW_IMAGES"</span>);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Hunt for the image file in some likely locations.</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (imagedir &amp;&amp; <span class="hljs-built_in">load</span>(std::<span class="hljs-built_in">string</span>(imagedir) + <span class="hljs-string">"/"</span> + image_filename)) <span class="hljs-keyword">return</span>;
<span class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">load</span>(filename)) <span class="hljs-keyword">return</span>;
<span class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">load</span>(<span class="hljs-string">"images/"</span> + filename)) <span class="hljs-keyword">return</span>;
<span class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">load</span>(<span class="hljs-string">"../images/"</span> + filename)) <span class="hljs-keyword">return</span>;
<span class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">load</span>(<span class="hljs-string">"../../images/"</span> + filename)) <span class="hljs-keyword">return</span>;
<span class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">load</span>(<span class="hljs-string">"../../../images/"</span> + filename)) <span class="hljs-keyword">return</span>;
<span class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">load</span>(<span class="hljs-string">"../../../../images/"</span> + filename)) <span class="hljs-keyword">return</span>;
<span class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">load</span>(<span class="hljs-string">"../../../../../images/"</span> + filename)) <span class="hljs-keyword">return</span>;
<span class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">load</span>(<span class="hljs-string">"../../../../../../images/"</span> + filename)) <span class="hljs-keyword">return</span>;
<span class="line"></span>
<span class="line"></span>        std::cerr &lt;&lt; <span class="hljs-string">"ERROR: Could not load image file '"</span> &lt;&lt; image_filename &lt;&lt; <span class="hljs-string">"'.\n"</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    ~<span class="hljs-built_in">rtw_image</span>() { <span class="hljs-built_in">STBI_FREE</span>(data); }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">load</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string filename)</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Loads image data from the given file name. Returns true if the load succeeded.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> n = bytes_per_pixel; <span class="hljs-comment">// Dummy out parameter: original components per pixel</span>
<span class="line"></span>        data = <span class="hljs-built_in">stbi_load</span>(filename.<span class="hljs-built_in">c_str</span>(), &amp;image_width, &amp;image_height, &amp;n, bytes_per_pixel);
<span class="line"></span>        bytes_per_scanline = image_width * bytes_per_pixel;
<span class="line"></span>        <span class="hljs-keyword">return</span> data != <span class="hljs-literal">nullptr</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">width</span><span class="hljs-params">()</span>  <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> (data == <span class="hljs-literal">nullptr</span>) ? <span class="hljs-number">0</span> : image_width; }
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">height</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> (data == <span class="hljs-literal">nullptr</span>) ? <span class="hljs-number">0</span> : image_height; }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* <span class="hljs-title">pixel_data</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Return the address of the three bytes of the pixel at x,y (or magenta if no data).</span>
<span class="line"></span>        <span class="hljs-type">static</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> magenta[] = { <span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span> };
<span class="line"></span>        <span class="hljs-keyword">if</span> (data == <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span> magenta;
<span class="line"></span>
<span class="line"></span>        x = <span class="hljs-built_in">clamp</span>(x, <span class="hljs-number">0</span>, image_width);
<span class="line"></span>        y = <span class="hljs-built_in">clamp</span>(y, <span class="hljs-number">0</span>, image_height);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> data + y*bytes_per_scanline + x*bytes_per_pixel;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> bytes_per_pixel = <span class="hljs-number">3</span>;
<span class="line"></span>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *data;
<span class="line"></span>    <span class="hljs-type">int</span> image_width, image_height;
<span class="line"></span>    <span class="hljs-type">int</span> bytes_per_scanline;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">clamp</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> low, <span class="hljs-type">int</span> high)</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Return the value clamped to the range [low, high).</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (x &lt; low) <span class="hljs-keyword">return</span> low;
<span class="line"></span>        <span class="hljs-keyword">if</span> (x &lt; high) <span class="hljs-keyword">return</span> x;
<span class="line"></span>        <span class="hljs-keyword">return</span> high - <span class="hljs-number">1</span>;
<span class="line"></span>    }
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-comment">// Restore MSVC compiler warnings</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _MSC_VER</span>
<span class="line"></span>    <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> <span class="hljs-keyword">warning</span> (pop)</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_rtw_image">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;31:</b> <kbd>[rtw_stb_image.h] The rtw_image helper class</kbd></div></center>
<p>


If you are writing your implementation in a language other than C or C++, you'll need to locate (or
write) an image loading library that provides similar functionality.

</p><p>

</p><div class="together">
The <code>image_texture</code> class uses the <code>rtw_image</code> class:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtw_stb_image.h"</span></span></div><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"perlin.h"</span></span>
<span class="line"></span>
<span class="line"></span>...
<span class="line"></span><div class=" highlight"><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">image_texture</span> : <span class="hljs-keyword">public</span> texture {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">image_texture</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* filename) : <span class="hljs-built_in">image</span>(filename) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">value</span><span class="hljs-params">(<span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// If we have no texture data, then return solid cyan as a debugging aid.</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (image.<span class="hljs-built_in">height</span>() &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Clamp input texture coordinates to [0,1] x [1,0]</span>
<span class="line"></span>        u = <span class="hljs-built_in">interval</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>).<span class="hljs-built_in">clamp</span>(u);
<span class="line"></span>        v = <span class="hljs-number">1.0</span> - <span class="hljs-built_in">interval</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>).<span class="hljs-built_in">clamp</span>(v);  <span class="hljs-comment">// Flip V to image coordinates</span>
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> i = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(u * image.<span class="hljs-built_in">width</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> j = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(v * image.<span class="hljs-built_in">height</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> pixel = image.<span class="hljs-built_in">pixel_data</span>(i,j);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> color_scale = <span class="hljs-number">1.0</span> / <span class="hljs-number">255.0</span>;
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(color_scale*pixel[<span class="hljs-number">0</span>], color_scale*pixel[<span class="hljs-number">1</span>], color_scale*pixel[<span class="hljs-number">2</span>]);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    rtw_image image;
<span class="line"></span>};</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_img-texture">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;32:</b> <kbd>[texture.h]</kbd> Image texture class</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="renderingtheimagetexture">&nbsp;</a><a class="target" name="texturemapping/renderingtheimagetexture">&nbsp;</a><a class="target" name="toc4.6">&nbsp;</a><h2>Rendering The Image Texture</h2>
<p>

I just grabbed a random earth map from the web — any standard projection will do for our purposes.

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/earthmap.jpg" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/earthmap.jpg"></a><center><span class="imagecaption"><span class="num">Image 4:</span> earthmap.jpg</span></center></div></center>

<p></p><p>

</p><div class="together">
Here's the code to read an image from a file and then assign it to a diffuse material:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">earth</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">auto</span> earth_texture = <span class="hljs-built_in">make_shared</span>&lt;image_texture&gt;(<span class="hljs-string">"earthmap.jpg"</span>);
<span class="line"></span>    <span class="hljs-keyword">auto</span> earth_surface = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(earth_texture);
<span class="line"></span>    <span class="hljs-keyword">auto</span> globe = <span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-number">2</span>, earth_surface);
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>
<span class="line"></span>    cam.vfov     = <span class="hljs-number">20</span>;
<span class="line"></span>    cam.lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">12</span>);
<span class="line"></span>    cam.lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>    cam.vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.defocus_angle = <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(<span class="hljs-built_in">hittable_list</span>(globe));
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">switch</span> (<span class="hljs-number">3</span>) {</div><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:  <span class="hljs-built_in">random_spheres</span>(); <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:  <span class="hljs-built_in">two_spheres</span>();    <span class="hljs-keyword">break</span>;<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:  <span class="hljs-built_in">earth</span>();          <span class="hljs-keyword">break</span>;</div><span class="line"></span>    }
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_stbi-load-use">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;33:</b> <kbd>[main.cc]</kbd> Using stbi_load() to load an image</div></center>
<p>


</p></div>

<p></p><p>

We start to see some of the power of all colors being textures — we can assign any kind of texture
to the lambertian material, and lambertian doesn’t need to be aware of it.

</p><p>

If the photo comes back with a large cyan sphere in the middle, then <code>stb_image</code> failed to find your
Earth map photo. The program will look for the file in the same directory as the executable. Make
sure to copy the Earth into your build directory, or rewrite <code>earth()</code> to point somewhere else.

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.05-earth-sphere.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.05-earth-sphere.png"></a><center><span class="imagecaption"><span class="num">Image 5:</span> Earth-mapped sphere
  </span></center></div></center>

<p></p>
<a class="target" name="perlinnoise">&nbsp;</a><a class="target" name="perlinnoise">&nbsp;</a><a class="target" name="toc5">&nbsp;</a><h1>Perlin Noise</h1>
<p>

To get cool looking solid textures most people use some form of Perlin noise. These are named after
their inventor Ken Perlin. Perlin texture doesn’t return white noise like this:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.06-white-noise.jpg" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.06-white-noise.jpg"></a><center><span class="imagecaption"><span class="num">Image 6:</span> White noise</span></center></div></center>

<p></p><p>

</p><div class="together">
Instead it returns something similar to blurred white noise:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.07-white-noise-blurred.jpg" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.07-white-noise-blurred.jpg"></a><center><span class="imagecaption"><span class="num">Image 7:</span> White noise, blurred
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

A key part of Perlin noise is that it is repeatable: it takes a 3D point as input and always returns
the same randomish number. Nearby points return similar numbers. Another important part of Perlin
noise is that it be simple and fast, so it’s usually done as a hack. I’ll build that hack up
incrementally based on Andrew Kensler’s description.

</p>
<a class="target" name="usingblocksofrandomnumbers">&nbsp;</a><a class="target" name="perlinnoise/usingblocksofrandomnumbers">&nbsp;</a><a class="target" name="toc5.1">&nbsp;</a><h2>Using Blocks of Random Numbers</h2>
<p>

We could just tile all of space with a 3D array of random numbers and use them in blocks. You get
something blocky where the repeating is clear:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.08-tile-random.jpg" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.08-tile-random.jpg"></a><center><span class="imagecaption"><span class="num">Image 8:</span> Tiled random patterns
  </span></center></div></center>

<p></p><p>

</p><div class="together">
Let’s just use some sort of hashing to scramble this, instead of tiling. This has a bit of support
code to make it all happen:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> PERLIN_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> PERLIN_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">perlin</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">perlin</span>() {
<span class="line"></span>        ranfloat = <span class="hljs-keyword">new</span> <span class="hljs-type">double</span>[point_count];
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; point_count; ++i) {
<span class="line"></span>            ranfloat[i] = <span class="hljs-built_in">random_double</span>();
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        perm_x = <span class="hljs-built_in">perlin_generate_perm</span>();
<span class="line"></span>        perm_y = <span class="hljs-built_in">perlin_generate_perm</span>();
<span class="line"></span>        perm_z = <span class="hljs-built_in">perlin_generate_perm</span>();
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    ~<span class="hljs-built_in">perlin</span>() {
<span class="line"></span>        <span class="hljs-keyword">delete</span>[] ranfloat;
<span class="line"></span>        <span class="hljs-keyword">delete</span>[] perm_x;
<span class="line"></span>        <span class="hljs-keyword">delete</span>[] perm_y;
<span class="line"></span>        <span class="hljs-keyword">delete</span>[] perm_z;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">noise</span><span class="hljs-params">(<span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">auto</span> i = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">4</span>*p.<span class="hljs-built_in">x</span>()) &amp; <span class="hljs-number">255</span>;
<span class="line"></span>        <span class="hljs-keyword">auto</span> j = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">4</span>*p.<span class="hljs-built_in">y</span>()) &amp; <span class="hljs-number">255</span>;
<span class="line"></span>        <span class="hljs-keyword">auto</span> k = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">4</span>*p.<span class="hljs-built_in">z</span>()) &amp; <span class="hljs-number">255</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> ranfloat[perm_x[i] ^ perm_y[j] ^ perm_z[k]];
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    <span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">int</span> point_count = <span class="hljs-number">256</span>;
<span class="line"></span>    <span class="hljs-type">double</span>* ranfloat;
<span class="line"></span>    <span class="hljs-type">int</span>* perm_x;
<span class="line"></span>    <span class="hljs-type">int</span>* perm_y;
<span class="line"></span>    <span class="hljs-type">int</span>* perm_z;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span>* <span class="hljs-title">perlin_generate_perm</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">auto</span> p = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[point_count];
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; perlin::point_count; i++)
<span class="line"></span>            p[i] = i;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-built_in">permute</span>(p, point_count);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> p;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">permute</span><span class="hljs-params">(<span class="hljs-type">int</span>* p, <span class="hljs-type">int</span> n)</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = n<span class="hljs-number">-1</span>; i &gt; <span class="hljs-number">0</span>; i--) {
<span class="line"></span>            <span class="hljs-type">int</span> target = <span class="hljs-built_in">random_int</span>(<span class="hljs-number">0</span>, i);
<span class="line"></span>            <span class="hljs-type">int</span> tmp = p[i];
<span class="line"></span>            p[i] = p[target];
<span class="line"></span>            p[target] = tmp;
<span class="line"></span>        }
<span class="line"></span>    }
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_perlin">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;34:</b> <kbd>[perlin.h]</kbd> A Perlin texture class and functions</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Now if we create an actual texture that takes these floats between 0 and 1 and creates grey colors:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"perlin.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">noise_texture</span> : <span class="hljs-keyword">public</span> texture {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">noise_texture</span>() {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">value</span><span class="hljs-params">(<span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) * noise.<span class="hljs-built_in">noise</span>(p);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    perlin noise;
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_noise-texture">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;35:</b> <kbd>[texture.h]</kbd> Noise texture</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
We can use that texture on some spheres:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">two_perlin_spheres</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> pertext = <span class="hljs-built_in">make_shared</span>&lt;noise_texture&gt;();
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">-1000</span>,<span class="hljs-number">0</span>), <span class="hljs-number">1000</span>, <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(pertext)));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>), <span class="hljs-number">2</span>, <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(pertext)));
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>
<span class="line"></span>    cam.vfov     = <span class="hljs-number">20</span>;
<span class="line"></span>    cam.lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">13</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>);
<span class="line"></span>    cam.lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>    cam.vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.defocus_angle = <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">switch</span> (<span class="hljs-number">4</span>) {</div><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:  <span class="hljs-built_in">random_spheres</span>();     <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:  <span class="hljs-built_in">two_spheres</span>();        <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:  <span class="hljs-built_in">earth</span>();              <span class="hljs-keyword">break</span>;<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:  <span class="hljs-built_in">two_perlin_spheres</span>(); <span class="hljs-keyword">break</span>;</div><span class="line"></span>    }
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-perlin">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;36:</b> <kbd>[main.cc]</kbd> Scene with two Perlin-textured spheres</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Add the hashing does scramble as hoped:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.09-hash-random.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.09-hash-random.png"></a><center><span class="imagecaption"><span class="num">Image 9:</span> Hashed random texture
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="smoothingouttheresult">&nbsp;</a><a class="target" name="perlinnoise/smoothingouttheresult">&nbsp;</a><a class="target" name="toc5.2">&nbsp;</a><h2>Smoothing out the Result</h2>
<p>

To make it smooth, we can linearly interpolate:

</p><pre class="listing tilde"><code><span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">perlin</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">noise</span><span class="hljs-params">(<span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> </span>{<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> u = p.<span class="hljs-built_in">x</span>() - <span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">x</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> v = p.<span class="hljs-built_in">y</span>() - <span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">y</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> w = p.<span class="hljs-built_in">z</span>() - <span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">z</span>());
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> i = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">x</span>()));
<span class="line"></span>        <span class="hljs-keyword">auto</span> j = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">y</span>()));
<span class="line"></span>        <span class="hljs-keyword">auto</span> k = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">z</span>()));
<span class="line"></span>        <span class="hljs-type">double</span> c[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>][<span class="hljs-number">2</span>];
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> di=<span class="hljs-number">0</span>; di &lt; <span class="hljs-number">2</span>; di++)
<span class="line"></span>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> dj=<span class="hljs-number">0</span>; dj &lt; <span class="hljs-number">2</span>; dj++)
<span class="line"></span>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> dk=<span class="hljs-number">0</span>; dk &lt; <span class="hljs-number">2</span>; dk++)
<span class="line"></span>                    c[di][dj][dk] = ranfloat[
<span class="line"></span>                        perm_x[(i+di) &amp; <span class="hljs-number">255</span>] ^
<span class="line"></span>                        perm_y[(j+dj) &amp; <span class="hljs-number">255</span>] ^
<span class="line"></span>                        perm_z[(k+dk) &amp; <span class="hljs-number">255</span>]
<span class="line"></span>                    ];
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">trilinear_interp</span>(c, u, v, w);</div><span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...<div class=" highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">double</span> <span class="hljs-title">trilinear_interp</span><span class="hljs-params">(<span class="hljs-type">double</span> c[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>][<span class="hljs-number">2</span>], <span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">double</span> w)</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">auto</span> accum = <span class="hljs-number">0.0</span>;
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++)
<span class="line"></span>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>; j &lt; <span class="hljs-number">2</span>; j++)
<span class="line"></span>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k=<span class="hljs-number">0</span>; k &lt; <span class="hljs-number">2</span>; k++)
<span class="line"></span>                    accum += (i*u + (<span class="hljs-number">1</span>-i)*(<span class="hljs-number">1</span>-u))*
<span class="line"></span>                            (j*v + (<span class="hljs-number">1</span>-j)*(<span class="hljs-number">1</span>-v))*
<span class="line"></span>                            (k*w + (<span class="hljs-number">1</span>-k)*(<span class="hljs-number">1</span>-w))*c[i][j][k];
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> accum;
<span class="line"></span>    }</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_perlin-trilinear">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;37:</b> <kbd>[perlin.h]</kbd> Perlin with trilinear interpolation</div></center>
<p>


</p><div class="together">
And we get:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.10-perlin-trilerp.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.10-perlin-trilerp.png"></a><center><span class="imagecaption"><span class="num">Image 10:</span> Perlin texture with trilinear interpolation
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="improvementwithhermitiansmoothing">&nbsp;</a><a class="target" name="perlinnoise/improvementwithhermitiansmoothing">&nbsp;</a><a class="target" name="toc5.3">&nbsp;</a><h2>Improvement with Hermitian Smoothing</h2>
<p>

Smoothing yields an improved result, but there are obvious grid features in there. Some of it is
Mach bands, a known perceptual artifact of linear interpolation of color. A standard trick is to use
a Hermite cubic to round off the interpolation:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-keyword">class</span> <span class="hljs-title">perlin</span> <span class="hljs-params">(
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-type">double</span> noise(<span class="hljs-type">const</span> point3&amp; p) <span class="hljs-type">const</span> {
<span class="line"></span>        <span class="hljs-keyword">auto</span> u = p.x() - floor(p.x());
<span class="line"></span>        <span class="hljs-keyword">auto</span> v = p.y() - floor(p.y());
<span class="line"></span>        <span class="hljs-keyword">auto</span> w = p.z() - floor(p.z());
<span class="line"></span></span></span><div class=" highlight"><span class="line"></span>        u = u*u*(<span class="hljs-number">3</span><span class="hljs-number">-2</span>*u);
<span class="line"></span>        v = v*v*(<span class="hljs-number">3</span><span class="hljs-number">-2</span>*v);
<span class="line"></span>        w = w*w*(<span class="hljs-number">3</span><span class="hljs-number">-2</span>*w);</div><span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> i = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">x</span>()));
<span class="line"></span>        <span class="hljs-keyword">auto</span> j = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">y</span>()));
<span class="line"></span>        <span class="hljs-keyword">auto</span> k = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">z</span>()));
<span class="line"></span>        ...</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_perlin-smoothed">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;38:</b> <kbd>[perlin.h]</kbd> Perlin smoothed</div></center>
<p>


</p><div class="together">
This gives a smoother looking image:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.11-perlin-trilerp-smooth.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.11-perlin-trilerp-smooth.png"></a><center><span class="imagecaption"><span class="num">Image 11:</span> Perlin texture, trilinearly interpolated, smoothed
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="tweakingthefrequency">&nbsp;</a><a class="target" name="perlinnoise/tweakingthefrequency">&nbsp;</a><a class="target" name="toc5.4">&nbsp;</a><h2>Tweaking The Frequency</h2>
<p>

It is also a bit low frequency. We can scale the input point to make it vary more quickly:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">noise_texture</span> : <span class="hljs-keyword">public</span> texture {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">noise_texture</span>() {}
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-built_in">noise_texture</span>(<span class="hljs-type">double</span> sc) : <span class="hljs-built_in">scale</span>(sc) {}</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">value</span><span class="hljs-params">(<span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) * noise.<span class="hljs-built_in">noise</span>(scale * p);</div><span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    perlin noise;<div class=" highlight"><span class="line"></span>    <span class="hljs-type">double</span> scale;</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_perlin-smoothed-2">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;39:</b> <kbd>[texture.h]</kbd> Perlin smoothed, higher frequency</div></center>
<p>


</p><div class="together">
We then add that scale to the <code>two_perlin_spheres()</code> scene description:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">two_perlin_spheres</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">auto</span> pertext = <span class="hljs-built_in">make_shared</span>&lt;noise_texture&gt;(<span class="hljs-number">4</span>);</div><span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">-1000</span>,<span class="hljs-number">0</span>), <span class="hljs-number">1000</span>, <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(pertext)));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>), <span class="hljs-number">2</span>, <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(pertext)));
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>    ...
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scale-perlin">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;40:</b> <kbd>[main.cc]</kbd> Perlin-textured spheres with a scale to the noise</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
This yields the following result:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.12-perlin-hifreq.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.12-perlin-hifreq.png"></a><center><span class="imagecaption"><span class="num">Image 12:</span> Perlin texture, higher frequency
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="usingrandomvectorsonthelatticepoints">&nbsp;</a><a class="target" name="perlinnoise/usingrandomvectorsonthelatticepoints">&nbsp;</a><a class="target" name="toc5.5">&nbsp;</a><h2>Using Random Vectors on the Lattice Points</h2>
<p>

This is still a bit blocky looking, probably because the min and max of the pattern always lands
exactly on the integer x/y/z. Ken Perlin’s very clever trick was to instead put random unit vectors
(instead of just floats) on the lattice points, and use a dot product to move the min and max off
the lattice. So, first we need to change the random floats to random vectors. These vectors are any
reasonable set of irregular directions, and I won't bother to make them exactly uniform:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">perlin</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">perlin</span>() {<div class=" highlight"><span class="line"></span>        ranvec = <span class="hljs-keyword">new</span> vec3[point_count];</div><span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; point_count; ++i) {<div class=" highlight"><span class="line"></span>            ranvec[i] = <span class="hljs-built_in">unit_vector</span>(vec3::<span class="hljs-built_in">random</span>(<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>));</div><span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        perm_x = <span class="hljs-built_in">perlin_generate_perm</span>();
<span class="line"></span>        perm_y = <span class="hljs-built_in">perlin_generate_perm</span>();
<span class="line"></span>        perm_z = <span class="hljs-built_in">perlin_generate_perm</span>();
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    ~<span class="hljs-built_in">perlin</span>() {<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">delete</span>[] ranvec;</div><span class="line"></span>        <span class="hljs-keyword">delete</span>[] perm_x;
<span class="line"></span>        <span class="hljs-keyword">delete</span>[] perm_y;
<span class="line"></span>        <span class="hljs-keyword">delete</span>[] perm_z;
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    <span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">int</span> point_count = <span class="hljs-number">256</span>;<div class=" highlight"><span class="line"></span>    vec3* ranvec;</div><span class="line"></span>    <span class="hljs-type">int</span>* perm_x;
<span class="line"></span>    <span class="hljs-type">int</span>* perm_y;
<span class="line"></span>    <span class="hljs-type">int</span>* perm_z;
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_perlin-randunit">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;41:</b> <kbd>[perlin.h]</kbd> Perlin with random unit translations</div></center>
<p>


</p><div class="together">
The Perlin class <code>noise()</code> method is now:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">perlin</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">noise</span><span class="hljs-params">(<span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> </span>{<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> u = p.<span class="hljs-built_in">x</span>() - <span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">x</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> v = p.<span class="hljs-built_in">y</span>() - <span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">y</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> w = p.<span class="hljs-built_in">z</span>() - <span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">z</span>());</div><span class="line"></span>        <span class="hljs-keyword">auto</span> i = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">x</span>()));
<span class="line"></span>        <span class="hljs-keyword">auto</span> j = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">y</span>()));
<span class="line"></span>        <span class="hljs-keyword">auto</span> k = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-built_in">floor</span>(p.<span class="hljs-built_in">z</span>()));<div class=" highlight"><span class="line"></span>        vec3 c[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>][<span class="hljs-number">2</span>];</div><span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> di=<span class="hljs-number">0</span>; di &lt; <span class="hljs-number">2</span>; di++)
<span class="line"></span>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> dj=<span class="hljs-number">0</span>; dj &lt; <span class="hljs-number">2</span>; dj++)
<span class="line"></span>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> dk=<span class="hljs-number">0</span>; dk &lt; <span class="hljs-number">2</span>; dk++)<div class=" highlight"><span class="line"></span>                    c[di][dj][dk] = ranvec[
<span class="line"></span>                        perm_x[(i+di) &amp; <span class="hljs-number">255</span>] ^
<span class="line"></span>                        perm_y[(j+dj) &amp; <span class="hljs-number">255</span>] ^
<span class="line"></span>                        perm_z[(k+dk) &amp; <span class="hljs-number">255</span>]
<span class="line"></span>                    ];</div><span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">perlin_interp</span>(c, u, v, w);</div><span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_perlin-2">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;42:</b> <kbd>[perlin.h]</kbd> Perlin class with new noise() method</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
And the interpolation becomes a bit more complicated:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">perlin</span> {
<span class="line"></span>  ...
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">double</span> <span class="hljs-title">perlin_interp</span><span class="hljs-params">(vec3 c[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>][<span class="hljs-number">2</span>], <span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">double</span> w)</span> </span>{<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> uu = u*u*(<span class="hljs-number">3</span><span class="hljs-number">-2</span>*u);
<span class="line"></span>        <span class="hljs-keyword">auto</span> vv = v*v*(<span class="hljs-number">3</span><span class="hljs-number">-2</span>*v);
<span class="line"></span>        <span class="hljs-keyword">auto</span> ww = w*w*(<span class="hljs-number">3</span><span class="hljs-number">-2</span>*w);
<span class="line"></span>        <span class="hljs-keyword">auto</span> accum = <span class="hljs-number">0.0</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++)
<span class="line"></span>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>; j &lt; <span class="hljs-number">2</span>; j++)
<span class="line"></span>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k=<span class="hljs-number">0</span>; k &lt; <span class="hljs-number">2</span>; k++) {
<span class="line"></span>                    <span class="hljs-function">vec3 <span class="hljs-title">weight_v</span><span class="hljs-params">(u-i, v-j, w-k)</span></span>;
<span class="line"></span>                    accum += (i*uu + (<span class="hljs-number">1</span>-i)*(<span class="hljs-number">1</span>-uu))
<span class="line"></span>                           * (j*vv + (<span class="hljs-number">1</span>-j)*(<span class="hljs-number">1</span>-vv))
<span class="line"></span>                           * (k*ww + (<span class="hljs-number">1</span>-k)*(<span class="hljs-number">1</span>-ww))
<span class="line"></span>                           * <span class="hljs-built_in">dot</span>(c[i][j][k], weight_v);
<span class="line"></span>                }
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> accum;</div><span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_perlin-interp">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;43:</b> <kbd>[perlin.h]</kbd> Perlin interpolation function so far</div></center>
<p>


</p></div>

<p></p><p>

The output of the perlin interpretation can return negative values. These negative values will be
passed to the <code>sqrt()</code> function of our gamma function and get turned into <code>NaN</code>s. We will cast the
perlin output back to between 0 and 1.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">noise_texture</span> : <span class="hljs-keyword">public</span> texture {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">noise_texture</span>() {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">noise_texture</span>(<span class="hljs-type">double</span> sc) : <span class="hljs-built_in">scale</span>(sc) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">value</span><span class="hljs-params">(<span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) * <span class="hljs-number">0.5</span> * (<span class="hljs-number">1.0</span> + noise.<span class="hljs-built_in">noise</span>(scale * p));</div><span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    perlin noise;
<span class="line"></span>    <span class="hljs-type">double</span> scale;
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_perlin-smoothed-2">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;44:</b> <kbd>[texture.h]</kbd> Perlin smoothed, higher frequency</div></center>
<p>


</p><div class="together">
This finally gives something more reasonable looking:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.13-perlin-shift.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.13-perlin-shift.png"></a><center><span class="imagecaption"><span class="num">Image 13:</span> Perlin texture, shifted off integer values
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="introducingturbulence">&nbsp;</a><a class="target" name="perlinnoise/introducingturbulence">&nbsp;</a><a class="target" name="toc5.6">&nbsp;</a><h2>Introducing Turbulence</h2>
<p>

Very often, a composite noise that has multiple summed frequencies is used. This is usually called
turbulence, and is a sum of repeated calls to noise:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">perlin</span> {
<span class="line"></span>  ...
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">turb</span><span class="hljs-params">(<span class="hljs-type">const</span> point3&amp; p, <span class="hljs-type">int</span> depth=<span class="hljs-number">7</span>)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">auto</span> accum = <span class="hljs-number">0.0</span>;
<span class="line"></span>        <span class="hljs-keyword">auto</span> temp_p = p;
<span class="line"></span>        <span class="hljs-keyword">auto</span> weight = <span class="hljs-number">1.0</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; depth; i++) {
<span class="line"></span>            accum += weight*<span class="hljs-built_in">noise</span>(temp_p);
<span class="line"></span>            weight *= <span class="hljs-number">0.5</span>;
<span class="line"></span>            temp_p *= <span class="hljs-number">2</span>;
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">fabs</span>(accum);
<span class="line"></span>    }
<span class="line"></span>    ...</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_perlin-turb">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;45:</b> <kbd>[perlin.h]</kbd> Turbulence function</div></center>
<p>


Here <code>fabs()</code> is the absolute value function defined in <code>&lt;cmath&gt;</code>.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">noise_texture</span> : <span class="hljs-keyword">public</span> texture {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">noise_texture</span>() {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">noise_texture</span>(<span class="hljs-type">double</span> sc) : <span class="hljs-built_in">scale</span>(sc) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">value</span><span class="hljs-params">(<span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> s = scale * p;
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) * noise.<span class="hljs-built_in">turb</span>(s);</div><span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    perlin noise;
<span class="line"></span>    <span class="hljs-type">double</span> scale;
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_noise-tex-2">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;46:</b> <kbd>[texture.h]</kbd> Noise texture with turbulence</div></center>
<p>


</p><div class="together">
Used directly, turbulence gives a sort of camouflage netting appearance:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.14-perlin-turb.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.14-perlin-turb.png"></a><center><span class="imagecaption"><span class="num">Image 14:</span> Perlin texture with turbulence
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="adjustingthephase">&nbsp;</a><a class="target" name="perlinnoise/adjustingthephase">&nbsp;</a><a class="target" name="toc5.7">&nbsp;</a><h2>Adjusting the Phase</h2>
<p>

However, usually turbulence is used indirectly. For example, the “hello world” of procedural solid
textures is a simple marble-like texture. The basic idea is to make color proportional to something
like a sine function, and use turbulence to adjust the phase (so it shifts <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-117-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-871" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-872"><span class="mi" id="MathJax-Span-873" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-117">x</script> in <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-118-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-874" style="width: 3.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.5em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-875"><span class="mi" id="MathJax-Span-876" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-877"></span><span class="mo" id="MathJax-Span-878" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-879" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-880" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-118">\sin(x)</script>) which
makes the stripes undulate. Commenting out straight noise and turbulence, and giving a marble-like
effect is:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">noise_texture</span> : <span class="hljs-keyword">public</span> texture {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">noise_texture</span>() {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">noise_texture</span>(<span class="hljs-type">double</span> sc) : <span class="hljs-built_in">scale</span>(sc) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">value</span><span class="hljs-params">(<span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> s = scale * p;
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) * <span class="hljs-number">0.5</span> * (<span class="hljs-number">1</span> + <span class="hljs-built_in">sin</span>(s.<span class="hljs-built_in">z</span>() + <span class="hljs-number">10</span>*noise.<span class="hljs-built_in">turb</span>(s)));</div><span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    perlin noise;
<span class="line"></span>    <span class="hljs-type">double</span> scale;
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_noise-tex-3">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;47:</b> <kbd>[texture.h]</kbd> Noise texture with marbled texture</div></center>
<p>


</p><div class="together">
Which yields:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.15-perlin-marble.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.15-perlin-marble.png"></a><center><span class="imagecaption"><span class="num">Image 15:</span> Perlin noise, marbled texture
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="quadrilaterals">&nbsp;</a><a class="target" name="quadrilaterals">&nbsp;</a><a class="target" name="toc6">&nbsp;</a><h1>Quadrilaterals</h1>
<p>

We've managed to get more than half way through this three-book series using spheres as our only
geometric primitive. Time to add our second primitive: the quadrilateral.

</p>
<a class="target" name="definingthequadrilateral">&nbsp;</a><a class="target" name="quadrilaterals/definingthequadrilateral">&nbsp;</a><a class="target" name="toc6.1">&nbsp;</a><h2>Defining the Quadrilateral</h2>
<p>

Though we'll name our new primitive a <code>quad</code>, it will technically be a parallelogram (opposite sides
are parallel) instead of a general quadrilateral. For our purposes, we'll use three geometric
entities to define a quad:

</p><p>

</p><ol start="1">
  <li class="number"><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-119-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-881" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.8em, 2.552em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-882"><span class="texatom" id="MathJax-Span-883"><span class="mrow" id="MathJax-Span-884"><span class="mi" id="MathJax-Span-885" style="font-family: MathJax_Main-bold;">Q</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-119">\mathbf{Q}</script>, the lower-left corner.
</li>
  <li class="number"><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-120-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-886" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-887"><span class="texatom" id="MathJax-Span-888"><span class="mrow" id="MathJax-Span-889"><span class="mi" id="MathJax-Span-890" style="font-family: MathJax_Main-bold;">u</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-120">\mathbf{u}</script>, a vector representing the first side.
       <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-121-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-891" style="width: 3.402em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.702em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1002.7em, 2.652em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-892"><span class="texatom" id="MathJax-Span-893"><span class="mrow" id="MathJax-Span-894"><span class="mi" id="MathJax-Span-895" style="font-family: MathJax_Main-bold;">Q</span></span></span><span class="mo" id="MathJax-Span-896" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="texatom" id="MathJax-Span-897" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-898"><span class="mi" id="MathJax-Span-899" style="font-family: MathJax_Main-bold;">u</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-121">\mathbf{Q} + \mathbf{u}</script> gives one of the corners adjacent to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-122-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-900" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.8em, 2.552em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-901"><span class="texatom" id="MathJax-Span-902"><span class="mrow" id="MathJax-Span-903"><span class="mi" id="MathJax-Span-904" style="font-family: MathJax_Main-bold;">Q</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-122">\mathbf{Q}</script>.
</li>
  <li class="number"><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-123-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-905" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-906"><span class="texatom" id="MathJax-Span-907"><span class="mrow" id="MathJax-Span-908"><span class="mi" id="MathJax-Span-909" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-123">\mathbf{v}</script>, a vector representing the second side.
       <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-124-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-910" style="width: 3.353em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.652em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1002.6em, 2.652em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-911"><span class="texatom" id="MathJax-Span-912"><span class="mrow" id="MathJax-Span-913"><span class="mi" id="MathJax-Span-914" style="font-family: MathJax_Main-bold;">Q</span></span></span><span class="mo" id="MathJax-Span-915" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="texatom" id="MathJax-Span-916" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-917"><span class="mi" id="MathJax-Span-918" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-124">\mathbf{Q} + \mathbf{v}</script> gives the other corner adjacent to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-125-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-919" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.8em, 2.552em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-920"><span class="texatom" id="MathJax-Span-921"><span class="mrow" id="MathJax-Span-922"><span class="mi" id="MathJax-Span-923" style="font-family: MathJax_Main-bold;">Q</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-125">\mathbf{Q}</script>.</li></ol>

<p></p><p>

The corner of the quad opposite <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-126-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-924" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.8em, 2.552em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-925"><span class="texatom" id="MathJax-Span-926"><span class="mrow" id="MathJax-Span-927"><span class="mi" id="MathJax-Span-928" style="font-family: MathJax_Main-bold;">Q</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-126">\mathbf{Q}</script> is given by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-127-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-929" style="width: 5.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.452em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1004.4em, 2.652em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-930"><span class="texatom" id="MathJax-Span-931"><span class="mrow" id="MathJax-Span-932"><span class="mi" id="MathJax-Span-933" style="font-family: MathJax_Main-bold;">Q</span></span></span><span class="mo" id="MathJax-Span-934" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="texatom" id="MathJax-Span-935" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-936"><span class="mi" id="MathJax-Span-937" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-938" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="texatom" id="MathJax-Span-939" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-940"><span class="mi" id="MathJax-Span-941" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-127">\mathbf{Q} + \mathbf{u} + \mathbf{v}</script>.
These values are three-dimensional, even though a quad itself is a two-dimensional object. For
example, a quad with corner at the origin and extending two units in the Z direction and one unit in
the Y direction would have values <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-128-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mtext&gt;and&amp;#xA0;&lt;/mtext&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-942" style="width: 23.003em; display: inline-block;"><span style="display: inline-block; position: relative; width: 18.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1018.3em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-943"><span class="texatom" id="MathJax-Span-944"><span class="mrow" id="MathJax-Span-945"><span class="mi" id="MathJax-Span-946" style="font-family: MathJax_Main-bold;">Q</span></span></span><span class="mo" id="MathJax-Span-947" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-948" style="font-family: MathJax_Main; padding-left: 0.302em;">(</span><span class="mn" id="MathJax-Span-949" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-950" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-951" style="font-family: MathJax_Main; padding-left: 0.152em;">0</span><span class="mo" id="MathJax-Span-952" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-953" style="font-family: MathJax_Main; padding-left: 0.152em;">0</span><span class="mo" id="MathJax-Span-954" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-955" style="font-family: MathJax_Main;">,</span><span class="texatom" id="MathJax-Span-956" style="padding-left: 0.152em;"><span class="mrow" id="MathJax-Span-957"><span class="mi" id="MathJax-Span-958" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-959" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-960" style="font-family: MathJax_Main; padding-left: 0.302em;">(</span><span class="mn" id="MathJax-Span-961" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-962" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-963" style="font-family: MathJax_Main; padding-left: 0.152em;">0</span><span class="mo" id="MathJax-Span-964" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-965" style="font-family: MathJax_Main; padding-left: 0.152em;">2</span><span class="mo" id="MathJax-Span-966" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-967" style="font-family: MathJax_Main;">,</span><span class="mtext" id="MathJax-Span-968" style="font-family: MathJax_Main; padding-left: 0.152em;">and&nbsp;</span><span class="texatom" id="MathJax-Span-969"><span class="mrow" id="MathJax-Span-970"><span class="mi" id="MathJax-Span-971" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-972" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-973" style="font-family: MathJax_Main; padding-left: 0.302em;">(</span><span class="mn" id="MathJax-Span-974" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-975" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-976" style="font-family: MathJax_Main; padding-left: 0.152em;">1</span><span class="mo" id="MathJax-Span-977" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-978" style="font-family: MathJax_Main; padding-left: 0.152em;">0</span><span class="mo" id="MathJax-Span-979" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow><mo>=</mo><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="false">)</mo><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>=</mo><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>2</mn><mo stretchy="false">)</mo><mo>,</mo><mtext>and&nbsp;</mtext><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>=</mo><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-128">\mathbf{Q} = (0,0,0), \mathbf{u} = (0,0,2), \text{and }
\mathbf{v} = (0,1,0)</script>.

</p><p>

</p><div class="together">
The following figure illustrates the quadrilateral components.

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/fig-2.05-quad-def.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing_ The Next Week_files/fig-2.05-quad-def.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_quad-def">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;5:</b> Quadrilateral Components</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
Quads are flat, so their axis-aligned bounding box will have zero thickness in one dimension if the
quad lies in the XY, YZ, or ZX plane. This can lead to numerical problems with ray intersection, but
we can address this by padding any zero-sized dimensions of the bounding box. Padding is fine
because we aren't changing the intersection of the quad; we're only expanding its bounding box to
remove the possibility of numerical problems, and the bounds are just a rough approximation to the
actual shape anyway. To this end, we add a new <code>aabb::pad()</code> method that remedies this situation:

<p></p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">aabb</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-built_in">aabb</span>(<span class="hljs-type">const</span> aabb&amp; box0, <span class="hljs-type">const</span> aabb&amp; box1) {
<span class="line"></span>        x = <span class="hljs-built_in">interval</span>(box0.x, box1.x);
<span class="line"></span>        y = <span class="hljs-built_in">interval</span>(box0.y, box1.y);
<span class="line"></span>        z = <span class="hljs-built_in">interval</span>(box0.z, box1.z);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-function">aabb <span class="hljs-title">pad</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Return an AABB that has no side narrower than some delta, padding if necessary.</span>
<span class="line"></span>        <span class="hljs-type">double</span> delta = <span class="hljs-number">0.0001</span>;
<span class="line"></span>        interval new_x = (x.<span class="hljs-built_in">size</span>() &gt;= delta) ? x : x.<span class="hljs-built_in">expand</span>(delta);
<span class="line"></span>        interval new_y = (y.<span class="hljs-built_in">size</span>() &gt;= delta) ? y : y.<span class="hljs-built_in">expand</span>(delta);
<span class="line"></span>        interval new_z = (z.<span class="hljs-built_in">size</span>() &gt;= delta) ? z : z.<span class="hljs-built_in">expand</span>(delta);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">aabb</span>(new_x, new_y, new_z);
<span class="line"></span>    }</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_aabb">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;48:</b> <kbd>[aabb.h]</kbd> New aabb::pad() method</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Now we're ready for the first sketch of the new <code>quad</code> class:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> QUAD_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> QUAD_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">quad</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">quad</span>(<span class="hljs-type">const</span> point3&amp; _Q, <span class="hljs-type">const</span> vec3&amp; _u, <span class="hljs-type">const</span> vec3&amp; _v, shared_ptr&lt;material&gt; m)
<span class="line"></span>      : <span class="hljs-built_in">Q</span>(_Q), <span class="hljs-built_in">u</span>(_u), <span class="hljs-built_in">v</span>(_v), <span class="hljs-built_in">mat</span>(m)
<span class="line"></span>    {
<span class="line"></span>        <span class="hljs-built_in">set_bounding_box</span>();
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">set_bounding_box</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>        bbox = <span class="hljs-built_in">aabb</span>(Q, Q + u + v).<span class="hljs-built_in">pad</span>();
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">aabb <span class="hljs-title">bounding_box</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-keyword">return</span> bbox; }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// To be implemented</span>
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    point3 Q;
<span class="line"></span>    vec3 u, v;
<span class="line"></span>    shared_ptr&lt;material&gt; mat;
<span class="line"></span>    aabb bbox;
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_quad">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;49:</b> <kbd>[quad.h]</kbd> 2D quadrilateral (parallelogram) class</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="ray-planeintersection">&nbsp;</a><a class="target" name="quadrilaterals/ray-planeintersection">&nbsp;</a><a class="target" name="toc6.2">&nbsp;</a><h2>Ray-Plane Intersection</h2>
<p>

As you can see in the prior listing, <code>quad::hit()</code> remains to be implemented. Just as for spheres,
we need to determine whether a given ray intersects the primitive, and if so, the various properties
of that intersection (hit point, normal, texture coordinates and so forth).

</p><p>

Ray-quad intersection will be determined in three steps:

</p><p>

</p><ol start="1">
  <li class="number">finding the plane that contains that quad,
</li>
  <li class="number">solving for the intersection of a ray and the quad-containing plane,
</li>
  <li class="number">determining if the hit point lies inside the quad.</li></ol>

<p></p><p>

We'll first tackle the middle step, solving for general ray-plane intersection.

</p><p>

Spheres are generally the first ray tracing primitive taught because their implicit formula makes it
so easy to solve for ray intersection. Like spheres, planes also have an implicit formula, and we
can use their implicit formula to produce an algorithm that solves for ray-plane intersection.
Indeed, ray-plane intersection is even <em class="underscore">easier</em> to solve than ray-sphere intersection.

</p><p>

You may already know this implicit formula for a plane:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-129-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-980" style="width: 12.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.053em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1010em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-981"><span class="mi" id="MathJax-Span-982" style="font-family: MathJax_Math-italic;">A</span><span class="mi" id="MathJax-Span-983" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-984" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-985" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">B</span><span class="mi" id="MathJax-Span-986" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-987" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-988" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mi" id="MathJax-Span-989" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-990" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-991" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">D</span><span class="mo" id="MathJax-Span-992" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-993" style="font-family: MathJax_Main; padding-left: 0.302em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>A</mi><mi>x</mi><mo>+</mo><mi>B</mi><mi>y</mi><mo>+</mo><mi>C</mi><mi>z</mi><mo>+</mo><mi>D</mi><mo>=</mo><mn>0</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-129"> Ax + By + Cz + D = 0 </script>

</p><p>

where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-130-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-994" style="width: 5.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1004.4em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-995"><span class="mi" id="MathJax-Span-996" style="font-family: MathJax_Math-italic;">A</span><span class="mo" id="MathJax-Span-997" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-998" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">B</span><span class="mo" id="MathJax-Span-999" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1000" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mo" id="MathJax-Span-1001" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1002" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">D</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mo>,</mo><mi>B</mi><mo>,</mo><mi>C</mi><mo>,</mo><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-130">A,B,C,D</script> are just constants, and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-131-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1003" style="width: 3.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.552em, 1002.4em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1004"><span class="mi" id="MathJax-Span-1005" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1006" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1007" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1008" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1009" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-131">x,y,z</script> are the values of any point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-132-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1010" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.05em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1011"><span class="mo" id="MathJax-Span-1012" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1013" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1014" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1015" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1016" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1017" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1018" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-132">(x,y,z)</script> that lies on
the plane. A plane is thus the set of all points <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-133-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1019" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.05em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1020"><span class="mo" id="MathJax-Span-1021" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1022" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1023" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1024" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1025" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1026" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1027" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-133">(x,y,z)</script> that satisfy the formula above. It makes
things slightly easier to use the alternate formulation:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-134-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1028" style="width: 10.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1008.4em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1029"><span class="mi" id="MathJax-Span-1030" style="font-family: MathJax_Math-italic;">A</span><span class="mi" id="MathJax-Span-1031" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1032" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1033" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">B</span><span class="mi" id="MathJax-Span-1034" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1035" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1036" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mi" id="MathJax-Span-1037" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1038" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1039" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">D</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>A</mi><mi>x</mi><mo>+</mo><mi>B</mi><mi>y</mi><mo>+</mo><mi>C</mi><mi>z</mi><mo>=</mo><mi>D</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-134"> Ax + By + Cz = D </script>

</p><p>

(We didn't flip the sign of D because it's just some constant that we'll figure out later.)

</p><p>

Here's an intuitive way to think of this formula: given the plane perpendicular to the normal vector
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-135-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1040" style="width: 7.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1005.85em, 2.603em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1041"><span class="texatom" id="MathJax-Span-1042"><span class="mrow" id="MathJax-Span-1043"><span class="mi" id="MathJax-Span-1044" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1045" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-1046" style="font-family: MathJax_Main; padding-left: 0.302em;">(</span><span class="mi" id="MathJax-Span-1047" style="font-family: MathJax_Math-italic;">A</span><span class="mo" id="MathJax-Span-1048" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1049" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">B</span><span class="mo" id="MathJax-Span-1050" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1051" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mo" id="MathJax-Span-1052" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>A</mi><mo>,</mo><mi>B</mi><mo>,</mo><mi>C</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-135">\mathbf{n} = (A,B,C)</script>, and the position vector <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-136-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1053" style="width: 6.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1005.05em, 2.603em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1054"><span class="texatom" id="MathJax-Span-1055"><span class="mrow" id="MathJax-Span-1056"><span class="mi" id="MathJax-Span-1057" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1058" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-1059" style="font-family: MathJax_Main; padding-left: 0.302em;">(</span><span class="mi" id="MathJax-Span-1060" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1061" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1062" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1063" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1064" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1065" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-136">\mathbf{v} = (x,y,z)</script> (that is, the vector from the
origin to any point on the plane), then we can use the dot product to solve for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-137-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1066" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.85em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1067"><span class="mi" id="MathJax-Span-1068" style="font-family: MathJax_Math-italic;">D</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-137">D</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-138-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1069" style="width: 5.202em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1004.15em, 2.452em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1070"><span class="texatom" id="MathJax-Span-1071"><span class="mrow" id="MathJax-Span-1072"><span class="mi" id="MathJax-Span-1073" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1074" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-1075" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1076"><span class="mi" id="MathJax-Span-1077" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1078" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1079" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">D</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>=</mo><mi>D</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-138"> \mathbf{n} \cdot \mathbf{v} = D </script>

</p><p>

for any position on the plane. This is an equivalent formulation of the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-139-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1080" style="width: 10.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1008.4em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1081"><span class="mi" id="MathJax-Span-1082" style="font-family: MathJax_Math-italic;">A</span><span class="mi" id="MathJax-Span-1083" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1084" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1085" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">B</span><span class="mi" id="MathJax-Span-1086" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1087" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1088" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mi" id="MathJax-Span-1089" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1090" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1091" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">D</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mi>x</mi><mo>+</mo><mi>B</mi><mi>y</mi><mo>+</mo><mi>C</mi><mi>z</mi><mo>=</mo><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-139">Ax + By + Cz = D</script> formula
given above, only now in terms of vectors.

</p><p>

Now to find the intersection with some ray <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-140-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1092" style="width: 7.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1006.3em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1093"><span class="texatom" id="MathJax-Span-1094"><span class="mrow" id="MathJax-Span-1095"><span class="mi" id="MathJax-Span-1096" style="font-family: MathJax_Main-bold;">R</span></span></span><span class="mo" id="MathJax-Span-1097" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1098" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-1099" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1100" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1101" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1102"><span class="mi" id="MathJax-Span-1103" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-1104" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1105" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">t</span><span class="texatom" id="MathJax-Span-1106"><span class="mrow" id="MathJax-Span-1107"><span class="mi" id="MathJax-Span-1108" style="font-family: MathJax_Main-bold;">d</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">R</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">d</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-140">\mathbf{R}(t) = \mathbf{P} + t\mathbf{d}</script>. Plugging in
the ray equation, we get

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-141-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1109" style="width: 9.152em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.303em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1007.3em, 2.603em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1110"><span class="texatom" id="MathJax-Span-1111"><span class="mrow" id="MathJax-Span-1112"><span class="mi" id="MathJax-Span-1113" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1114" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-1115" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-1116"><span class="mrow" id="MathJax-Span-1117"><span class="mi" id="MathJax-Span-1118" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-1119" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1120" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">t</span><span class="texatom" id="MathJax-Span-1121"><span class="mrow" id="MathJax-Span-1122"><span class="mi" id="MathJax-Span-1123" style="font-family: MathJax_Main-bold;">d</span></span></span><span class="mo" id="MathJax-Span-1124" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1125" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1126" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">D</span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">d</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mi>D</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-141"> \mathbf{n} \cdot ( \mathbf{P} + t \mathbf{d} ) = D </script>

</p><p>

Solving for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-142-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1127" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1128"><span class="mi" id="MathJax-Span-1129" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-142">t</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-143-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1130" style="width: 9.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.803em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1007.8em, 2.552em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1131"><span class="texatom" id="MathJax-Span-1132"><span class="mrow" id="MathJax-Span-1133"><span class="mi" id="MathJax-Span-1134" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1135" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-1136" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1137"><span class="mi" id="MathJax-Span-1138" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-1139" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="texatom" id="MathJax-Span-1140" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1141"><span class="mi" id="MathJax-Span-1142" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1143" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-1144" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">t</span><span class="texatom" id="MathJax-Span-1145"><span class="mrow" id="MathJax-Span-1146"><span class="mi" id="MathJax-Span-1147" style="font-family: MathJax_Main-bold;">d</span></span></span><span class="mo" id="MathJax-Span-1148" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1149" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">D</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">d</mi></mrow><mo>=</mo><mi>D</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-143"> \mathbf{n} \cdot \mathbf{P} + \mathbf{n} \cdot t \mathbf{d}  = D </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-144-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1150" style="width: 10.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1008.6em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1151"><span class="texatom" id="MathJax-Span-1152"><span class="mrow" id="MathJax-Span-1153"><span class="mi" id="MathJax-Span-1154" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1155" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-1156" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1157"><span class="mi" id="MathJax-Span-1158" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-1159" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1160" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">t</span><span class="mo" id="MathJax-Span-1161" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1162"><span class="mrow" id="MathJax-Span-1163"><span class="mi" id="MathJax-Span-1164" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1165" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-1166" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1167"><span class="mi" id="MathJax-Span-1168" style="font-family: MathJax_Main-bold;">d</span></span></span><span class="mo" id="MathJax-Span-1169" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1170" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1171" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">D</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>+</mo><mi>t</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">d</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mi>D</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-144"> \mathbf{n} \cdot \mathbf{P} + t(\mathbf{n} \cdot \mathbf{d}) = D </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-145-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1172" style="width: 7.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.202em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.802em, 1006.2em, 3.152em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1173"><span class="mi" id="MathJax-Span-1174" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-1175" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-1176" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 4.252em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.152em, 1004.05em, 4.252em, -999.998em); top: -4.697em; left: 50%; margin-left: -2.048em;"><span class="mrow" id="MathJax-Span-1177"><span class="mi" id="MathJax-Span-1178" style="font-family: MathJax_Math-italic;">D</span><span class="mo" id="MathJax-Span-1179" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-1180" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1181"><span class="mi" id="MathJax-Span-1182" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1183" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-1184" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1185"><span class="mi" id="MathJax-Span-1186" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1001.95em, 4.152em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.997em;"><span class="mrow" id="MathJax-Span-1187"><span class="texatom" id="MathJax-Span-1188"><span class="mrow" id="MathJax-Span-1189"><span class="mi" id="MathJax-Span-1190" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1191" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-1192" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1193"><span class="mi" id="MathJax-Span-1194" style="font-family: MathJax_Main-bold;">d</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1004.25em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.252em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.691em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>t</mi><mo>=</mo><mfrac><mrow><mi>D</mi><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">d</mi></mrow></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-145"> t = \frac{D - \mathbf{n} \cdot \mathbf{P}}{\mathbf{n} \cdot \mathbf{d}} </script>

</p><p>

This gives us <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-146-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1195" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1196"><span class="mi" id="MathJax-Span-1197" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-146">t</script>, which we can plug into the ray equation to find the point of intersection. Note
that the denominator <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-147-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1198" style="width: 2.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1001.9em, 2.452em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1199"><span class="texatom" id="MathJax-Span-1200"><span class="mrow" id="MathJax-Span-1201"><span class="mi" id="MathJax-Span-1202" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1203" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-1204" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1205"><span class="mi" id="MathJax-Span-1206" style="font-family: MathJax_Main-bold;">d</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">d</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-147">\mathbf{n} \cdot \mathbf{d}</script> will be zero if the ray is parallel to the plane.
In this case, we can immediately record a miss between the ray and the plane. As for other
primitives, if the ray <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-148-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1207" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1208"><span class="mi" id="MathJax-Span-1209" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-148">t</script> parameter is less than the minimum acceptable value, we also record a
miss.

</p><p>

All right, we can find the point of intersection between a ray and the plane that contains a given
quadrilateral. In fact, we can use this approach to test <em class="underscore">any</em> planar primitive, like triangles and
disks (more on that later).

</p>
<a class="target" name="findingtheplanethatcontainsagivenquadrilateral">&nbsp;</a><a class="target" name="quadrilaterals/findingtheplanethatcontainsagivenquadrilateral">&nbsp;</a><a class="target" name="toc6.3">&nbsp;</a><h2>Finding the Plane That Contains a Given Quadrilateral</h2>
<p>

We've solved step two above: solving the ray-plane intersection, assuming we have the plane
equation. To do this, we need to tackle step one above: finding the equation for the plane that
contains the quad. We have quadrilateral parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-149-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1210" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.8em, 2.552em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1211"><span class="texatom" id="MathJax-Span-1212"><span class="mrow" id="MathJax-Span-1213"><span class="mi" id="MathJax-Span-1214" style="font-family: MathJax_Main-bold;">Q</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-149">\mathbf{Q}</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-150-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1215" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1216"><span class="texatom" id="MathJax-Span-1217"><span class="mrow" id="MathJax-Span-1218"><span class="mi" id="MathJax-Span-1219" style="font-family: MathJax_Main-bold;">u</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-150">\mathbf{u}</script>, and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-151-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1220" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1221"><span class="texatom" id="MathJax-Span-1222"><span class="mrow" id="MathJax-Span-1223"><span class="mi" id="MathJax-Span-1224" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-151">\mathbf{v}</script>,
and want the corresponding equation of the plane containing the quad defined by these three values.

</p><p>

Fortunately, this is very simple. Recall that in the equation <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-152-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1225" style="width: 10.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1008.4em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1226"><span class="mi" id="MathJax-Span-1227" style="font-family: MathJax_Math-italic;">A</span><span class="mi" id="MathJax-Span-1228" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1229" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1230" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">B</span><span class="mi" id="MathJax-Span-1231" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1232" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1233" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mi" id="MathJax-Span-1234" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1235" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1236" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">D</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mi>x</mi><mo>+</mo><mi>B</mi><mi>y</mi><mo>+</mo><mi>C</mi><mi>z</mi><mo>=</mo><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-152">Ax + By + Cz = D</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-153-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1237" style="width: 4.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.902em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.8em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1238"><span class="mo" id="MathJax-Span-1239" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1240" style="font-family: MathJax_Math-italic;">A</span><span class="mo" id="MathJax-Span-1241" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1242" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">B</span><span class="mo" id="MathJax-Span-1243" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1244" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mo" id="MathJax-Span-1245" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>A</mi><mo>,</mo><mi>B</mi><mo>,</mo><mi>C</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-153">(A,B,C)</script>
represents the normal vector. To get this, we just use the cross product of the two side vectors
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-154-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1246" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1247"><span class="texatom" id="MathJax-Span-1248"><span class="mrow" id="MathJax-Span-1249"><span class="mi" id="MathJax-Span-1250" style="font-family: MathJax_Main-bold;">u</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-154">\mathbf{u}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-155-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1251" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1252"><span class="texatom" id="MathJax-Span-1253"><span class="mrow" id="MathJax-Span-1254"><span class="mi" id="MathJax-Span-1255" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-155">\mathbf{v}</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-156-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-OP MJX-fixedlimits&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x005F;&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;v&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1256" style="width: 12.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.203em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1010.1em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1257"><span class="texatom" id="MathJax-Span-1258"><span class="mrow" id="MathJax-Span-1259"><span class="mi" id="MathJax-Span-1260" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1261" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1262" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1263"><span class="mi" id="MathJax-Span-1264" style="font-family: MathJax_Main;">u</span><span class="mi" id="MathJax-Span-1265" style="font-family: MathJax_Main;">n</span><span class="mi" id="MathJax-Span-1266" style="font-family: MathJax_Main;">i</span><span class="mi" id="MathJax-Span-1267" style="font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-1268" style="font-family: MathJax_Main;">_</span><span class="mi" id="MathJax-Span-1269" style="font-family: MathJax_Main;">v</span><span class="mi" id="MathJax-Span-1270" style="font-family: MathJax_Main;">e</span><span class="mi" id="MathJax-Span-1271" style="font-family: MathJax_Main;">c</span><span class="mi" id="MathJax-Span-1272" style="font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-1273" style="font-family: MathJax_Main;">o</span><span class="mi" id="MathJax-Span-1274" style="font-family: MathJax_Main;">r</span></span></span><span class="mo" id="MathJax-Span-1275"></span><span class="mo" id="MathJax-Span-1276" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1277"><span class="mrow" id="MathJax-Span-1278"><span class="mi" id="MathJax-Span-1279" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1280" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1281" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1282"><span class="mi" id="MathJax-Span-1283" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1284" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>=</mo><mrow class="MJX-TeXAtom-OP MJX-fixedlimits"><mi mathvariant="normal">u</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">_</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi></mrow><mo>⁡</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-156"> \mathbf{n} = \operatorname{unit\_vector}(\mathbf{u} \times \mathbf{v}) </script>

</p><p>

The plane is defined as all points <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-157-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1285" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.05em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1286"><span class="mo" id="MathJax-Span-1287" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1288" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1289" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1290" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1291" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1292" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1293" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-157">(x,y,z)</script> that satisfy the equation <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-158-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1294" style="width: 10.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1008.4em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1295"><span class="mi" id="MathJax-Span-1296" style="font-family: MathJax_Math-italic;">A</span><span class="mi" id="MathJax-Span-1297" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1298" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1299" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">B</span><span class="mi" id="MathJax-Span-1300" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1301" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1302" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mi" id="MathJax-Span-1303" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1304" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1305" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">D</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mi>x</mi><mo>+</mo><mi>B</mi><mi>y</mi><mo>+</mo><mi>C</mi><mi>z</mi><mo>=</mo><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-158">Ax + By + Cz = D</script>. Well, we
know that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-159-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1306" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.8em, 2.552em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1307"><span class="texatom" id="MathJax-Span-1308"><span class="mrow" id="MathJax-Span-1309"><span class="mi" id="MathJax-Span-1310" style="font-family: MathJax_Main-bold;">Q</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-159">\mathbf{Q}</script> lies on the plane, so that's enough to solve for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-160-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1311" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.85em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1312"><span class="mi" id="MathJax-Span-1313" style="font-family: MathJax_Math-italic;">D</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-160">D</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-161-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left right left right left right left right left right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1314" style="width: 14.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.652em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(-0.597em, 1011.65em, 2.103em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1315"><span class="mtable" id="MathJax-Span-1316"><span style="display: inline-block; position: relative; width: 11.353em; height: 0px; margin-right: 0.152em; margin-left: 0.152em;"><span style="position: absolute; clip: rect(2.502em, 1000.8em, 4.902em, -999.998em); top: -3.998em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.8em, 4.152em, -999.998em); top: -4.647em; right: 0em;"><span class="mtd" id="MathJax-Span-1317"><span class="mrow" id="MathJax-Span-1318"><span class="mi" id="MathJax-Span-1319" style="font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.853em, 1000em, 4.152em, -999.998em); top: -3.248em; right: 0em;"><span class="mtd" id="MathJax-Span-1344"><span class="mrow" id="MathJax-Span-1345"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(2.502em, 1010.55em, 5.103em, -999.998em); top: -3.998em; left: 0.853em;"><span style="display: inline-block; position: relative; width: 10.553em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1010.55em, 4.452em, -999.998em); top: -4.647em; left: 0em;"><span class="mtd" id="MathJax-Span-1320"><span class="mrow" id="MathJax-Span-1321"><span class="mi" id="MathJax-Span-1322"></span><span class="mo" id="MathJax-Span-1323" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-1324" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.103em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.6em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1325" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.603em;"><span class="mi" id="MathJax-Span-1326" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1327"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1328" style="font-family: MathJax_Math-italic;">Q</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.802em;"><span class="mi" id="MathJax-Span-1329" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-1330" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="msubsup" id="MathJax-Span-1331" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.052em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.6em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1332" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.603em;"><span class="mi" id="MathJax-Span-1333" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1334"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1335" style="font-family: MathJax_Math-italic;">Q</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.802em;"><span class="mi" id="MathJax-Span-1336" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-1337" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="msubsup" id="MathJax-Span-1338" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.6em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1339" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.603em;"><span class="mi" id="MathJax-Span-1340" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1341"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1342" style="font-family: MathJax_Math-italic;">Q</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.802em;"><span class="mi" id="MathJax-Span-1343" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1003.5em, 4.353em, -999.998em); top: -3.248em; left: 0em;"><span class="mtd" id="MathJax-Span-1346"><span class="mrow" id="MathJax-Span-1347"><span class="mi" id="MathJax-Span-1348"></span><span class="mo" id="MathJax-Span-1349" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1350" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1351"><span class="mi" id="MathJax-Span-1352" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1353" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-1354" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1355"><span class="mi" id="MathJax-Span-1356" style="font-family: MathJax_Main-bold;">Q</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.247em; border-left: 0px solid; width: 0px; height: 3.128em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mtr><mtd><mi>D</mi></mtd><mtd><mi></mi><mo>=</mo><msub><mi>n</mi><mi>x</mi></msub><msub><mi>Q</mi><mi>x</mi></msub><mo>+</mo><msub><mi>n</mi><mi>y</mi></msub><msub><mi>Q</mi><mi>y</mi></msub><mo>+</mo><msub><mi>n</mi><mi>z</mi></msub><msub><mi>Q</mi><mi>z</mi></msub></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-161"> \begin{align*}
     D &= n_x Q_x + n_y Q_y + n_z Q_z \\
       &= \mathbf{n} \cdot \mathbf{Q} \\
     \end{align*}
  </script>

</p><p>

</p><div class="together">
Add the planar values to the <code>quad</code> class:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">quad</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">quad</span>(<span class="hljs-type">const</span> point3&amp; _Q, <span class="hljs-type">const</span> vec3&amp; _u, <span class="hljs-type">const</span> vec3&amp; _v, shared_ptr&lt;material&gt; m)
<span class="line"></span>      : <span class="hljs-built_in">Q</span>(_Q), <span class="hljs-built_in">u</span>(_u), <span class="hljs-built_in">v</span>(_v), <span class="hljs-built_in">mat</span>(m)
<span class="line"></span>    {<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> n = <span class="hljs-built_in">cross</span>(u, v);
<span class="line"></span>        normal = <span class="hljs-built_in">unit_vector</span>(n);
<span class="line"></span>        D = <span class="hljs-built_in">dot</span>(normal, Q);</div><span class="line"></span>
<span class="line"></span>        <span class="hljs-built_in">set_bounding_box</span>();
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    point3 Q;
<span class="line"></span>    vec3 u, v;
<span class="line"></span>    shared_ptr&lt;material&gt; mat;
<span class="line"></span>    aabb bbox;<div class=" highlight"><span class="line"></span>    vec3 normal;
<span class="line"></span>    <span class="hljs-type">double</span> D;</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_quad-plane1">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;50:</b>
        <kbd>[quad.h]</kbd> Caching thel planar values</div></center>
<p>


</p></div>

<p></p><p>

We will use the two values <code>normal</code> and <code>D</code> to find the point of intersection between a given ray
and the plane containing the quadrilateral.

</p><p>

As an incremental step, let's implement the <code>hit()</code> method to handle the infinite plane containing
our quadrilateral.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">quad</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> denom = <span class="hljs-built_in">dot</span>(normal, r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// No hit if the ray is parallel to the plane.</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">fabs</span>(denom) &lt; <span class="hljs-number">1e-8</span>)
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Return false if the hit point parameter t is outside the ray interval.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> t = (D - <span class="hljs-built_in">dot</span>(normal, r.<span class="hljs-built_in">origin</span>())) / denom;
<span class="line"></span>        <span class="hljs-keyword">if</span> (!<span class="hljs-type">ray_t</span>.<span class="hljs-built_in">contains</span>(t))
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> intersection = r.<span class="hljs-built_in">at</span>(t);
<span class="line"></span>
<span class="line"></span>        rec.t = t;
<span class="line"></span>        rec.p = intersection;
<span class="line"></span>        rec.mat = mat;
<span class="line"></span>        rec.<span class="hljs-built_in">set_face_normal</span>(r, normal);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</div><span class="line"></span>    }
<span class="line"></span>    ...</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_quad-plane2">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;51:</b> <kbd>[quad.h]</kbd> hit() method for the infinite plane</div></center>

<a class="target" name="orientingpointsontheplane">&nbsp;</a><a class="target" name="quadrilaterals/orientingpointsontheplane">&nbsp;</a><a class="target" name="toc6.4">&nbsp;</a><h2>Orienting Points on The Plane</h2>
<p>

At this stage, the intersection point is on the plane that contains the quadrilateral, but it could
be <em class="underscore">anywhere</em> on the plane: the ray-plane intersection point will lie inside or outside the
quadrilateral. We need to test for intersection points that lie inside the quadrilateral (hit), and
reject points that lie outside (miss). To determine where a point lies relative to the quad, and to
assign texture coordinates to the point of intersection, we need to orient the intersection point on
the plane.

</p><p>

To do this, we'll construct a <em class="underscore">coordinate frame</em> for the plane — a way of orienting any point
located on the plane. We've already been using a coordinate frame for our 3D space — this is
defined by an origin point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-162-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;O&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1357" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.8em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1358"><span class="texatom" id="MathJax-Span-1359"><span class="mrow" id="MathJax-Span-1360"><span class="mi" id="MathJax-Span-1361" style="font-family: MathJax_Main-bold;">O</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">O</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-162">\mathbf{O}</script> and three basis vectors <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-163-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1362" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.6em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1363"><span class="texatom" id="MathJax-Span-1364"><span class="mrow" id="MathJax-Span-1365"><span class="mi" id="MathJax-Span-1366" style="font-family: MathJax_Main-bold;">x</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">x</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-163">\mathbf{x}</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-164-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1367" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.552em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1368"><span class="texatom" id="MathJax-Span-1369"><span class="mrow" id="MathJax-Span-1370"><span class="mi" id="MathJax-Span-1371" style="font-family: MathJax_Main-bold;">y</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">y</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-164">\mathbf{y}</script>, and
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-165-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;z&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1372" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.45em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1373"><span class="texatom" id="MathJax-Span-1374"><span class="mrow" id="MathJax-Span-1375"><span class="mi" id="MathJax-Span-1376" style="font-family: MathJax_Main-bold;">z</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">z</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-165">\mathbf{z}</script>.

</p><p>

Since a plane is a 2D construct, we just need a plane origin point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-166-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1377" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.8em, 2.552em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1378"><span class="texatom" id="MathJax-Span-1379"><span class="mrow" id="MathJax-Span-1380"><span class="mi" id="MathJax-Span-1381" style="font-family: MathJax_Main-bold;">Q</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-166">\mathbf{Q}</script> and <em class="underscore">two</em> basis
vectors: <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-167-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1382" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1383"><span class="texatom" id="MathJax-Span-1384"><span class="mrow" id="MathJax-Span-1385"><span class="mi" id="MathJax-Span-1386" style="font-family: MathJax_Main-bold;">u</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-167">\mathbf{u}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-168-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1387" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1388"><span class="texatom" id="MathJax-Span-1389"><span class="mrow" id="MathJax-Span-1390"><span class="mi" id="MathJax-Span-1391" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-168">\mathbf{v}</script>. Normally, axes are perpendicular to each other. However,
this doesn't need to be the case in order to span the entire space — you just need two axes that
are not parallel to each other.

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/fig-2.06-ray-plane.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing_ The Next Week_files/fig-2.06-ray-plane.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_ray-plane">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;6:</b> Ray-plane intersection</span></center></div></center>

<p></p><p>

Consider <a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html#figure_ray-plane">figure&nbsp;6</a> as an example. Ray <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-169-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1392" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.85em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1393"><span class="texatom" id="MathJax-Span-1394"><span class="mrow" id="MathJax-Span-1395"><span class="mi" id="MathJax-Span-1396" style="font-family: MathJax_Main-bold;">R</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">R</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-169">\mathbf{R}</script> intersects the plane, yielding
intersection point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-170-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1397" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1398"><span class="texatom" id="MathJax-Span-1399"><span class="mrow" id="MathJax-Span-1400"><span class="mi" id="MathJax-Span-1401" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-170">\mathbf{P}</script> (not to be confused with the ray origin point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-171-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1402" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1403"><span class="texatom" id="MathJax-Span-1404"><span class="mrow" id="MathJax-Span-1405"><span class="mi" id="MathJax-Span-1406" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-171">\mathbf{P}</script> above).
Measuring against plane vectors <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-172-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1407" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1408"><span class="texatom" id="MathJax-Span-1409"><span class="mrow" id="MathJax-Span-1410"><span class="mi" id="MathJax-Span-1411" style="font-family: MathJax_Main-bold;">u</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-172">\mathbf{u}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-173-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1412" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1413"><span class="texatom" id="MathJax-Span-1414"><span class="mrow" id="MathJax-Span-1415"><span class="mi" id="MathJax-Span-1416" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-173">\mathbf{v}</script>, the intersection point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-174-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1417" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1418"><span class="texatom" id="MathJax-Span-1419"><span class="mrow" id="MathJax-Span-1420"><span class="mi" id="MathJax-Span-1421" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-174">\mathbf{P}</script>
in the example above is at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-175-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1422" style="width: 9.003em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.203em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.203em, 1007.15em, 2.702em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1423"><span class="texatom" id="MathJax-Span-1424"><span class="mrow" id="MathJax-Span-1425"><span class="mi" id="MathJax-Span-1426" style="font-family: MathJax_Main-bold;">Q</span></span></span><span class="mo" id="MathJax-Span-1427" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mo" id="MathJax-Span-1428" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="mn" id="MathJax-Span-1429" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1430" style="font-family: MathJax_Main;">)</span><span class="texatom" id="MathJax-Span-1431"><span class="mrow" id="MathJax-Span-1432"><span class="mi" id="MathJax-Span-1433" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1434" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mo" id="MathJax-Span-1435" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="mfrac" id="MathJax-Span-1436"><span style="display: inline-block; position: relative; width: 0.453em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.402em, 1000.3em, 4.152em, -999.998em); top: -4.397em; left: 50%; margin-left: -0.198em;"><span class="mn" id="MathJax-Span-1437" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.402em, 1000.3em, 4.152em, -999.998em); top: -3.647em; left: 50%; margin-left: -0.198em;"><span class="mn" id="MathJax-Span-1438" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1000.45em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.453em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-1439" style="font-family: MathJax_Main;">)</span><span class="texatom" id="MathJax-Span-1440"><span class="mrow" id="MathJax-Span-1441"><span class="mi" id="MathJax-Span-1442" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>+</mo><mo stretchy="false">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-175">\mathbf{Q} + (1)\mathbf{u} + (\frac{1}{2})\mathbf{v}</script>. In other words,
the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-176-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;U&lt;/mi&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;V&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1443" style="width: 2.202em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1001.7em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1444"><span class="texatom" id="MathJax-Span-1445"><span class="mrow" id="MathJax-Span-1446"><span class="mi" id="MathJax-Span-1447" style="font-family: MathJax_Main-bold;">U</span><span class="mi" id="MathJax-Span-1448" style="font-family: MathJax_Main-bold;">V</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">U</mi><mi mathvariant="bold">V</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-176">\mathbf{UV}</script> (plane) coordinates of intersection point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-177-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1449" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1450"><span class="texatom" id="MathJax-Span-1451"><span class="mrow" id="MathJax-Span-1452"><span class="mi" id="MathJax-Span-1453" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-177">\mathbf{P}</script> are <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-178-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1454" style="width: 2.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1002.25em, 2.802em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1455"><span class="mo" id="MathJax-Span-1456" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-1457" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1458" style="font-family: MathJax_Main;">,</span><span class="mfrac" id="MathJax-Span-1459" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 0.453em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.402em, 1000.3em, 4.152em, -999.998em); top: -4.397em; left: 50%; margin-left: -0.198em;"><span class="mn" id="MathJax-Span-1460" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.402em, 1000.3em, 4.152em, -999.998em); top: -3.647em; left: 50%; margin-left: -0.198em;"><span class="mn" id="MathJax-Span-1461" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1000.45em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.453em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-1462" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>1</mn><mo>,</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-178">(1,\frac{1}{2})</script>.

</p><p>

Generally, given some arbitrary point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-179-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1463" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1464"><span class="texatom" id="MathJax-Span-1465"><span class="mrow" id="MathJax-Span-1466"><span class="mi" id="MathJax-Span-1467" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-179">\mathbf{P}</script>, we seek two scalar values <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-180-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1468" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.6em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1469"><span class="mi" id="MathJax-Span-1470" style="font-family: MathJax_Math-italic;">α</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-180">\alpha</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-181-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1471" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.55em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1472"><span class="mi" id="MathJax-Span-1473" style="font-family: MathJax_Math-italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi></math></span></span><script type="math/tex" id="MathJax-Element-181">\beta</script>,
so that

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-182-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1474" style="width: 9.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1007.8em, 2.652em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1475"><span class="texatom" id="MathJax-Span-1476"><span class="mrow" id="MathJax-Span-1477"><span class="mi" id="MathJax-Span-1478" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-1479" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1480" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1481"><span class="mi" id="MathJax-Span-1482" style="font-family: MathJax_Main-bold;">Q</span></span></span><span class="mo" id="MathJax-Span-1483" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1484" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">α</span><span class="texatom" id="MathJax-Span-1485"><span class="mrow" id="MathJax-Span-1486"><span class="mi" id="MathJax-Span-1487" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1488" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1489" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-1490"><span class="mrow" id="MathJax-Span-1491"><span class="mi" id="MathJax-Span-1492" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow><mo>+</mo><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>+</mo><mi>β</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-182"> \mathbf{P} = \mathbf{Q} + \alpha \mathbf{u} + \beta \mathbf{v} </script>

</p><p>

If <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-183-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1493" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1494"><span class="texatom" id="MathJax-Span-1495"><span class="mrow" id="MathJax-Span-1496"><span class="mi" id="MathJax-Span-1497" style="font-family: MathJax_Main-bold;">u</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-183">\mathbf{u}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-184-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1498" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1499"><span class="texatom" id="MathJax-Span-1500"><span class="mrow" id="MathJax-Span-1501"><span class="mi" id="MathJax-Span-1502" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-184">\mathbf{v}</script> were guaranteed to be orthogonal to each other (forming a 90°
angle between them), then this would be a simple matter of using the dot product to project
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-185-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1503" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1504"><span class="texatom" id="MathJax-Span-1505"><span class="mrow" id="MathJax-Span-1506"><span class="mi" id="MathJax-Span-1507" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-185">\mathbf{P}</script> onto each of the basis vectors <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-186-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1508" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1509"><span class="texatom" id="MathJax-Span-1510"><span class="mrow" id="MathJax-Span-1511"><span class="mi" id="MathJax-Span-1512" style="font-family: MathJax_Main-bold;">u</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-186">\mathbf{u}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-187-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1513" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1514"><span class="texatom" id="MathJax-Span-1515"><span class="mrow" id="MathJax-Span-1516"><span class="mi" id="MathJax-Span-1517" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-187">\mathbf{v}</script>. However, since we are not
restricting <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-188-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1518" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1519"><span class="texatom" id="MathJax-Span-1520"><span class="mrow" id="MathJax-Span-1521"><span class="mi" id="MathJax-Span-1522" style="font-family: MathJax_Main-bold;">u</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-188">\mathbf{u}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-189-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1523" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1524"><span class="texatom" id="MathJax-Span-1525"><span class="mrow" id="MathJax-Span-1526"><span class="mi" id="MathJax-Span-1527" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-189">\mathbf{v}</script> to be orthogonal, the math's a little bit trickier.

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-190-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1528" style="width: 9.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1007.8em, 2.652em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1529"><span class="texatom" id="MathJax-Span-1530"><span class="mrow" id="MathJax-Span-1531"><span class="mi" id="MathJax-Span-1532" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-1533" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1534" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1535"><span class="mi" id="MathJax-Span-1536" style="font-family: MathJax_Main-bold;">Q</span></span></span><span class="mo" id="MathJax-Span-1537" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1538" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">α</span><span class="texatom" id="MathJax-Span-1539"><span class="mrow" id="MathJax-Span-1540"><span class="mi" id="MathJax-Span-1541" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1542" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1543" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-1544"><span class="mrow" id="MathJax-Span-1545"><span class="mi" id="MathJax-Span-1546" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow><mo>+</mo><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>+</mo><mi>β</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-190"> \mathbf{P} = \mathbf{Q} + \alpha \mathbf{u} + \beta \mathbf{v}</script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-191-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1547" style="width: 12.353em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1009.8em, 2.652em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1548"><span class="texatom" id="MathJax-Span-1549"><span class="mrow" id="MathJax-Span-1550"><span class="mi" id="MathJax-Span-1551" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-1552" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1553" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1554"><span class="mi" id="MathJax-Span-1555" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-1556" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-1557" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1558"><span class="mi" id="MathJax-Span-1559" style="font-family: MathJax_Main-bold;">Q</span></span></span><span class="mo" id="MathJax-Span-1560" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1561" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">α</span><span class="texatom" id="MathJax-Span-1562"><span class="mrow" id="MathJax-Span-1563"><span class="mi" id="MathJax-Span-1564" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1565" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1566" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-1567"><span class="mrow" id="MathJax-Span-1568"><span class="mi" id="MathJax-Span-1569" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow><mo>=</mo><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>+</mo><mi>β</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-191"> \mathbf{p} = \mathbf{P} - \mathbf{Q} = \alpha \mathbf{u} + \beta \mathbf{v} </script>

</p><p>

Here, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-192-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1570" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1571"><span class="texatom" id="MathJax-Span-1572"><span class="mrow" id="MathJax-Span-1573"><span class="mi" id="MathJax-Span-1574" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-192">\mathbf{P}</script> is the <em class="underscore">point</em> of intersection, and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-193-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1575" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.6em, 2.552em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1576"><span class="texatom" id="MathJax-Span-1577"><span class="mrow" id="MathJax-Span-1578"><span class="mi" id="MathJax-Span-1579" style="font-family: MathJax_Main-bold;">p</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-193">\mathbf{p}</script> is the <em class="underscore">vector</em> from
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-194-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1580" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.8em, 2.552em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1581"><span class="texatom" id="MathJax-Span-1582"><span class="mrow" id="MathJax-Span-1583"><span class="mi" id="MathJax-Span-1584" style="font-family: MathJax_Main-bold;">Q</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-194">\mathbf{Q}</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-195-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1585" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1586"><span class="texatom" id="MathJax-Span-1587"><span class="mrow" id="MathJax-Span-1588"><span class="mi" id="MathJax-Span-1589" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-195">\mathbf{P}</script>.

</p><p>

Cross the above equation with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-196-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1590" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1591"><span class="texatom" id="MathJax-Span-1592"><span class="mrow" id="MathJax-Span-1593"><span class="mi" id="MathJax-Span-1594" style="font-family: MathJax_Main-bold;">u</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-196">\mathbf{u}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-197-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1595" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1596"><span class="texatom" id="MathJax-Span-1597"><span class="mrow" id="MathJax-Span-1598"><span class="mi" id="MathJax-Span-1599" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-197">\mathbf{v}</script>, respectively:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-198-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left right left right left right left right left right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1600" style="width: 16.253em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.003em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(-1.248em, 1012.9em, 2.752em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1601"><span class="mtable" id="MathJax-Span-1602"><span style="display: inline-block; position: relative; width: 12.703em; height: 0px; margin-right: 0.152em; margin-left: 0.152em;"><span style="position: absolute; clip: rect(2.202em, 1002.4em, 5.652em, -999.998em); top: -4.147em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.452em; height: 0px;"><span style="position: absolute; clip: rect(3.353em, 1002.4em, 4.353em, -999.998em); top: -5.298em; right: 0em;"><span class="mtd" id="MathJax-Span-1603"><span class="mrow" id="MathJax-Span-1604"><span class="texatom" id="MathJax-Span-1605"><span class="mrow" id="MathJax-Span-1606"><span class="mi" id="MathJax-Span-1607" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1608" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1609" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1610"><span class="mi" id="MathJax-Span-1611" style="font-family: MathJax_Main-bold;">p</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.853em, 1000em, 4.152em, -999.998em); top: -3.948em; right: 0em;"><span class="mtd" id="MathJax-Span-1631"><span class="mrow" id="MathJax-Span-1632"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.853em, 1000em, 4.152em, -999.998em); top: -2.647em; right: 0em;"><span class="mtd" id="MathJax-Span-1654"><span class="mrow" id="MathJax-Span-1655"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.152em;"></span></span><span style="position: absolute; clip: rect(2.452em, 1010.15em, 6.403em, -999.998em); top: -4.647em; left: 2.452em;"><span style="display: inline-block; position: relative; width: 10.203em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1007.55em, 4.402em, -999.998em); top: -5.298em; left: 0em;"><span class="mtd" id="MathJax-Span-1612"><span class="mrow" id="MathJax-Span-1613"><span class="mi" id="MathJax-Span-1614"></span><span class="mo" id="MathJax-Span-1615" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1616" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1617"><span class="mi" id="MathJax-Span-1618" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1619" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="mo" id="MathJax-Span-1620" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="mi" id="MathJax-Span-1621" style="font-family: MathJax_Math-italic;">α</span><span class="texatom" id="MathJax-Span-1622"><span class="mrow" id="MathJax-Span-1623"><span class="mi" id="MathJax-Span-1624" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1625" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1626" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-1627"><span class="mrow" id="MathJax-Span-1628"><span class="mi" id="MathJax-Span-1629" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1630" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1008.65em, 4.353em, -999.998em); top: -3.948em; left: 0em;"><span class="mtd" id="MathJax-Span-1633"><span class="mrow" id="MathJax-Span-1634"><span class="mi" id="MathJax-Span-1635"></span><span class="mo" id="MathJax-Span-1636" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1637" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1638"><span class="mi" id="MathJax-Span-1639" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1640" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="mi" id="MathJax-Span-1641" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">α</span><span class="texatom" id="MathJax-Span-1642"><span class="mrow" id="MathJax-Span-1643"><span class="mi" id="MathJax-Span-1644" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1645" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="texatom" id="MathJax-Span-1646" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1647"><span class="mi" id="MathJax-Span-1648" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1649" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="mi" id="MathJax-Span-1650" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-1651"><span class="mrow" id="MathJax-Span-1652"><span class="mi" id="MathJax-Span-1653" style="font-family: MathJax_Main-bold;">v</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.103em, 1010.15em, 4.402em, -999.998em); top: -2.647em; left: 0em;"><span class="mtd" id="MathJax-Span-1656"><span class="mrow" id="MathJax-Span-1657"><span class="mi" id="MathJax-Span-1658"></span><span class="mo" id="MathJax-Span-1659" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1660" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">α</span><span class="mo" id="MathJax-Span-1661" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1662"><span class="mrow" id="MathJax-Span-1663"><span class="mi" id="MathJax-Span-1664" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1665" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1666" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1667"><span class="mi" id="MathJax-Span-1668" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1669" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1670" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1671" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1672" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1673"><span class="mrow" id="MathJax-Span-1674"><span class="mi" id="MathJax-Span-1675" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1676" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1677" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1678"><span class="mi" id="MathJax-Span-1679" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1680" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.652em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.059em; border-left: 0px solid; width: 0px; height: 4.753em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mtr><mtd><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow></mtd><mtd><mi></mi><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mo stretchy="false">(</mo><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>+</mo><mi>β</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mi>β</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mi>α</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo stretchy="false">)</mo><mo>+</mo><mi>β</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-198"> \begin{align*}
     \mathbf{u} \times \mathbf{p} &= \mathbf{u} \times (\alpha \mathbf{u} + \beta \mathbf{v}) \\
     &= \mathbf{u} \times \alpha \mathbf{u} + \mathbf{u} \times \beta \mathbf{v} \\
     &= \alpha(\mathbf{u} \times \mathbf{u}) + \beta(\mathbf{u} \times \mathbf{v})
     \end{align*} </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-199-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left right left right left right left right left right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1681" style="width: 16.152em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.902em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(-1.248em, 1012.8em, 2.752em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1682"><span class="mtable" id="MathJax-Span-1683"><span style="display: inline-block; position: relative; width: 12.603em; height: 0px; margin-right: 0.152em; margin-left: 0.152em;"><span style="position: absolute; clip: rect(2.202em, 1002.4em, 5.652em, -999.998em); top: -4.147em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.452em; height: 0px;"><span style="position: absolute; clip: rect(3.353em, 1002.4em, 4.353em, -999.998em); top: -5.298em; right: 0em;"><span class="mtd" id="MathJax-Span-1684"><span class="mrow" id="MathJax-Span-1685"><span class="texatom" id="MathJax-Span-1686"><span class="mrow" id="MathJax-Span-1687"><span class="mi" id="MathJax-Span-1688" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1689" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1690" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1691"><span class="mi" id="MathJax-Span-1692" style="font-family: MathJax_Main-bold;">p</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.853em, 1000em, 4.152em, -999.998em); top: -3.948em; right: 0em;"><span class="mtd" id="MathJax-Span-1712"><span class="mrow" id="MathJax-Span-1713"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.853em, 1000em, 4.152em, -999.998em); top: -2.647em; right: 0em;"><span class="mtd" id="MathJax-Span-1735"><span class="mrow" id="MathJax-Span-1736"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.152em;"></span></span><span style="position: absolute; clip: rect(2.452em, 1010.05em, 6.403em, -999.998em); top: -4.647em; left: 2.452em;"><span style="display: inline-block; position: relative; width: 10.152em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1007.5em, 4.402em, -999.998em); top: -5.298em; left: 0em;"><span class="mtd" id="MathJax-Span-1693"><span class="mrow" id="MathJax-Span-1694"><span class="mi" id="MathJax-Span-1695"></span><span class="mo" id="MathJax-Span-1696" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1697" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1698"><span class="mi" id="MathJax-Span-1699" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1700" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="mo" id="MathJax-Span-1701" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="mi" id="MathJax-Span-1702" style="font-family: MathJax_Math-italic;">α</span><span class="texatom" id="MathJax-Span-1703"><span class="mrow" id="MathJax-Span-1704"><span class="mi" id="MathJax-Span-1705" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1706" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1707" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-1708"><span class="mrow" id="MathJax-Span-1709"><span class="mi" id="MathJax-Span-1710" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1711" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1008.55em, 4.353em, -999.998em); top: -3.948em; left: 0em;"><span class="mtd" id="MathJax-Span-1714"><span class="mrow" id="MathJax-Span-1715"><span class="mi" id="MathJax-Span-1716"></span><span class="mo" id="MathJax-Span-1717" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1718" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1719"><span class="mi" id="MathJax-Span-1720" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1721" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="mi" id="MathJax-Span-1722" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">α</span><span class="texatom" id="MathJax-Span-1723"><span class="mrow" id="MathJax-Span-1724"><span class="mi" id="MathJax-Span-1725" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1726" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="texatom" id="MathJax-Span-1727" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1728"><span class="mi" id="MathJax-Span-1729" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1730" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="mi" id="MathJax-Span-1731" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-1732"><span class="mrow" id="MathJax-Span-1733"><span class="mi" id="MathJax-Span-1734" style="font-family: MathJax_Main-bold;">v</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.103em, 1010.05em, 4.402em, -999.998em); top: -2.647em; left: 0em;"><span class="mtd" id="MathJax-Span-1737"><span class="mrow" id="MathJax-Span-1738"><span class="mi" id="MathJax-Span-1739"></span><span class="mo" id="MathJax-Span-1740" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1741" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">α</span><span class="mo" id="MathJax-Span-1742" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1743"><span class="mrow" id="MathJax-Span-1744"><span class="mi" id="MathJax-Span-1745" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1746" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1747" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1748"><span class="mi" id="MathJax-Span-1749" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1750" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1751" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1752" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1753" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1754"><span class="mrow" id="MathJax-Span-1755"><span class="mi" id="MathJax-Span-1756" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1757" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1758" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1759"><span class="mi" id="MathJax-Span-1760" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1761" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.652em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.059em; border-left: 0px solid; width: 0px; height: 4.753em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mtr><mtd><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow></mtd><mtd><mi></mi><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mo stretchy="false">(</mo><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>+</mo><mi>β</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mi>β</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mi>α</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo stretchy="false">)</mo><mo>+</mo><mi>β</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-199"> \begin{align*}
     \mathbf{v} \times \mathbf{p} &= \mathbf{v} \times (\alpha \mathbf{u} + \beta \mathbf{v}) \\
     &= \mathbf{v} \times \alpha \mathbf{u} + \mathbf{v} \times \beta \mathbf{v} \\
     &= \alpha(\mathbf{v} \times \mathbf{u}) + \beta(\mathbf{v} \times \mathbf{v})
     \end{align*} </script>

</p><p>

Since any vector crossed with itself yields zero, these equations simplify to

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-200-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1762" style="width: 9.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1007.55em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1763"><span class="texatom" id="MathJax-Span-1764"><span class="mrow" id="MathJax-Span-1765"><span class="mi" id="MathJax-Span-1766" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1767" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1768" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1769"><span class="mi" id="MathJax-Span-1770" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-1771" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1772" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">α</span><span class="mo" id="MathJax-Span-1773" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1774"><span class="mrow" id="MathJax-Span-1775"><span class="mi" id="MathJax-Span-1776" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1777" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1778" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1779"><span class="mi" id="MathJax-Span-1780" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1781" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow><mo>=</mo><mi>α</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-200"> \mathbf{v} \times \mathbf{p} = \alpha(\mathbf{v} \times \mathbf{u}) </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-201-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1782" style="width: 9.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1007.5em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1783"><span class="texatom" id="MathJax-Span-1784"><span class="mrow" id="MathJax-Span-1785"><span class="mi" id="MathJax-Span-1786" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1787" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1788" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1789"><span class="mi" id="MathJax-Span-1790" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-1791" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1792" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1793" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1794"><span class="mrow" id="MathJax-Span-1795"><span class="mi" id="MathJax-Span-1796" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1797" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1798" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1799"><span class="mi" id="MathJax-Span-1800" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1801" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow><mo>=</mo><mi>β</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-201"> \mathbf{u} \times \mathbf{p} = \beta(\mathbf{u} \times \mathbf{v}) </script>

</p><p>

Now to solve for the coefficients <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-202-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1802" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.6em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1803"><span class="mi" id="MathJax-Span-1804" style="font-family: MathJax_Math-italic;">α</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-202">\alpha</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-203-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1805" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.55em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1806"><span class="mi" id="MathJax-Span-1807" style="font-family: MathJax_Math-italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi></math></span></span><script type="math/tex" id="MathJax-Element-203">\beta</script>. If you're new to vector math, you might try
to divide by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-204-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1808" style="width: 3.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.452em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.652em, 1002.4em, 2.452em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1809"><span class="texatom" id="MathJax-Span-1810"><span class="mrow" id="MathJax-Span-1811"><span class="mi" id="MathJax-Span-1812" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1813" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1814" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1815"><span class="mi" id="MathJax-Span-1816" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.753em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-204">\mathbf{u} \times \mathbf{v}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-205-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1817" style="width: 3.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.452em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.652em, 1002.45em, 2.452em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1818"><span class="texatom" id="MathJax-Span-1819"><span class="mrow" id="MathJax-Span-1820"><span class="mi" id="MathJax-Span-1821" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1822" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1823" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1824"><span class="mi" id="MathJax-Span-1825" style="font-family: MathJax_Main-bold;">u</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.753em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-205">\mathbf{v} \times \mathbf{u}</script>, but you can't divide
by vectors. Instead, we can take the dot product of both sides of the above equations with the plane
normal <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-206-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1826" style="width: 5.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.452em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.652em, 1004.4em, 2.452em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1827"><span class="texatom" id="MathJax-Span-1828"><span class="mrow" id="MathJax-Span-1829"><span class="mi" id="MathJax-Span-1830" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1831" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1832" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1833"><span class="mi" id="MathJax-Span-1834" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1835" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1836" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1837"><span class="mi" id="MathJax-Span-1838" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.753em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-206">\mathbf{n} = \mathbf{u} \times \mathbf{v}</script>, reducing both sides to scalars, which we <em class="underscore">can</em>
divide by.

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-207-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1839" style="width: 13.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.053em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1010.95em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1840"><span class="texatom" id="MathJax-Span-1841"><span class="mrow" id="MathJax-Span-1842"><span class="mi" id="MathJax-Span-1843" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1844" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-1845" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-1846"><span class="mrow" id="MathJax-Span-1847"><span class="mi" id="MathJax-Span-1848" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1849" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1850" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1851"><span class="mi" id="MathJax-Span-1852" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-1853" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1854" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1855" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1856"><span class="mi" id="MathJax-Span-1857" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1858" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-1859" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">α</span><span class="mo" id="MathJax-Span-1860" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1861"><span class="mrow" id="MathJax-Span-1862"><span class="mi" id="MathJax-Span-1863" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1864" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1865" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1866"><span class="mi" id="MathJax-Span-1867" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1868" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mi>α</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-207"> \mathbf{n} \cdot (\mathbf{v} \times \mathbf{p})
     = \mathbf{n} \cdot \alpha(\mathbf{v} \times \mathbf{u}) </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-208-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1869" style="width: 13.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.053em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1010.95em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1870"><span class="texatom" id="MathJax-Span-1871"><span class="mrow" id="MathJax-Span-1872"><span class="mi" id="MathJax-Span-1873" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1874" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-1875" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-1876"><span class="mrow" id="MathJax-Span-1877"><span class="mi" id="MathJax-Span-1878" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1879" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1880" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1881"><span class="mi" id="MathJax-Span-1882" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-1883" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1884" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1885" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1886"><span class="mi" id="MathJax-Span-1887" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1888" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-1889" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1890" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1891"><span class="mrow" id="MathJax-Span-1892"><span class="mi" id="MathJax-Span-1893" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1894" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1895" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1896"><span class="mi" id="MathJax-Span-1897" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1898" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mi>β</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-208"> \mathbf{n} \cdot (\mathbf{u} \times \mathbf{p})
     = \mathbf{n} \cdot \beta(\mathbf{u} \times \mathbf{v}) </script>

</p><p>

Now isolating the coefficients is a simple matter of division:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-209-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1899" style="width: 8.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.703em, 1006.9em, 3.402em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1900"><span class="mi" id="MathJax-Span-1901" style="font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-1902" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-1903" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 4.652em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.103em, 1004.45em, 4.402em, -999.998em); top: -4.697em; left: 50%; margin-left: -2.248em;"><span class="mrow" id="MathJax-Span-1904"><span class="texatom" id="MathJax-Span-1905"><span class="mrow" id="MathJax-Span-1906"><span class="mi" id="MathJax-Span-1907" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1908" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-1909" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-1910"><span class="mrow" id="MathJax-Span-1911"><span class="mi" id="MathJax-Span-1912" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1913" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1914" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1915"><span class="mi" id="MathJax-Span-1916" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-1917" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.103em, 1004.45em, 4.402em, -999.998em); top: -3.298em; left: 50%; margin-left: -2.248em;"><span class="mrow" id="MathJax-Span-1918"><span class="texatom" id="MathJax-Span-1919"><span class="mrow" id="MathJax-Span-1920"><span class="mi" id="MathJax-Span-1921" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1922" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-1923" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-1924"><span class="mrow" id="MathJax-Span-1925"><span class="mi" id="MathJax-Span-1926" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1927" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1928" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1929"><span class="mi" id="MathJax-Span-1930" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1931" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1004.65em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.652em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.247em; border-left: 0px solid; width: 0px; height: 3.191em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>α</mi><mo>=</mo><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow><mo stretchy="false">)</mo></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo stretchy="false">)</mo></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-209"> \alpha = \frac{\mathbf{n} \cdot (\mathbf{v} \times \mathbf{p})}
                   {\mathbf{n} \cdot (\mathbf{v} \times \mathbf{u})} </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-210-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1932" style="width: 8.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.703em, 1006.85em, 3.402em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1933"><span class="mi" id="MathJax-Span-1934" style="font-family: MathJax_Math-italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1935" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-1936" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 4.702em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.103em, 1004.45em, 4.402em, -999.998em); top: -4.697em; left: 50%; margin-left: -2.298em;"><span class="mrow" id="MathJax-Span-1937"><span class="texatom" id="MathJax-Span-1938"><span class="mrow" id="MathJax-Span-1939"><span class="mi" id="MathJax-Span-1940" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1941" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-1942" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-1943"><span class="mrow" id="MathJax-Span-1944"><span class="mi" id="MathJax-Span-1945" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1946" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1947" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1948"><span class="mi" id="MathJax-Span-1949" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-1950" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.103em, 1004.45em, 4.402em, -999.998em); top: -3.298em; left: 50%; margin-left: -2.248em;"><span class="mrow" id="MathJax-Span-1951"><span class="texatom" id="MathJax-Span-1952"><span class="mrow" id="MathJax-Span-1953"><span class="mi" id="MathJax-Span-1954" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1955" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-1956" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-1957"><span class="mrow" id="MathJax-Span-1958"><span class="mi" id="MathJax-Span-1959" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-1960" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1961" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1962"><span class="mi" id="MathJax-Span-1963" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-1964" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1004.7em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.702em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.247em; border-left: 0px solid; width: 0px; height: 3.191em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>β</mi><mo>=</mo><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow><mo stretchy="false">)</mo></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-210"> \beta  = \frac{\mathbf{n} \cdot (\mathbf{u} \times \mathbf{p})}
                   {\mathbf{n} \cdot (\mathbf{u} \times \mathbf{v})} </script>

</p><p>

Reversing the cross products for both the numerator and denominator of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-211-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1965" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.6em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1966"><span class="mi" id="MathJax-Span-1967" style="font-family: MathJax_Math-italic;">α</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-211">\alpha</script> (recall that
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-212-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1968" style="width: 8.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1006.9em, 2.552em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1969"><span class="texatom" id="MathJax-Span-1970"><span class="mrow" id="MathJax-Span-1971"><span class="mi" id="MathJax-Span-1972" style="font-family: MathJax_Main-bold;">a</span></span></span><span class="mo" id="MathJax-Span-1973" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1974" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1975"><span class="mi" id="MathJax-Span-1976" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-1977" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-1978" style="font-family: MathJax_Main; padding-left: 0.302em;">−</span><span class="texatom" id="MathJax-Span-1979"><span class="mrow" id="MathJax-Span-1980"><span class="mi" id="MathJax-Span-1981" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-1982" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-1983" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1984"><span class="mi" id="MathJax-Span-1985" style="font-family: MathJax_Main-bold;">a</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>=</mo><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-212">\mathbf{a} \times \mathbf{b} = - \mathbf{b} \times \mathbf{a}</script>) gives us a common denominator for
both coefficients:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-213-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1986" style="width: 8.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.703em, 1006.9em, 3.402em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1987"><span class="mi" id="MathJax-Span-1988" style="font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-1989" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-1990" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 4.652em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.103em, 1004.45em, 4.402em, -999.998em); top: -4.697em; left: 50%; margin-left: -2.248em;"><span class="mrow" id="MathJax-Span-1991"><span class="texatom" id="MathJax-Span-1992"><span class="mrow" id="MathJax-Span-1993"><span class="mi" id="MathJax-Span-1994" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1995" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-1996" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-1997"><span class="mrow" id="MathJax-Span-1998"><span class="mi" id="MathJax-Span-1999" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-2000" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-2001" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-2002"><span class="mi" id="MathJax-Span-2003" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-2004" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.103em, 1004.45em, 4.402em, -999.998em); top: -3.298em; left: 50%; margin-left: -2.248em;"><span class="mrow" id="MathJax-Span-2005"><span class="texatom" id="MathJax-Span-2006"><span class="mrow" id="MathJax-Span-2007"><span class="mi" id="MathJax-Span-2008" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-2009" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-2010" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-2011"><span class="mrow" id="MathJax-Span-2012"><span class="mi" id="MathJax-Span-2013" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-2014" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-2015" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-2016"><span class="mi" id="MathJax-Span-2017" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-2018" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1004.65em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.652em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.247em; border-left: 0px solid; width: 0px; height: 3.191em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>α</mi><mo>=</mo><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-213"> \alpha = \frac{\mathbf{n} \cdot (\mathbf{p} \times \mathbf{v})}
                   {\mathbf{n} \cdot (\mathbf{u} \times \mathbf{v})} </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-214-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2019" style="width: 8.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.703em, 1006.85em, 3.402em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-2020"><span class="mi" id="MathJax-Span-2021" style="font-family: MathJax_Math-italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2022" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-2023" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 4.702em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.103em, 1004.45em, 4.402em, -999.998em); top: -4.697em; left: 50%; margin-left: -2.298em;"><span class="mrow" id="MathJax-Span-2024"><span class="texatom" id="MathJax-Span-2025"><span class="mrow" id="MathJax-Span-2026"><span class="mi" id="MathJax-Span-2027" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-2028" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-2029" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-2030"><span class="mrow" id="MathJax-Span-2031"><span class="mi" id="MathJax-Span-2032" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-2033" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-2034" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-2035"><span class="mi" id="MathJax-Span-2036" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-2037" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.103em, 1004.45em, 4.402em, -999.998em); top: -3.298em; left: 50%; margin-left: -2.248em;"><span class="mrow" id="MathJax-Span-2038"><span class="texatom" id="MathJax-Span-2039"><span class="mrow" id="MathJax-Span-2040"><span class="mi" id="MathJax-Span-2041" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-2042" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-2043" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-2044"><span class="mrow" id="MathJax-Span-2045"><span class="mi" id="MathJax-Span-2046" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-2047" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-2048" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-2049"><span class="mi" id="MathJax-Span-2050" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-2051" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1004.7em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.702em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.247em; border-left: 0px solid; width: 0px; height: 3.191em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>β</mi><mo>=</mo><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow><mo stretchy="false">)</mo></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-214"> \beta  = \frac{\mathbf{n} \cdot (\mathbf{u} \times \mathbf{p})}
                   {\mathbf{n} \cdot (\mathbf{u} \times \mathbf{v})} </script>

</p><p>

Now we can perform one final simplification, computing a vector <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-215-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;w&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2052" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.8em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-2053"><span class="texatom" id="MathJax-Span-2054"><span class="mrow" id="MathJax-Span-2055"><span class="mi" id="MathJax-Span-2056" style="font-family: MathJax_Main-bold;">w</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">w</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-215">\mathbf{w}</script> that will be constant
for the plane's basis frame, for any planar point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-216-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2057" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-2058"><span class="texatom" id="MathJax-Span-2059"><span class="mrow" id="MathJax-Span-2060"><span class="mi" id="MathJax-Span-2061" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-216">\mathbf{P}</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-217-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;w&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2062" style="width: 13.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.002em, 1010.75em, 3.402em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-2063"><span class="texatom" id="MathJax-Span-2064"><span class="mrow" id="MathJax-Span-2065"><span class="mi" id="MathJax-Span-2066" style="font-family: MathJax_Main-bold;">w</span></span></span><span class="mo" id="MathJax-Span-2067" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-2068" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 4.652em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.402em, 1000.6em, 4.152em, -999.998em); top: -4.697em; left: 50%; margin-left: -0.297em;"><span class="texatom" id="MathJax-Span-2069"><span class="mrow" id="MathJax-Span-2070"><span class="mi" id="MathJax-Span-2071" style="font-family: MathJax_Main-bold;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.103em, 1004.45em, 4.402em, -999.998em); top: -3.298em; left: 50%; margin-left: -2.248em;"><span class="mrow" id="MathJax-Span-2072"><span class="texatom" id="MathJax-Span-2073"><span class="mrow" id="MathJax-Span-2074"><span class="mi" id="MathJax-Span-2075" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-2076" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-2077" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-2078"><span class="mrow" id="MathJax-Span-2079"><span class="mi" id="MathJax-Span-2080" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-2081" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-2082" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-2083"><span class="mi" id="MathJax-Span-2084" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-2085" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1004.65em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.652em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-2086" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-2087" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 2.103em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.402em, 1000.6em, 4.152em, -999.998em); top: -4.697em; left: 50%; margin-left: -0.297em;"><span class="texatom" id="MathJax-Span-2088"><span class="mrow" id="MathJax-Span-2089"><span class="mi" id="MathJax-Span-2090" style="font-family: MathJax_Main-bold;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.402em, 1001.95em, 4.152em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.997em;"><span class="mrow" id="MathJax-Span-2091"><span class="texatom" id="MathJax-Span-2092"><span class="mrow" id="MathJax-Span-2093"><span class="mi" id="MathJax-Span-2094" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-2095" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-2096" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-2097"><span class="mi" id="MathJax-Span-2098" style="font-family: MathJax_Main-bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1002.1em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.103em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.247em; border-left: 0px solid; width: 0px; height: 2.753em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">w</mi></mrow><mo>=</mo><mfrac><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></mrow></mfrac><mo>=</mo><mfrac><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-217"> \mathbf{w} = \frac{\mathbf{n}}{\mathbf{n} \cdot (\mathbf{u} \times \mathbf{v})}
                = \frac{\mathbf{n}}{\mathbf{n} \cdot \mathbf{n}}</script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-218-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;w&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2099" style="width: 8.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1006.65em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-2100"><span class="mi" id="MathJax-Span-2101" style="font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-2102" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-2103" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-2104"><span class="mi" id="MathJax-Span-2105" style="font-family: MathJax_Main-bold;">w</span></span></span><span class="mo" id="MathJax-Span-2106" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-2107" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-2108"><span class="mrow" id="MathJax-Span-2109"><span class="mi" id="MathJax-Span-2110" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-2111" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-2112" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-2113"><span class="mi" id="MathJax-Span-2114" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-2115" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>α</mi><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">w</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-218"> \alpha = \mathbf{w} \cdot (\mathbf{p} \times \mathbf{v}) </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-219-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;w&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2116" style="width: 8.402em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.703em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1006.6em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-2117"><span class="mi" id="MathJax-Span-2118" style="font-family: MathJax_Math-italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2119" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-2120" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-2121"><span class="mi" id="MathJax-Span-2122" style="font-family: MathJax_Main-bold;">w</span></span></span><span class="mo" id="MathJax-Span-2123" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-2124" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-2125"><span class="mrow" id="MathJax-Span-2126"><span class="mi" id="MathJax-Span-2127" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-2128" style="font-family: MathJax_Main; padding-left: 0.202em;">×</span><span class="texatom" id="MathJax-Span-2129" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-2130"><span class="mi" id="MathJax-Span-2131" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-2132" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>β</mi><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">w</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">u</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-219"> \beta  = \mathbf{w} \cdot (\mathbf{u} \times \mathbf{p}) </script>

</p><p>

The vector <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-220-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;w&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2133" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.8em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-2134"><span class="texatom" id="MathJax-Span-2135"><span class="mrow" id="MathJax-Span-2136"><span class="mi" id="MathJax-Span-2137" style="font-family: MathJax_Main-bold;">w</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">w</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-220">\mathbf{w}</script> is constant for a given quadrilateral, so we'll cache that value.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">quad</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">quad</span>(<span class="hljs-type">const</span> point3&amp; _Q, <span class="hljs-type">const</span> vec3&amp; _u, <span class="hljs-type">const</span> vec3&amp; _v, shared_ptr&lt;material&gt; m)
<span class="line"></span>      : <span class="hljs-built_in">Q</span>(_Q), <span class="hljs-built_in">u</span>(_u), <span class="hljs-built_in">v</span>(_v), <span class="hljs-built_in">mat</span>(m)
<span class="line"></span>    {
<span class="line"></span>        <span class="hljs-keyword">auto</span> n = <span class="hljs-built_in">cross</span>(u, v);
<span class="line"></span>        normal = <span class="hljs-built_in">unit_vector</span>(n);
<span class="line"></span>        D = <span class="hljs-built_in">dot</span>(normal, Q);<div class=" highlight"><span class="line"></span>        w = n / <span class="hljs-built_in">dot</span>(n,n);</div><span class="line"></span>
<span class="line"></span>        <span class="hljs-built_in">set_bounding_box</span>();
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    point3 Q;
<span class="line"></span>    vec3 u, v;
<span class="line"></span>    shared_ptr&lt;material&gt; mat;
<span class="line"></span>    aabb bbox;
<span class="line"></span>    vec3 normal;
<span class="line"></span>    <span class="hljs-type">double</span> D;<div class=" highlight"><span class="line"></span>    vec3 w;</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_quad-w">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;52:</b> <kbd>[quad.h]</kbd> Caching the quadrilateral's w value</div></center>

<a class="target" name="interiortestingoftheintersectionusinguvcoordinates">&nbsp;</a><a class="target" name="quadrilaterals/interiortestingoftheintersectionusinguvcoordinates">&nbsp;</a><a class="target" name="toc6.5">&nbsp;</a><h2>Interior Testing of The Intersection Using UV Coordinates</h2>
<p>

Now that we have the intersection point's planar coordinates <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-221-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2138" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.6em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-2139"><span class="mi" id="MathJax-Span-2140" style="font-family: MathJax_Math-italic;">α</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-221">\alpha</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-222-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2141" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.55em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-2142"><span class="mi" id="MathJax-Span-2143" style="font-family: MathJax_Math-italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi></math></span></span><script type="math/tex" id="MathJax-Element-222">\beta</script>, we can easily
use these to determine if the intersection point is inside the quadrilateral — that is, if the ray
actually hit the quadrilateral.

</p><p>

</p><div class="together">
The plane is divided into coordinate regions like so:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/fig-2.07-quad-coords.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing_ The Next Week_files/fig-2.07-quad-coords.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_quad-coords">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;7:</b> Quadrilateral coordinates</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

Thus, to see if a point with planar coordinates <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-223-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2144" style="width: 3.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.3em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2145"><span class="mo" id="MathJax-Span-2146" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2147" style="font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-2148" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-2149" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2150" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>α</mi><mo>,</mo><mi>β</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-223">(\alpha,\beta)</script> lies inside the quadrilateral, it
just needs to meet the following criteria:

</p><p>

</p><ol start="1">
  <li class="number"><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-224-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2151" style="width: 5.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1004.35em, 2.452em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2152"><span class="mn" id="MathJax-Span-2153" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-2154" style="font-family: MathJax_Main; padding-left: 0.302em;">≤</span><span class="mi" id="MathJax-Span-2155" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">α</span><span class="mo" id="MathJax-Span-2156" style="font-family: MathJax_Main; padding-left: 0.302em;">≤</span><span class="mn" id="MathJax-Span-2157" style="font-family: MathJax_Main; padding-left: 0.302em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mo>≤</mo><mi>α</mi><mo>≤</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-224"> 0 \leq \alpha \leq 1 </script>
</li>
  <li class="number"><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-225-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2158" style="width: 5.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1004.3em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2159"><span class="mn" id="MathJax-Span-2160" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-2161" style="font-family: MathJax_Main; padding-left: 0.302em;">≤</span><span class="mi" id="MathJax-Span-2162" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2163" style="font-family: MathJax_Main; padding-left: 0.302em;">≤</span><span class="mn" id="MathJax-Span-2164" style="font-family: MathJax_Main; padding-left: 0.302em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mo>≤</mo><mi>β</mi><mo>≤</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-225"> 0 \leq \beta \leq 1 </script></li></ol>

<p></p><p>

That's the last piece needed to implement quadrilateral primitives.

</p><p>

Pause a bit here and consider that if you use the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-226-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2165" style="width: 3.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.3em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2166"><span class="mo" id="MathJax-Span-2167" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2168" style="font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-2169" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-2170" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2171" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>α</mi><mo>,</mo><mi>β</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-226">(\alpha,\beta)</script> coordinates to determine if a
point lies inside a quadrilateral (parallelogram), it's not too hard to imagine using these same 2D
coordinates to determine if the intersection point lies inside <em class="underscore">any</em> other 2D (planar) primitive!

</p><p>

We'll leave these additional 2D shape possibilities as an exercise to the reader, depending on your
desire to explore. Consider triangles, disks, and rings (all of these are surprisingly easy). You
could even create cut-out stencils based on the pixels of a texture map, or a Mandelbrot shape!

</p><p>

In order to make such experimentation a bit easier, we'll factor out the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-227-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2172" style="width: 3.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.3em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2173"><span class="mo" id="MathJax-Span-2174" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2175" style="font-family: MathJax_Math-italic;">α</span><span class="mo" id="MathJax-Span-2176" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-2177" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2178" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>α</mi><mo>,</mo><mi>β</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-227">(\alpha,\beta)</script> interior
test method from the hit method.

</p><pre class="listing tilde"><code><span class="line"></span>...<div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span></div><span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">quad</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">auto</span> denom = <span class="hljs-built_in">dot</span>(normal, r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// No hit if the ray is parallel to the plane.</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">fabs</span>(denom) &lt; <span class="hljs-number">1e-8</span>)
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Return false if the hit point parameter t is outside the ray interval.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> t = (D - <span class="hljs-built_in">dot</span>(normal, r.<span class="hljs-built_in">origin</span>())) / denom;
<span class="line"></span>        <span class="hljs-keyword">if</span> (!<span class="hljs-type">ray_t</span>.<span class="hljs-built_in">contains</span>(t))
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>        <span class="hljs-comment">// Determine the hit point lies within the planar shape using its plane coordinates.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> intersection = r.<span class="hljs-built_in">at</span>(t);
<span class="line"></span>        vec3 planar_hitpt_vector = intersection - Q;
<span class="line"></span>        <span class="hljs-keyword">auto</span> alpha = <span class="hljs-built_in">dot</span>(w, <span class="hljs-built_in">cross</span>(planar_hitpt_vector, v));
<span class="line"></span>        <span class="hljs-keyword">auto</span> beta = <span class="hljs-built_in">dot</span>(w, <span class="hljs-built_in">cross</span>(u, planar_hitpt_vector));
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">is_interior</span>(alpha, beta, rec))
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Ray hits the 2D shape; set the rest of the hit record and return true.</span></div><span class="line"></span>        rec.t = t;
<span class="line"></span>        rec.p = intersection;
<span class="line"></span>        rec.mat = mat;
<span class="line"></span>        rec.<span class="hljs-built_in">set_face_normal</span>(r, normal);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">bool</span> <span class="hljs-title">is_interior</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b, hit_record&amp; rec)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Given the hit point in plane coordinates, return false if it is outside the</span>
<span class="line"></span>        <span class="hljs-comment">// primitive, otherwise set the hit record UV coordinates and return true.</span>
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> ((a &lt; <span class="hljs-number">0</span>) || (<span class="hljs-number">1</span> &lt; a) || (b &lt; <span class="hljs-number">0</span>) || (<span class="hljs-number">1</span> &lt; b))
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        rec.u = a;
<span class="line"></span>        rec.v = b;
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }</div><span class="line"></span>    ...
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_quad-final">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;53:</b> <kbd>[quad.h]</kbd> Final quad class</div></center>
<p>


</p><div class="together">
And now we add a new scene to demonstrate our new <code>quad</code> primitive:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span>...</div><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"quad.h"</span></span></div><span class="line"></span>...<div class=" highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">quads</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Materials</span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> left_red     = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> back_green   = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.2</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.2</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> right_blue   = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">1.0</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> upper_orange = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.0</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> lower_teal   = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.2</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Quads</span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">-3</span>,<span class="hljs-number">-2</span>, <span class="hljs-number">5</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<span class="hljs-number">-4</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>), left_red));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">-2</span>,<span class="hljs-number">-2</span>, <span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>), back_green));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>( <span class="hljs-number">3</span>,<span class="hljs-number">-2</span>, <span class="hljs-number">1</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>), right_blue));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">-2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>), upper_orange));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">-2</span>,<span class="hljs-number">-3</span>, <span class="hljs-number">5</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<span class="hljs-number">-4</span>), lower_teal));
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">1.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>
<span class="line"></span>    cam.vfov     = <span class="hljs-number">80</span>;
<span class="line"></span>    cam.lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">9</span>);
<span class="line"></span>    cam.lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>    cam.vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.defocus_angle = <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">switch</span> (<span class="hljs-number">5</span>) {</div><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:  <span class="hljs-built_in">random_spheres</span>();     <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:  <span class="hljs-built_in">two_spheres</span>();        <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:  <span class="hljs-built_in">earth</span>();              <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:  <span class="hljs-built_in">two_perlin_spheres</span>(); <span class="hljs-keyword">break</span>;<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:  <span class="hljs-built_in">quads</span>();              <span class="hljs-keyword">break</span>;</div><span class="line"></span>    }
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_quad-scene">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;54:</b> <kbd>[main.cc]</kbd> A new scene with quads</div></center>
<p>

</p></div>

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.16-quads.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.16-quads.png"></a><center><span class="imagecaption"><span class="num">Image 16:</span> Quads</span></center></div></center>

<p></p>
<a class="target" name="lights">&nbsp;</a><a class="target" name="lights">&nbsp;</a><a class="target" name="toc7">&nbsp;</a><h1>Lights</h1>
<p>

Lighting is a key component of raytracing. Early simple raytracers used abstract light sources, like
points in space, or directions. Modern approaches have more physically based lights, which have
position and size. To create such light sources, we need to be able to take any regular object and
turn it into something that emits light into our scene.

</p>
<a class="target" name="emissivematerials">&nbsp;</a><a class="target" name="lights/emissivematerials">&nbsp;</a><a class="target" name="toc7.1">&nbsp;</a><h2>Emissive Materials</h2>
<p>

First, let’s make a light emitting material. We need to add an emitted function (we could also add
it to <code>hit_record</code> instead — that’s a matter of design taste). Like the background, it just tells
the ray what color it is and performs no reflection. It’s very simple:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">diffuse_light</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">diffuse_light</span>(shared_ptr&lt;texture&gt; a) : <span class="hljs-built_in">emit</span>(a) {}
<span class="line"></span>    <span class="hljs-built_in">diffuse_light</span>(color c) : <span class="hljs-built_in">emit</span>(<span class="hljs-built_in">make_shared</span>&lt;solid_color&gt;(c)) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">emitted</span><span class="hljs-params">(<span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> emit-&gt;<span class="hljs-built_in">value</span>(u, v, p);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    shared_ptr&lt;texture&gt; emit;
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_diffuse-light">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;55:</b> <kbd>[material.h]</kbd> A diffuse light class</div></center>
<p>


</p><div class="together">
So that I don’t have to make all the non-emitting materials implement <code>emitted()</code>, I have the base
class return black:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">material</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> color <span class="hljs-title">emitted</span><span class="hljs-params">(<span class="hljs-type">double</span> u, <span class="hljs-type">double</span> v, <span class="hljs-type">const</span> point3&amp; p)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>    }</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(
<span class="line"></span>        <span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered
<span class="line"></span>    )</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_matl-emit">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;56:</b> <kbd>[material.h]</kbd> New emitted function in class material</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="addingbackgroundcolortotheraycolorfunction">&nbsp;</a><a class="target" name="lights/addingbackgroundcolortotheraycolorfunction">&nbsp;</a><a class="target" name="toc7.2">&nbsp;</a><h2>Adding Background Color to the Ray Color Function</h2>
<p>

Next, we want a pure black background so the only light in the scene is coming from the emitters. To
do this, we’ll add a background color parameter to our <code>ray_color</code> function, and pay attention to
the new <code>color_from_emission</code> value.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-type">double</span> aspect_ratio      = <span class="hljs-number">1.0</span>;  <span class="hljs-comment">// Ratio of image width over height</span>
<span class="line"></span>    <span class="hljs-type">int</span>    image_width       = <span class="hljs-number">100</span>;  <span class="hljs-comment">// Rendered image width in pixel count</span>
<span class="line"></span>    <span class="hljs-type">int</span>    samples_per_pixel = <span class="hljs-number">10</span>;   <span class="hljs-comment">// Count of random samples for each pixel</span>
<span class="line"></span>    <span class="hljs-type">int</span>    max_depth         = <span class="hljs-number">10</span>;   <span class="hljs-comment">// Maximum number of ray bounces into scene</span><div class=" highlight"><span class="line"></span>    color  background;               <span class="hljs-comment">// Scene background color</span></div><span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">int</span> depth, <span class="hljs-type">const</span> hittable&amp; world)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        hit_record rec;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// If we've exceeded the ray bounce limit, no more light is gathered.</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (depth &lt;= <span class="hljs-number">0</span>)
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>        <span class="hljs-comment">// If the ray hits nothing, return the background color.</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (!world.<span class="hljs-built_in">hit</span>(r, <span class="hljs-built_in">interval</span>(<span class="hljs-number">0.001</span>, infinity), rec))
<span class="line"></span>            <span class="hljs-keyword">return</span> background;
<span class="line"></span>
<span class="line"></span>        ray scattered;
<span class="line"></span>        color attenuation;
<span class="line"></span>        color color_from_emission = rec.mat-&gt;<span class="hljs-built_in">emitted</span>(rec.u, rec.v, rec.p);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (!rec.mat-&gt;<span class="hljs-built_in">scatter</span>(r, rec, attenuation, scattered))
<span class="line"></span>            <span class="hljs-keyword">return</span> color_from_emission;
<span class="line"></span>
<span class="line"></span>        color color_from_scatter = attenuation * <span class="hljs-built_in">ray_color</span>(scattered, depth<span class="hljs-number">-1</span>, world);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> color_from_emission + color_from_scatter;</div><span class="line"></span>    }
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-color-emitted">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;57:</b> <kbd>[camera.h]</kbd>
    ray_color function with background and emitting materials</div></center>
<p>


</p><div class="together">
<code>main()</code> is updated to set the background color for the prior scenes:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">random_spheres</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;<div class=" highlight"><span class="line"></span>    cam.background        = <span class="hljs-built_in">color</span>(<span class="hljs-number">0.70</span>, <span class="hljs-number">0.80</span>, <span class="hljs-number">1.00</span>);</div><span class="line"></span>    ...
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">two_spheres</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;<div class=" highlight"><span class="line"></span>    cam.background        = <span class="hljs-built_in">color</span>(<span class="hljs-number">0.70</span>, <span class="hljs-number">0.80</span>, <span class="hljs-number">1.00</span>);</div><span class="line"></span>    ...
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">earth</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;<div class=" highlight"><span class="line"></span>    cam.background        = <span class="hljs-built_in">color</span>(<span class="hljs-number">0.70</span>, <span class="hljs-number">0.80</span>, <span class="hljs-number">1.00</span>);</div><span class="line"></span>    ...
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">two_perlin_spheres</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;<div class=" highlight"><span class="line"></span>    cam.background        = <span class="hljs-built_in">color</span>(<span class="hljs-number">0.70</span>, <span class="hljs-number">0.80</span>, <span class="hljs-number">1.00</span>);</div><span class="line"></span>    ...
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">quads</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">1.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;<div class=" highlight"><span class="line"></span>    cam.background        = <span class="hljs-built_in">color</span>(<span class="hljs-number">0.70</span>, <span class="hljs-number">0.80</span>, <span class="hljs-number">1.00</span>);</div><span class="line"></span>    ...
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_use-bg-color">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;58:</b> <kbd>[main.cc]</kbd> Specifying new background color</div></center>
<p>


</p></div>

<p></p><p>

Since we're removing the code that we used to determine the color of the sky when a ray hit it, we
need to pass in a new color value for our old scene renders. We've elected to stick with a flat
bluish-white for the whole sky. You could always pass in a boolean to switch between the previous
skybox code versus the new solid color background. We're keeping it simple here.

</p>
<a class="target" name="turningobjectsintolights">&nbsp;</a><a class="target" name="lights/turningobjectsintolights">&nbsp;</a><a class="target" name="toc7.3">&nbsp;</a><h2>Turning Objects into Lights</h2>
<p>

If we set up a rectangle as a light:

</p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">simple_light</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> pertext = <span class="hljs-built_in">make_shared</span>&lt;noise_texture&gt;(<span class="hljs-number">4</span>);
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">-1000</span>,<span class="hljs-number">0</span>), <span class="hljs-number">1000</span>, <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(pertext)));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>), <span class="hljs-number">2</span>, <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(pertext)));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> difflight = <span class="hljs-built_in">make_shared</span>&lt;diffuse_light&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">4</span>,<span class="hljs-number">4</span>,<span class="hljs-number">4</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">-2</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>), difflight));
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>    cam.background        = <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.vfov     = <span class="hljs-number">20</span>;
<span class="line"></span>    cam.lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">26</span>,<span class="hljs-number">3</span>,<span class="hljs-number">6</span>);
<span class="line"></span>    cam.lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>);
<span class="line"></span>    cam.vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.defocus_angle = <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">switch</span> (<span class="hljs-number">6</span>) {</div><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:  <span class="hljs-built_in">random_spheres</span>();     <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:  <span class="hljs-built_in">two_spheres</span>();        <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:  <span class="hljs-built_in">earth</span>();              <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:  <span class="hljs-built_in">two_perlin_spheres</span>(); <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:  <span class="hljs-built_in">quads</span>();              <span class="hljs-keyword">break</span>;<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:  <span class="hljs-built_in">simple_light</span>();       <span class="hljs-keyword">break</span>;</div><span class="line"></span>    }
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_rect-light">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;59:</b> <kbd>[main.cc]</kbd> A simple rectangle light</div></center>
<p>


</p><div class="together">
We get:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.17-rect-light.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.17-rect-light.png"></a><center><span class="imagecaption"><span class="num">Image 17:</span> Scene with rectangle light source
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

Note that the light is brighter than <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-228-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2179" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.05em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2180"><span class="mo" id="MathJax-Span-2181" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-2182" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-2183" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2184" style="font-family: MathJax_Main; padding-left: 0.152em;">1</span><span class="mo" id="MathJax-Span-2185" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2186" style="font-family: MathJax_Main; padding-left: 0.152em;">1</span><span class="mo" id="MathJax-Span-2187" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-228">(1,1,1)</script>. This allows it to be bright enough to light things.

</p><p>

Fool around with making some spheres lights too.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">simple_light</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-keyword">auto</span> difflight = <span class="hljs-built_in">make_shared</span>&lt;diffuse_light&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">4</span>,<span class="hljs-number">4</span>,<span class="hljs-number">4</span>));<div class=" highlight"><span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">7</span>,<span class="hljs-number">0</span>), <span class="hljs-number">2</span>, difflight));</div><span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">-2</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>), difflight));
<span class="line"></span>    ...
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_rect-light">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;60:</b> <kbd>[main.cc]</kbd> A simple rectangle light plus illuminating ball</div></center>
<p>


  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.18-rect-sphere-light.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.18-rect-sphere-light.png"></a><center><span class="imagecaption"><span class="num">Image 18:</span> Scene with rectangle and sphere light sources
  </span></center></div></center>

<p></p>
<a class="target" name="creatinganempty%E2%80%9Ccornellbox%E2%80%9D">&nbsp;</a><a class="target" name="lights/creatinganempty%E2%80%9Ccornellbox%E2%80%9D">&nbsp;</a><a class="target" name="toc7.4">&nbsp;</a><h2>Creating an Empty “Cornell Box”</h2>
<p>

The “Cornell Box” was introduced in 1984 to model the interaction of light between diffuse surfaces.
Let’s make the 5 walls and the light of the box:

</p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">cornell_box</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> red   = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">.65</span>, <span class="hljs-number">.05</span>, <span class="hljs-number">.05</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> white = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">.73</span>, <span class="hljs-number">.73</span>, <span class="hljs-number">.73</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> green = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">.12</span>, <span class="hljs-number">.45</span>, <span class="hljs-number">.15</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> light = <span class="hljs-built_in">make_shared</span>&lt;diffuse_light&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">15</span>, <span class="hljs-number">15</span>, <span class="hljs-number">15</span>));
<span class="line"></span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">555</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), green));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">555</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), red));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">343</span>, <span class="hljs-number">554</span>, <span class="hljs-number">332</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">-130</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-105</span>), light));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), white));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">555</span>,<span class="hljs-number">555</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">-555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-555</span>), white));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">555</span>,<span class="hljs-number">0</span>), white));
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">1.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">600</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">200</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>    cam.background        = <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.vfov     = <span class="hljs-number">40</span>;
<span class="line"></span>    cam.lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">278</span>, <span class="hljs-number">278</span>, <span class="hljs-number">-800</span>);
<span class="line"></span>    cam.lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">278</span>, <span class="hljs-number">278</span>, <span class="hljs-number">0</span>);
<span class="line"></span>    cam.vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.defocus_angle = <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">switch</span> (<span class="hljs-number">7</span>) {</div><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:  <span class="hljs-built_in">random_spheres</span>();     <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:  <span class="hljs-built_in">two_spheres</span>();        <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:  <span class="hljs-built_in">earth</span>();              <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:  <span class="hljs-built_in">two_perlin_spheres</span>(); <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:  <span class="hljs-built_in">quads</span>();              <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:  <span class="hljs-built_in">simple_light</span>();       <span class="hljs-keyword">break</span>;<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:  <span class="hljs-built_in">cornell_box</span>();        <span class="hljs-keyword">break</span>;</div><span class="line"></span>    }
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_cornell-box-empty">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;61:</b> <kbd>[main.cc]</kbd> Cornell box scene, empty</div></center>
<p>


</p><div class="together">
We get:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.19-cornell-empty.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.19-cornell-empty.png"></a><center><span class="imagecaption"><span class="num">Image 19:</span> Empty Cornell box
  </span></center></div></center>

<p></p><p>

This image is very noisy because the light is small.

</p><p>

</p></div>

<p></p>
<a class="target" name="instances">&nbsp;</a><a class="target" name="instances">&nbsp;</a><a class="target" name="toc8">&nbsp;</a><h1>Instances</h1>
<p>

The Cornell Box usually has two blocks in it. These are rotated relative to the walls. First, let’s
create a function that returns a box, by creating a <code>hittable_list</code> of six rectangles:

</p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable_list.h"</span></span>
<span class="line"></span>...
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> shared_ptr&lt;hittable_list&gt; <span class="hljs-title">box</span><span class="hljs-params">(<span class="hljs-type">const</span> point3&amp; a, <span class="hljs-type">const</span> point3&amp; b, shared_ptr&lt;material&gt; mat)</span>
<span class="line"></span></span>{
<span class="line"></span>    <span class="hljs-comment">// Returns the 3D box (six sides) that contains the two opposite vertices a &amp; b.</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> sides = <span class="hljs-built_in">make_shared</span>&lt;hittable_list&gt;();
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Construct the two opposite vertices with the minimum and maximum coordinates.</span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> min = <span class="hljs-built_in">point3</span>(<span class="hljs-built_in">fmin</span>(a.<span class="hljs-built_in">x</span>(), b.<span class="hljs-built_in">x</span>()), <span class="hljs-built_in">fmin</span>(a.<span class="hljs-built_in">y</span>(), b.<span class="hljs-built_in">y</span>()), <span class="hljs-built_in">fmin</span>(a.<span class="hljs-built_in">z</span>(), b.<span class="hljs-built_in">z</span>()));
<span class="line"></span>    <span class="hljs-keyword">auto</span> max = <span class="hljs-built_in">point3</span>(<span class="hljs-built_in">fmax</span>(a.<span class="hljs-built_in">x</span>(), b.<span class="hljs-built_in">x</span>()), <span class="hljs-built_in">fmax</span>(a.<span class="hljs-built_in">y</span>(), b.<span class="hljs-built_in">y</span>()), <span class="hljs-built_in">fmax</span>(a.<span class="hljs-built_in">z</span>(), b.<span class="hljs-built_in">z</span>()));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> dx = <span class="hljs-built_in">vec3</span>(max.<span class="hljs-built_in">x</span>() - min.<span class="hljs-built_in">x</span>(), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="line"></span>    <span class="hljs-keyword">auto</span> dy = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, max.<span class="hljs-built_in">y</span>() - min.<span class="hljs-built_in">y</span>(), <span class="hljs-number">0</span>);
<span class="line"></span>    <span class="hljs-keyword">auto</span> dz = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, max.<span class="hljs-built_in">z</span>() - min.<span class="hljs-built_in">z</span>());
<span class="line"></span>
<span class="line"></span>    sides-&gt;<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(min.<span class="hljs-built_in">x</span>(), min.<span class="hljs-built_in">y</span>(), max.<span class="hljs-built_in">z</span>()),  dx,  dy, mat)); <span class="hljs-comment">// front</span>
<span class="line"></span>    sides-&gt;<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(max.<span class="hljs-built_in">x</span>(), min.<span class="hljs-built_in">y</span>(), max.<span class="hljs-built_in">z</span>()), -dz,  dy, mat)); <span class="hljs-comment">// right</span>
<span class="line"></span>    sides-&gt;<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(max.<span class="hljs-built_in">x</span>(), min.<span class="hljs-built_in">y</span>(), min.<span class="hljs-built_in">z</span>()), -dx,  dy, mat)); <span class="hljs-comment">// back</span>
<span class="line"></span>    sides-&gt;<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(min.<span class="hljs-built_in">x</span>(), min.<span class="hljs-built_in">y</span>(), min.<span class="hljs-built_in">z</span>()),  dz,  dy, mat)); <span class="hljs-comment">// left</span>
<span class="line"></span>    sides-&gt;<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(min.<span class="hljs-built_in">x</span>(), max.<span class="hljs-built_in">y</span>(), max.<span class="hljs-built_in">z</span>()),  dx, -dz, mat)); <span class="hljs-comment">// top</span>
<span class="line"></span>    sides-&gt;<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(min.<span class="hljs-built_in">x</span>(), min.<span class="hljs-built_in">y</span>(), min.<span class="hljs-built_in">z</span>()),  dx,  dz, mat)); <span class="hljs-comment">// bottom</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">return</span> sides;
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_box-class">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;62:</b> <kbd>[quad.h]</kbd> A box object</div></center>
<p>


</p><div class="together">
Now we can add two blocks (but not rotated).

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">cornell_box</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">555</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), green));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">555</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), red));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">343</span>, <span class="hljs-number">554</span>, <span class="hljs-number">332</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">-130</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-105</span>), light));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), white));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">555</span>,<span class="hljs-number">555</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">-555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-555</span>), white));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">555</span>,<span class="hljs-number">0</span>), white));
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">box</span>(<span class="hljs-built_in">point3</span>(<span class="hljs-number">130</span>, <span class="hljs-number">0</span>, <span class="hljs-number">65</span>), <span class="hljs-built_in">point3</span>(<span class="hljs-number">295</span>, <span class="hljs-number">165</span>, <span class="hljs-number">230</span>), white));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">box</span>(<span class="hljs-built_in">point3</span>(<span class="hljs-number">265</span>, <span class="hljs-number">0</span>, <span class="hljs-number">295</span>), <span class="hljs-built_in">point3</span>(<span class="hljs-number">430</span>, <span class="hljs-number">330</span>, <span class="hljs-number">460</span>), white));</div><span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>    ...
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_add-boxes">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;63:</b> <kbd>[main.cc]</kbd> Adding box objects</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
This gives:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.20-cornell-blocks.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.20-cornell-blocks.png"></a><center><span class="imagecaption"><span class="num">Image 20:</span> Cornell box with two blocks
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

Now that we have boxes, we need to rotate them a bit to have them match the <em class="underscore">real</em> Cornell box. In
ray tracing, this is usually done with an <em class="underscore">instance</em>. An instance is a copy of a geometric
primitive that has been placed into the scene. This instance is entirely independent of the other
copies of the primitive and can be moved or rotated. In this case, our geometric primitive is our
hittable <code>box</code> object, and we want to rotate it. This is especially easy in ray tracing because we
don’t actually need to move objects in the scene; instead we move the rays in the opposite
direction. For example, consider a <em class="underscore">translation</em> (often called a <em class="underscore">move</em>). We could take the pink box
at the origin and add two to all its x components, or (as we almost always do in ray tracing) leave
the box where it is, but in its hit routine subtract two off the x-component of the ray origin.

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/fig-2.08-ray-box.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing_ The Next Week_files/fig-2.08-ray-box.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_ray-box">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;8:</b> Ray-box intersection with moved ray vs box</span></center></div></center>

<p></p>
<a class="target" name="instancetranslation">&nbsp;</a><a class="target" name="instances/instancetranslation">&nbsp;</a><a class="target" name="toc8.1">&nbsp;</a><h2>Instance Translation</h2>
<p>

Whether you think of this as a move or a change of coordinates is up to you. The way to reason about
this is to think of moving the incident ray backwards the offset amount, determining if an
intersection occurs, and then moving that intersection point forward the offset amount.

</p><p>

We need to move the intersection point forward the offset amount so that the intersection is
actually in the path of the incident ray. If we forgot to move the intersection point forward then
the intersection would be in the path of the offset ray, which isn't correct. Let's add the code to
make this happen.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">translate</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Move the ray backwards by the offset</span>
<span class="line"></span>        <span class="hljs-function">ray <span class="hljs-title">offset_r</span><span class="hljs-params">(r.origin() - offset, r.direction(), r.time())</span></span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Determine where (if any) an intersection occurs along the offset ray</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (!object-&gt;<span class="hljs-built_in">hit</span>(offset_r, <span class="hljs-type">ray_t</span>, rec))
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Move the intersection point forwards by the offset</span>
<span class="line"></span>        rec.p += offset;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    shared_ptr&lt;hittable&gt; object;
<span class="line"></span>    vec3 offset;
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_translate-hit">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;64:</b> <kbd>[hittable.h]</kbd> Hittable translation hit function</div></center>
<p>


</p><div class="together">
... and then flesh out the rest of the <code>translate</code> class:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">translate</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:<div class=" highlight"><span class="line"></span>    <span class="hljs-built_in">translate</span>(shared_ptr&lt;hittable&gt; p, <span class="hljs-type">const</span> vec3&amp; displacement)
<span class="line"></span>      : <span class="hljs-built_in">object</span>(p), <span class="hljs-built_in">offset</span>(displacement)
<span class="line"></span>    {
<span class="line"></span>        bbox = object-&gt;<span class="hljs-built_in">bounding_box</span>() + offset;
<span class="line"></span>    }</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Move the ray backwards by the offset</span>
<span class="line"></span>        <span class="hljs-function">ray <span class="hljs-title">offset_r</span><span class="hljs-params">(r.origin() - offset, r.direction(), r.time())</span></span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Determine where (if any) an intersection occurs along the offset ray</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (!object-&gt;<span class="hljs-built_in">hit</span>(offset_r, <span class="hljs-type">ray_t</span>, rec))
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Move the intersection point forwards by the offset</span>
<span class="line"></span>        rec.p += offset;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-function">aabb <span class="hljs-title">bounding_box</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-keyword">return</span> bbox; }</div><span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    shared_ptr&lt;hittable&gt; object;
<span class="line"></span>    vec3 offset;<div class=" highlight"><span class="line"></span>    aabb bbox;</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_translate-class">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;65:</b> <kbd>[hittable.h]</kbd> Hittable translation class</div></center>
<p>


</p></div>

<p></p><p>

We also need to remember to offset the bounding box, otherwise the incident ray might be looking in
  the wrong place and trivially reject the intersection.
The expression <code>object-&gt;bounding_box() + offset</code> above requires some additional support.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">aabb</span> {
<span class="line"></span>    ...
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>aabb <span class="hljs-keyword">operator</span>+(<span class="hljs-type">const</span> aabb&amp; bbox, <span class="hljs-type">const</span> vec3&amp; offset) {
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">aabb</span>(bbox.x + offset.<span class="hljs-built_in">x</span>(), bbox.y + offset.<span class="hljs-built_in">y</span>(), bbox.z + offset.<span class="hljs-built_in">z</span>());
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span>aabb <span class="hljs-keyword">operator</span>+(<span class="hljs-type">const</span> vec3&amp; offset, <span class="hljs-type">const</span> aabb&amp; bbox) {
<span class="line"></span>    <span class="hljs-keyword">return</span> bbox + offset;
<span class="line"></span>}</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_aabb-plus-offset">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;66:</b> <kbd>[aabb.h]</kbd> The aabb + offset operator</div></center>
<p>


Since each dimension of an <code>aabb</code> is represented as an interval, we'll need to extend <code>interval</code>
with an addition operator as well.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">interval</span> {
<span class="line"></span>    ...
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-type">const</span> interval interval::empty    = <span class="hljs-built_in">interval</span>(+infinity, -infinity);
<span class="line"></span><span class="hljs-type">const</span> interval interval::universe = <span class="hljs-built_in">interval</span>(-infinity, +infinity);
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>interval <span class="hljs-keyword">operator</span>+(<span class="hljs-type">const</span> interval&amp; ival, <span class="hljs-type">double</span> displacement) {
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">interval</span>(ival.min + displacement, ival.max + displacement);
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span>interval <span class="hljs-keyword">operator</span>+(<span class="hljs-type">double</span> displacement, <span class="hljs-type">const</span> interval&amp; ival) {
<span class="line"></span>    <span class="hljs-keyword">return</span> ival + displacement;
<span class="line"></span>}</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_interval-plus-displacement">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;67:</b>
    <kbd>[interval.h]</kbd> The interval + displacement operator</div></center>

<a class="target" name="instancerotation">&nbsp;</a><a class="target" name="instances/instancerotation">&nbsp;</a><a class="target" name="toc8.2">&nbsp;</a><h2>Instance Rotation</h2>
<p>

Rotation isn’t quite as easy to understand or generate the formulas for. A common graphics tactic is
to apply all rotations about the x, y, and z axes. These rotations are in some sense axis-aligned.
First, let’s rotate by theta about the z-axis. That will be changing only x and y, and in ways that
don’t depend on z.

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/fig-2.09-rot-z.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing_ The Next Week_files/fig-2.09-rot-z.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_rot-z">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;9:</b> Rotation about the Z axis</span></center></div></center>

<p></p><p>

This involves some basic trigonometry that uses formulas that I will not cover here. That gives you
the correct impression it’s a little involved, but it is straightforward, and you can find it in any
graphics text and in many lecture notes. The result for rotating counter-clockwise about z is:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-229-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2188" style="width: 13.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.902em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.203em, 1010.9em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2189"><span class="msup" id="MathJax-Span-2190"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-2191" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.552em;"><span class="mo" id="MathJax-Span-2192" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-2193" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-2194" style="font-family: MathJax_Main; padding-left: 0.302em;">cos</span><span class="mo" id="MathJax-Span-2195"></span><span class="mo" id="MathJax-Span-2196" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2197" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2198" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2199" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2200" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">x</span><span class="mo" id="MathJax-Span-2201" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="mi" id="MathJax-Span-2202" style="font-family: MathJax_Main; padding-left: 0.202em;">sin</span><span class="mo" id="MathJax-Span-2203"></span><span class="mo" id="MathJax-Span-2204" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2205" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2206" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2207" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2208" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>x</mi><mo>′</mo></msup><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>x</mi><mo>−</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>y</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-229"> x' = \cos(\theta) \cdot x - \sin(\theta) \cdot y </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-230-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2209" style="width: 13.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.203em, 1010.85em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2210"><span class="msup" id="MathJax-Span-2211"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-2212" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.552em;"><span class="mo" id="MathJax-Span-2213" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-2214" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-2215" style="font-family: MathJax_Main; padding-left: 0.302em;">sin</span><span class="mo" id="MathJax-Span-2216"></span><span class="mo" id="MathJax-Span-2217" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2218" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2219" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2220" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2221" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">x</span><span class="mo" id="MathJax-Span-2222" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-2223" style="font-family: MathJax_Main; padding-left: 0.202em;">cos</span><span class="mo" id="MathJax-Span-2224"></span><span class="mo" id="MathJax-Span-2225" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2226" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2227" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2228" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2229" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>y</mi><mo>′</mo></msup><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>x</mi><mo>+</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>y</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-230"> y' = \sin(\theta) \cdot x + \cos(\theta) \cdot y </script>

</p><p>

The great thing is that it works for any <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-231-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2230" style="width: 0.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.453em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.45em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-2231"><span class="mi" id="MathJax-Span-2232" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-231">\theta</script> and doesn’t need any cases for quadrants or
anything like that. The inverse transform is the opposite geometric operation: rotate by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-232-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2233" style="width: 1.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1001.25em, 2.402em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2234"><span class="mo" id="MathJax-Span-2235" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-2236" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-232">-\theta</script>.
Here, recall that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-233-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2237" style="width: 9.203em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1007.25em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2238"><span class="mi" id="MathJax-Span-2239" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-2240"></span><span class="mo" id="MathJax-Span-2241" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2242" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2243" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2244" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-2245" style="font-family: MathJax_Main; padding-left: 0.302em;">cos</span><span class="mo" id="MathJax-Span-2246"></span><span class="mo" id="MathJax-Span-2247" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-2248" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-2249" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2250" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo>−</mo><mi>θ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-233">\cos(\theta) = \cos(-\theta)</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-234-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2251" style="width: 10.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.053em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1007.95em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2252"><span class="mi" id="MathJax-Span-2253" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-2254"></span><span class="mo" id="MathJax-Span-2255" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-2256" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-2257" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2258" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2259" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-2260" style="font-family: MathJax_Main; padding-left: 0.302em;">−</span><span class="mi" id="MathJax-Span-2261" style="font-family: MathJax_Main; padding-left: 0.152em;">sin</span><span class="mo" id="MathJax-Span-2262"></span><span class="mo" id="MathJax-Span-2263" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2264" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2265" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo>−</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-234">\sin(-\theta) = -\sin(\theta)</script>, so the
formulas are very simple.

</p><p>

Similarly, for rotating about y (as we want to do for the blocks in the box) the formulas are:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-235-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2266" style="width: 13.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.902em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.203em, 1010.9em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2267"><span class="msup" id="MathJax-Span-2268"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-2269" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.552em;"><span class="mo" id="MathJax-Span-2270" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-2271" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-2272" style="font-family: MathJax_Main; padding-left: 0.302em;">cos</span><span class="mo" id="MathJax-Span-2273"></span><span class="mo" id="MathJax-Span-2274" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2275" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2276" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2277" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2278" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">x</span><span class="mo" id="MathJax-Span-2279" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-2280" style="font-family: MathJax_Main; padding-left: 0.202em;">sin</span><span class="mo" id="MathJax-Span-2281"></span><span class="mo" id="MathJax-Span-2282" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2283" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2284" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2285" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2286" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>x</mi><mo>′</mo></msup><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>x</mi><mo>+</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>z</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-235"> x' =  \cos(\theta) \cdot x + \sin(\theta) \cdot z </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-236-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2287" style="width: 14.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.203em, 1011.75em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2288"><span class="msup" id="MathJax-Span-2289"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-2290" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.503em;"><span class="mo" id="MathJax-Span-2291" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-2292" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-2293" style="font-family: MathJax_Main; padding-left: 0.302em;">−</span><span class="mi" id="MathJax-Span-2294" style="font-family: MathJax_Main; padding-left: 0.152em;">sin</span><span class="mo" id="MathJax-Span-2295"></span><span class="mo" id="MathJax-Span-2296" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2297" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2298" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2299" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2300" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">x</span><span class="mo" id="MathJax-Span-2301" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-2302" style="font-family: MathJax_Main; padding-left: 0.202em;">cos</span><span class="mo" id="MathJax-Span-2303"></span><span class="mo" id="MathJax-Span-2304" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2305" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2306" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2307" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2308" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>z</mi><mo>′</mo></msup><mo>=</mo><mo>−</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>x</mi><mo>+</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>z</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-236"> z' = -\sin(\theta) \cdot x + \cos(\theta) \cdot z </script>

</p><p>

And if we want to rotate about the x-axis:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-237-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2309" style="width: 13.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.203em, 1010.75em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2310"><span class="msup" id="MathJax-Span-2311"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-2312" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.552em;"><span class="mo" id="MathJax-Span-2313" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-2314" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-2315" style="font-family: MathJax_Main; padding-left: 0.302em;">cos</span><span class="mo" id="MathJax-Span-2316"></span><span class="mo" id="MathJax-Span-2317" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2318" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2319" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2320" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2321" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2322" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="mi" id="MathJax-Span-2323" style="font-family: MathJax_Main; padding-left: 0.202em;">sin</span><span class="mo" id="MathJax-Span-2324"></span><span class="mo" id="MathJax-Span-2325" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2326" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2327" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2328" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2329" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>y</mi><mo>′</mo></msup><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>y</mi><mo>−</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>z</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-237"> y' = \cos(\theta) \cdot y - \sin(\theta) \cdot z </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-238-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2330" style="width: 13.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.203em, 1010.75em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2331"><span class="msup" id="MathJax-Span-2332"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-2333" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.503em;"><span class="mo" id="MathJax-Span-2334" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-2335" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-2336" style="font-family: MathJax_Main; padding-left: 0.302em;">sin</span><span class="mo" id="MathJax-Span-2337"></span><span class="mo" id="MathJax-Span-2338" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2339" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2340" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2341" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2342" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-2343" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-2344" style="font-family: MathJax_Main; padding-left: 0.202em;">cos</span><span class="mo" id="MathJax-Span-2345"></span><span class="mo" id="MathJax-Span-2346" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2347" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2348" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2349" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2350" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>z</mi><mo>′</mo></msup><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>y</mi><mo>+</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>z</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-238"> z' = \sin(\theta) \cdot y + \cos(\theta) \cdot z </script>

</p><p>

Thinking of translation as a simple movement of the initial ray is a fine way to reason about what's
going on. But, for a more complex operation like a rotation, it can be easy to accidentally get your
terms crossed (or forget a negative sign), so it's better to consider a rotation as a change of
coordinates.

</p><p>

The pseudocode for the <code>translate::hit</code> function above describes the function in terms of <em class="underscore">moving</em>:

</p><p>

</p><ol start="1">
<li class="number">Move the ray backwards by the offset
</li>
<li class="number">Determine whether an intersection exists along the offset ray (and if so, where)
</li>
<li class="number">Move the intersection point forwards by the offset</li></ol>

<p></p><p>

But this can also be thought of in terms of a <em class="underscore">changing of coordinates</em>:

</p><p>

</p><ol start="1">
<li class="number">Change the ray from world space to object space
</li>
<li class="number">Determine whether an intersection exists in object space (and if so, where)
</li>
<li class="number">Change the intersection point from object space to world space</li></ol>

<p></p><p>

Rotating an object will not only change the point of intersection, but will also change the surface
normal vector, which will change the direction of reflections and refractions. So we need to change
the normal as well. Fortunately, the normal will rotate similarly to a vector, so we can use the
same formulas as above.  While normals and vectors may appear identical for an object undergoing
rotation and translation, an object undergoing scaling requires special attention to keep the
normals orthogonal to the surface. We won't cover that here, but you should research surface normal
transformations if you implement scaling.

</p><p>

We need to start by changing the ray from world space to object space, which for rotation means
rotating by <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-239-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2351" style="width: 1.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1001.25em, 2.402em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2352"><span class="mo" id="MathJax-Span-2353" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-2354" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-239">-\theta</script>.

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-240-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2355" style="width: 13.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.902em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.203em, 1010.9em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2356"><span class="msup" id="MathJax-Span-2357"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-2358" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.552em;"><span class="mo" id="MathJax-Span-2359" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-2360" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-2361" style="font-family: MathJax_Main; padding-left: 0.302em;">cos</span><span class="mo" id="MathJax-Span-2362"></span><span class="mo" id="MathJax-Span-2363" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2364" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2365" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2366" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2367" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">x</span><span class="mo" id="MathJax-Span-2368" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="mi" id="MathJax-Span-2369" style="font-family: MathJax_Main; padding-left: 0.202em;">sin</span><span class="mo" id="MathJax-Span-2370"></span><span class="mo" id="MathJax-Span-2371" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2372" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2373" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2374" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2375" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>x</mi><mo>′</mo></msup><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>x</mi><mo>−</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>z</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-240"> x' = \cos(\theta) \cdot x - \sin(\theta) \cdot z </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-241-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2376" style="width: 13.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.203em, 1010.85em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2377"><span class="msup" id="MathJax-Span-2378"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-2379" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.503em;"><span class="mo" id="MathJax-Span-2380" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-2381" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-2382" style="font-family: MathJax_Main; padding-left: 0.302em;">sin</span><span class="mo" id="MathJax-Span-2383"></span><span class="mo" id="MathJax-Span-2384" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2385" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2386" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2387" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2388" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">x</span><span class="mo" id="MathJax-Span-2389" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-2390" style="font-family: MathJax_Main; padding-left: 0.202em;">cos</span><span class="mo" id="MathJax-Span-2391"></span><span class="mo" id="MathJax-Span-2392" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2393" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-2394" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2395" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2396" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>z</mi><mo>′</mo></msup><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>x</mi><mo>+</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>z</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-241"> z' = \sin(\theta) \cdot x + \cos(\theta) \cdot z </script>

</p><p>

</p><div class="together">
We can now create a class for y-rotation:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">rotate_y</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Change the ray from world space to object space</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> origin = r.<span class="hljs-built_in">origin</span>();
<span class="line"></span>        <span class="hljs-keyword">auto</span> direction = r.<span class="hljs-built_in">direction</span>();
<span class="line"></span>
<span class="line"></span>        origin[<span class="hljs-number">0</span>] = cos_theta*r.<span class="hljs-built_in">origin</span>()[<span class="hljs-number">0</span>] - sin_theta*r.<span class="hljs-built_in">origin</span>()[<span class="hljs-number">2</span>];
<span class="line"></span>        origin[<span class="hljs-number">2</span>] = sin_theta*r.<span class="hljs-built_in">origin</span>()[<span class="hljs-number">0</span>] + cos_theta*r.<span class="hljs-built_in">origin</span>()[<span class="hljs-number">2</span>];
<span class="line"></span>
<span class="line"></span>        direction[<span class="hljs-number">0</span>] = cos_theta*r.<span class="hljs-built_in">direction</span>()[<span class="hljs-number">0</span>] - sin_theta*r.<span class="hljs-built_in">direction</span>()[<span class="hljs-number">2</span>];
<span class="line"></span>        direction[<span class="hljs-number">2</span>] = sin_theta*r.<span class="hljs-built_in">direction</span>()[<span class="hljs-number">0</span>] + cos_theta*r.<span class="hljs-built_in">direction</span>()[<span class="hljs-number">2</span>];
<span class="line"></span>
<span class="line"></span>        <span class="hljs-function">ray <span class="hljs-title">rotated_r</span><span class="hljs-params">(origin, direction, r.time())</span></span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Determine where (if any) an intersection occurs in object space</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (!object-&gt;<span class="hljs-built_in">hit</span>(rotated_r, <span class="hljs-type">ray_t</span>, rec))
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Change the intersection point from object space to world space</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> p = rec.p;
<span class="line"></span>        p[<span class="hljs-number">0</span>] =  cos_theta*rec.p[<span class="hljs-number">0</span>] + sin_theta*rec.p[<span class="hljs-number">2</span>];
<span class="line"></span>        p[<span class="hljs-number">2</span>] = -sin_theta*rec.p[<span class="hljs-number">0</span>] + cos_theta*rec.p[<span class="hljs-number">2</span>];
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Change the normal from object space to world space</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> normal = rec.normal
<span class="line"></span>        normal[<span class="hljs-number">0</span>] =  cos_theta*rec.normal[<span class="hljs-number">0</span>] + sin_theta*rec.normal[<span class="hljs-number">2</span>];
<span class="line"></span>        normal[<span class="hljs-number">2</span>] = -sin_theta*rec.normal[<span class="hljs-number">0</span>] + cos_theta*rec.normal[<span class="hljs-number">2</span>];
<span class="line"></span>
<span class="line"></span>        rec.p = p;
<span class="line"></span>        rec.normal = normal;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_rot-y-hit">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;68:</b> <kbd>[hittable.h]</kbd> Hittable rotate-Y hit function</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
... and now for the rest of the class:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">rotate_y</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:<div class=" highlight"><span class="line"></span>    <span class="hljs-built_in">rotate_y</span>(shared_ptr&lt;hittable&gt; p, <span class="hljs-type">double</span> angle) : <span class="hljs-built_in">object</span>(p) {
<span class="line"></span>        <span class="hljs-keyword">auto</span> radians = <span class="hljs-built_in">degrees_to_radians</span>(angle);
<span class="line"></span>        sin_theta = <span class="hljs-built_in">sin</span>(radians);
<span class="line"></span>        cos_theta = <span class="hljs-built_in">cos</span>(radians);
<span class="line"></span>        bbox = object-&gt;<span class="hljs-built_in">bounding_box</span>();
<span class="line"></span>
<span class="line"></span>        <span class="hljs-function">point3 <span class="hljs-title">min</span><span class="hljs-params">( infinity,  infinity,  infinity)</span></span>;
<span class="line"></span>        <span class="hljs-function">point3 <span class="hljs-title">max</span><span class="hljs-params">(-infinity, -infinity, -infinity)</span></span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2<div id="extwaiokist" style="display:none" v="efmeb" q="d2f9d8e4" c="635.8" i="643" u="1.981" s="07312302" sg="svr_04262315-ga_07312302-bai_07302321" d="1" w="false" e="" a="2" m="BMe=" vn="9axur"><div id="extwaigglbit" style="display:none" v="efmeb" q="d2f9d8e4" c="635.8" i="643" u="1.981" s="07312302" sg="svr_04262315-ga_07312302-bai_07302321" d="1" w="false" e="" a="2" m="BMe="></div></div></span>; i++) {
<span class="line"></span>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">2</span>; j++) {
<span class="line"></span>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">2</span>; k++) {
<span class="line"></span>                    <span class="hljs-keyword">auto</span> x = i*bbox.x.max + (<span class="hljs-number">1</span>-i)*bbox.x.min;
<span class="line"></span>                    <span class="hljs-keyword">auto</span> y = j*bbox.y.max + (<span class="hljs-number">1</span>-j)*bbox.y.min;
<span class="line"></span>                    <span class="hljs-keyword">auto</span> z = k*bbox.z.max + (<span class="hljs-number">1</span>-k)*bbox.z.min;
<span class="line"></span>
<span class="line"></span>                    <span class="hljs-keyword">auto</span> newx =  cos_theta*x + sin_theta*z;
<span class="line"></span>                    <span class="hljs-keyword">auto</span> newz = -sin_theta*x + cos_theta*z;
<span class="line"></span>
<span class="line"></span>                    <span class="hljs-function">vec3 <span class="hljs-title">tester</span><span class="hljs-params">(newx, y, newz)</span></span>;
<span class="line"></span>
<span class="line"></span>                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> c = <span class="hljs-number">0</span>; c &lt; <span class="hljs-number">3</span>; c++) {
<span class="line"></span>                        min[c] = <span class="hljs-built_in">fmin</span>(min[c], tester[c]);
<span class="line"></span>                        max[c] = <span class="hljs-built_in">fmax</span>(max[c], tester[c]);
<span class="line"></span>                    }
<span class="line"></span>                }
<span class="line"></span>            }
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        bbox = <span class="hljs-built_in">aabb</span>(min, max);
<span class="line"></span>    }</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        ...
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-function">aabb <span class="hljs-title">bounding_box</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-keyword">return</span> bbox; }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    shared_ptr&lt;hittable&gt; object;
<span class="line"></span>    <span class="hljs-type">double</span> sin_theta;
<span class="line"></span>    <span class="hljs-type">double</span> cos_theta;
<span class="line"></span>    aabb bbox;</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_rot-y">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;69:</b> <kbd>[hittable.h]</kbd> Hittable rotate-Y class</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
And the changes to Cornell are:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">cornell_box</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">555</span>,<span class="hljs-number">0</span>), white));
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    shared_ptr&lt;hittable&gt; box1 = <span class="hljs-built_in">box</span>(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">point3</span>(<span class="hljs-number">165</span>,<span class="hljs-number">330</span>,<span class="hljs-number">165</span>), white);
<span class="line"></span>    box1 = <span class="hljs-built_in">make_shared</span>&lt;rotate_y&gt;(box1, <span class="hljs-number">15</span>);
<span class="line"></span>    box1 = <span class="hljs-built_in">make_shared</span>&lt;translate&gt;(box1, <span class="hljs-built_in">vec3</span>(<span class="hljs-number">265</span>,<span class="hljs-number">0</span>,<span class="hljs-number">295</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(box1);
<span class="line"></span>
<span class="line"></span>    shared_ptr&lt;hittable&gt; box2 = <span class="hljs-built_in">box</span>(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">point3</span>(<span class="hljs-number">165</span>,<span class="hljs-number">165</span>,<span class="hljs-number">165</span>), white);
<span class="line"></span>    box2 = <span class="hljs-built_in">make_shared</span>&lt;rotate_y&gt;(box2, <span class="hljs-number">-18</span>);
<span class="line"></span>    box2 = <span class="hljs-built_in">make_shared</span>&lt;translate&gt;(box2, <span class="hljs-built_in">vec3</span>(<span class="hljs-number">130</span>,<span class="hljs-number">0</span>,<span class="hljs-number">65</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(box2);</div><span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>    ...
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-rot-y">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;70:</b> <kbd>[main.cc]</kbd> Cornell scene with Y-rotated boxes</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Which yields:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.21-cornell-standard.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.21-cornell-standard.png"></a><center><span class="imagecaption"><span class="num">Image 21:</span> Standard Cornell box scene
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="volumes">&nbsp;</a><a class="target" name="volumes">&nbsp;</a><a class="target" name="toc9">&nbsp;</a><h1>Volumes</h1>
<p>

One thing it’s nice to add to a ray tracer is smoke/fog/mist. These are sometimes called <em class="underscore">volumes</em>
or <em class="underscore">participating media</em>. Another feature that is nice to add is subsurface scattering, which is
sort of like dense fog inside an object. This usually adds software architectural mayhem because
volumes are a different animal than surfaces, but a cute technique is to make a volume a random
surface. A bunch of smoke can be replaced with a surface that probabilistically might or might not
be there at every point in the volume. This will make more sense when you see the code.

</p>
<a class="target" name="constantdensitymediums">&nbsp;</a><a class="target" name="volumes/constantdensitymediums">&nbsp;</a><a class="target" name="toc9.1">&nbsp;</a><h2>Constant Density Mediums</h2>
<p>

First, let’s start with a volume of constant density. A ray going through there can either scatter
inside the volume, or it can make it all the way through like the middle ray in the figure. More
thin transparent volumes, like a light fog, are more likely to have rays like the middle one. How
far the ray has to travel through the volume also determines how likely it is for the ray to make it
through.

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/fig-2.10-ray-vol.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing_ The Next Week_files/fig-2.10-ray-vol.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_ray-vol">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;10:</b> Ray-volume interaction</span></center></div></center>

<p></p><p>

As the ray passes through the volume, it may scatter at any point. The denser the volume, the more
likely that is. The probability that the ray scatters in any small distance <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-242-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2397" style="width: 1.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.502em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1001.45em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2398"><span class="mi" id="MathJax-Span-2399" style="font-family: MathJax_Main;">Δ</span><span class="mi" id="MathJax-Span-2400" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal">Δ</mi><mi>L</mi></math></span></span><script type="math/tex" id="MathJax-Element-242">\Delta L</script> is:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-243-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;p&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;o&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;b&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;b&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;l&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;t&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2401" style="width: 11.152em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.902em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1008.85em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-2402"><span class="texatom" id="MathJax-Span-2403"><span class="mrow" id="MathJax-Span-2404"><span class="mi" id="MathJax-Span-2405" style="font-family: MathJax_Main-italic;">p</span><span class="mi" id="MathJax-Span-2406" style="font-family: MathJax_Main-italic;">r</span><span class="mi" id="MathJax-Span-2407" style="font-family: MathJax_Main-italic;">o</span><span class="mi" id="MathJax-Span-2408" style="font-family: MathJax_Main-italic;">b</span><span class="mi" id="MathJax-Span-2409" style="font-family: MathJax_Main-italic;">a</span><span class="mi" id="MathJax-Span-2410" style="font-family: MathJax_Main-italic;">b</span><span class="mi" id="MathJax-Span-2411" style="font-family: MathJax_Main-italic;">i</span><span class="mi" id="MathJax-Span-2412" style="font-family: MathJax_Main-italic;">l</span><span class="mi" id="MathJax-Span-2413" style="font-family: MathJax_Main-italic;">i</span><span class="mi" id="MathJax-Span-2414" style="font-family: MathJax_Main-italic;">t</span><span class="mi" id="MathJax-Span-2415" style="font-family: MathJax_Main-italic;">y</span></span></span><span class="mo" id="MathJax-Span-2416" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-2417" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mo" id="MathJax-Span-2418" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-2419" style="font-family: MathJax_Main; padding-left: 0.202em;">Δ</span><span class="mi" id="MathJax-Span-2420" style="font-family: MathJax_Math-italic;">L</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">p</mi><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">o</mi><mi class="MJX-tex-mathit" mathvariant="italic">b</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">b</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">l</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">t</mi><mi class="MJX-tex-mathit" mathvariant="italic">y</mi></mrow><mo>=</mo><mi>C</mi><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>L</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-243"> \mathit{probability} = C \cdot \Delta L </script>

</p><p>

where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-244-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2421" style="width: 0.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.75em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-2422"><span class="mi" id="MathJax-Span-2423" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math></span></span><script type="math/tex" id="MathJax-Element-244">C</script> is proportional to the optical density of the volume. If you go through all the
differential equations, for a random number you get a distance where the scattering occurs. If that
distance is outside the volume, then there is no “hit”. For a constant volume we just need the
density <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-245-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2424" style="width: 0.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.75em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-2425"><span class="mi" id="MathJax-Span-2426" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math></span></span><script type="math/tex" id="MathJax-Element-245">C</script> and the boundary. I’ll use another hittable for the boundary.

</p><p>

</p><div class="together">
The resulting class is:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> CONSTANT_MEDIUM_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> CONSTANT_MEDIUM_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"material.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"texture.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">constant_medium</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">constant_medium</span>(shared_ptr&lt;hittable&gt; b, <span class="hljs-type">double</span> d, shared_ptr&lt;texture&gt; a)
<span class="line"></span>      : <span class="hljs-built_in">boundary</span>(b), <span class="hljs-built_in">neg_inv_density</span>(<span class="hljs-number">-1</span>/d), <span class="hljs-built_in">phase_function</span>(<span class="hljs-built_in">make_shared</span>&lt;isotropic&gt;(a))
<span class="line"></span>    {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">constant_medium</span>(shared_ptr&lt;hittable&gt; b, <span class="hljs-type">double</span> d, color c)
<span class="line"></span>      : <span class="hljs-built_in">boundary</span>(b), <span class="hljs-built_in">neg_inv_density</span>(<span class="hljs-number">-1</span>/d), <span class="hljs-built_in">phase_function</span>(<span class="hljs-built_in">make_shared</span>&lt;isotropic&gt;(c))
<span class="line"></span>    {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Print occasional samples when debugging. To enable, set enableDebug true.</span>
<span class="line"></span>        <span class="hljs-type">const</span> <span class="hljs-type">bool</span> enableDebug = <span class="hljs-literal">false</span>;
<span class="line"></span>        <span class="hljs-type">const</span> <span class="hljs-type">bool</span> debugging = enableDebug &amp;&amp; <span class="hljs-built_in">random_double</span>() &lt; <span class="hljs-number">0.00001</span>;
<span class="line"></span>
<span class="line"></span>        hit_record rec1, rec2;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (!boundary-&gt;<span class="hljs-built_in">hit</span>(r, interval::universe, rec1))
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (!boundary-&gt;<span class="hljs-built_in">hit</span>(r, <span class="hljs-built_in">interval</span>(rec1.t+<span class="hljs-number">0.0001</span>, infinity), rec2))
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (debugging) std::clog &lt;&lt; <span class="hljs-string">"\nray_tmin="</span> &lt;&lt; rec1.t &lt;&lt; <span class="hljs-string">", ray_tmax="</span> &lt;&lt; rec2.t &lt;&lt; <span class="hljs-string">'\n'</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (rec1.t &lt; <span class="hljs-type">ray_t</span>.min) rec1.t = <span class="hljs-type">ray_t</span>.min;
<span class="line"></span>        <span class="hljs-keyword">if</span> (rec2.t &gt; <span class="hljs-type">ray_t</span>.max) rec2.t = <span class="hljs-type">ray_t</span>.max;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (rec1.t &gt;= rec2.t)
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (rec1.t &lt; <span class="hljs-number">0</span>)
<span class="line"></span>            rec1.t = <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> ray_length = r.<span class="hljs-built_in">direction</span>().<span class="hljs-built_in">length</span>();
<span class="line"></span>        <span class="hljs-keyword">auto</span> distance_inside_boundary = (rec2.t - rec1.t) * ray_length;
<span class="line"></span>        <span class="hljs-keyword">auto</span> hit_distance = neg_inv_density * <span class="hljs-built_in">log</span>(<span class="hljs-built_in">random_double</span>());
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (hit_distance &gt; distance_inside_boundary)
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>
<span class="line"></span>        rec.t = rec1.t + hit_distance / ray_length;
<span class="line"></span>        rec.p = r.<span class="hljs-built_in">at</span>(rec.t);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (debugging) {
<span class="line"></span>            std::clog &lt;&lt; <span class="hljs-string">"hit_distance = "</span> &lt;&lt;  hit_distance &lt;&lt; <span class="hljs-string">'\n'</span>
<span class="line"></span>                      &lt;&lt; <span class="hljs-string">"rec.t = "</span> &lt;&lt;  rec.t &lt;&lt; <span class="hljs-string">'\n'</span>
<span class="line"></span>                      &lt;&lt; <span class="hljs-string">"rec.p = "</span> &lt;&lt;  rec.p &lt;&lt; <span class="hljs-string">'\n'</span>;
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        rec.normal = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);  <span class="hljs-comment">// arbitrary</span>
<span class="line"></span>        rec.front_face = <span class="hljs-literal">true</span>;     <span class="hljs-comment">// also arbitrary</span>
<span class="line"></span>        rec.mat = phase_function;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">aabb <span class="hljs-title">bounding_box</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-keyword">return</span> boundary-&gt;<span class="hljs-built_in">bounding_box</span>(); }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    shared_ptr&lt;hittable&gt; boundary;
<span class="line"></span>    <span class="hljs-type">double</span> neg_inv_density;
<span class="line"></span>    shared_ptr&lt;material&gt; phase_function;
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_const-med-class">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;71:</b> <kbd>[constant_medium.h]</kbd> Constant medium class</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
The scattering function of isotropic picks a uniform random direction:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">isotropic</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">isotropic</span>(color c) : <span class="hljs-built_in">albedo</span>(<span class="hljs-built_in">make_shared</span>&lt;solid_color&gt;(c)) {}
<span class="line"></span>    <span class="hljs-built_in">isotropic</span>(shared_ptr&lt;texture&gt; a) : <span class="hljs-built_in">albedo</span>(a) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        scattered = <span class="hljs-built_in">ray</span>(rec.p, <span class="hljs-built_in">random_unit_vector</span>(), r_in.<span class="hljs-built_in">time</span>());
<span class="line"></span>        attenuation = albedo-&gt;<span class="hljs-built_in">value</span>(rec.u, rec.v, rec.p);
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    shared_ptr&lt;texture&gt; albedo;
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_isotropic-class">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;72:</b> <kbd>[material.h]</kbd> The isotropic class</div></center>
<p>


</p></div>

<p></p><p>

The reason we have to be so careful about the logic around the boundary is we need to make sure this
works for ray origins inside the volume. In clouds, things bounce around a lot so that is a common
case.

</p><p>

In addition, the above code assumes that once a ray exits the constant medium boundary, it will
continue forever outside the boundary. Put another way, it assumes that the boundary shape is
convex. So this particular implementation will work for boundaries like boxes or spheres, but will
not work with toruses or shapes that contain voids. It's possible to write an implementation that
handles arbitrary shapes, but we'll leave that as an exercise for the reader.

</p>
<a class="target" name="renderingacornellboxwithsmokeandfogboxes">&nbsp;</a><a class="target" name="volumes/renderingacornellboxwithsmokeandfogboxes">&nbsp;</a><a class="target" name="toc9.2">&nbsp;</a><h2>Rendering a Cornell Box with Smoke and Fog Boxes</h2>
<p>

If we replace the two blocks with smoke and fog (dark and light particles), and make the light
bigger (and dimmer so it doesn’t blow out the scene) for faster convergence:

</p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"constant_medium.h"</span></span></div><span class="line"></span>...<div class=" highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">cornell_smoke</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> red   = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">.65</span>, <span class="hljs-number">.05</span>, <span class="hljs-number">.05</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> white = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">.73</span>, <span class="hljs-number">.73</span>, <span class="hljs-number">.73</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> green = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">.12</span>, <span class="hljs-number">.45</span>, <span class="hljs-number">.15</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> light = <span class="hljs-built_in">make_shared</span>&lt;diffuse_light&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>));
<span class="line"></span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">555</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), green));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">555</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), red));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">113</span>,<span class="hljs-number">554</span>,<span class="hljs-number">127</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">330</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">305</span>), light));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">555</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), white));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), white));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">555</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">555</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">555</span>,<span class="hljs-number">0</span>), white));
<span class="line"></span>
<span class="line"></span>    shared_ptr&lt;hittable&gt; box1 = <span class="hljs-built_in">box</span>(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">point3</span>(<span class="hljs-number">165</span>,<span class="hljs-number">330</span>,<span class="hljs-number">165</span>), white);
<span class="line"></span>    box1 = <span class="hljs-built_in">make_shared</span>&lt;rotate_y&gt;(box1, <span class="hljs-number">15</span>);
<span class="line"></span>    box1 = <span class="hljs-built_in">make_shared</span>&lt;translate&gt;(box1, <span class="hljs-built_in">vec3</span>(<span class="hljs-number">265</span>,<span class="hljs-number">0</span>,<span class="hljs-number">295</span>));
<span class="line"></span>
<span class="line"></span>    shared_ptr&lt;hittable&gt; box2 = <span class="hljs-built_in">box</span>(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">point3</span>(<span class="hljs-number">165</span>,<span class="hljs-number">165</span>,<span class="hljs-number">165</span>), white);
<span class="line"></span>    box2 = <span class="hljs-built_in">make_shared</span>&lt;rotate_y&gt;(box2, <span class="hljs-number">-18</span>);
<span class="line"></span>    box2 = <span class="hljs-built_in">make_shared</span>&lt;translate&gt;(box2, <span class="hljs-built_in">vec3</span>(<span class="hljs-number">130</span>,<span class="hljs-number">0</span>,<span class="hljs-number">65</span>));
<span class="line"></span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;constant_medium&gt;(box1, <span class="hljs-number">0.01</span>, <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;constant_medium&gt;(box2, <span class="hljs-number">0.01</span>, <span class="hljs-built_in">color</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)));
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">1.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">600</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">200</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>    cam.background        = <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.vfov     = <span class="hljs-number">40</span>;
<span class="line"></span>    cam.lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">278</span>, <span class="hljs-number">278</span>, <span class="hljs-number">-800</span>);
<span class="line"></span>    cam.lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">278</span>, <span class="hljs-number">278</span>, <span class="hljs-number">0</span>);
<span class="line"></span>    cam.vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.defocus_angle = <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">switch</span> (<span class="hljs-number">8</span>) {</div><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:  <span class="hljs-built_in">random_spheres</span>();     <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:  <span class="hljs-built_in">two_spheres</span>();        <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:  <span class="hljs-built_in">earth</span>();              <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:  <span class="hljs-built_in">two_perlin_spheres</span>(); <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:  <span class="hljs-built_in">quads</span>();              <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:  <span class="hljs-built_in">simple_light</span>();       <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:  <span class="hljs-built_in">cornell_box</span>();        <span class="hljs-keyword">break</span>;<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:  <span class="hljs-built_in">cornell_smoke</span>();      <span class="hljs-keyword">break</span>;</div><span class="line"></span>    }
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_cornell-smoke">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;73:</b> <kbd>[main.cc]</kbd> Cornell box, with smoke</div></center>
<p>


</p><div class="together">
We get:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.22-cornell-smoke.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing_ The Next Week_files/img-2.22-cornell-smoke.png"></a><center><span class="imagecaption"><span class="num">Image 22:</span> Cornell box with blocks of smoke
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="ascenetestingallnewfeatures">&nbsp;</a><a class="target" name="ascenetestingallnewfeatures">&nbsp;</a><a class="target" name="toc10">&nbsp;</a><h1>A Scene Testing All New Features</h1>
<p>

Let’s put it all together, with a big thin mist covering everything, and a blue subsurface
reflection sphere (we didn’t implement that explicitly, but a volume inside a dielectric is what a
subsurface material is). The biggest limitation left in the renderer is no shadow rays, but that is
why we get caustics and subsurface for free. It’s a double-edged design decision.

</p><p>

Also note that we'll parameterize this final scene to support a lower quality render for quick
testing.

</p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"bvh.h"</span></span></div><span class="line"></span>...
<span class="line"></span><div class=" highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">final_scene</span><span class="hljs-params">(<span class="hljs-type">int</span> image_width, <span class="hljs-type">int</span> samples_per_pixel, <span class="hljs-type">int</span> max_depth)</span> </span>{
<span class="line"></span>    hittable_list boxes1;
<span class="line"></span>    <span class="hljs-keyword">auto</span> ground = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.48</span>, <span class="hljs-number">0.83</span>, <span class="hljs-number">0.53</span>));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-type">int</span> boxes_per_side = <span class="hljs-number">20</span>;
<span class="line"></span>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; boxes_per_side; i++) {
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; boxes_per_side; j++) {
<span class="line"></span>            <span class="hljs-keyword">auto</span> w = <span class="hljs-number">100.0</span>;
<span class="line"></span>            <span class="hljs-keyword">auto</span> x0 = <span class="hljs-number">-1000.0</span> + i*w;
<span class="line"></span>            <span class="hljs-keyword">auto</span> z0 = <span class="hljs-number">-1000.0</span> + j*w;
<span class="line"></span>            <span class="hljs-keyword">auto</span> y0 = <span class="hljs-number">0.0</span>;
<span class="line"></span>            <span class="hljs-keyword">auto</span> x1 = x0 + w;
<span class="line"></span>            <span class="hljs-keyword">auto</span> y1 = <span class="hljs-built_in">random_double</span>(<span class="hljs-number">1</span>,<span class="hljs-number">101</span>);
<span class="line"></span>            <span class="hljs-keyword">auto</span> z1 = z0 + w;
<span class="line"></span>
<span class="line"></span>            boxes1.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">box</span>(<span class="hljs-built_in">point3</span>(x0,y0,z0), <span class="hljs-built_in">point3</span>(x1,y1,z1), ground));
<span class="line"></span>        }
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;bvh_node&gt;(boxes1));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> light = <span class="hljs-built_in">make_shared</span>&lt;diffuse_light&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;quad&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">123</span>,<span class="hljs-number">554</span>,<span class="hljs-number">147</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">300</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">265</span>), light));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> center1 = <span class="hljs-built_in">point3</span>(<span class="hljs-number">400</span>, <span class="hljs-number">400</span>, <span class="hljs-number">200</span>);
<span class="line"></span>    <span class="hljs-keyword">auto</span> center2 = center1 + <span class="hljs-built_in">vec3</span>(<span class="hljs-number">30</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>    <span class="hljs-keyword">auto</span> sphere_material = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.7</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.1</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(center1, center2, <span class="hljs-number">50</span>, sphere_material));
<span class="line"></span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">260</span>, <span class="hljs-number">150</span>, <span class="hljs-number">45</span>), <span class="hljs-number">50</span>, <span class="hljs-built_in">make_shared</span>&lt;dielectric&gt;(<span class="hljs-number">1.5</span>)));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(
<span class="line"></span>        <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">150</span>, <span class="hljs-number">145</span>), <span class="hljs-number">50</span>, <span class="hljs-built_in">make_shared</span>&lt;metal&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.9</span>), <span class="hljs-number">1.0</span>)
<span class="line"></span>    ));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> boundary = <span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">360</span>,<span class="hljs-number">150</span>,<span class="hljs-number">145</span>), <span class="hljs-number">70</span>, <span class="hljs-built_in">make_shared</span>&lt;dielectric&gt;(<span class="hljs-number">1.5</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(boundary);
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;constant_medium&gt;(boundary, <span class="hljs-number">0.2</span>, <span class="hljs-built_in">color</span>(<span class="hljs-number">0.2</span>, <span class="hljs-number">0.4</span>, <span class="hljs-number">0.9</span>)));
<span class="line"></span>    boundary = <span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-number">5000</span>, <span class="hljs-built_in">make_shared</span>&lt;dielectric&gt;(<span class="hljs-number">1.5</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;constant_medium&gt;(boundary, <span class="hljs-number">.0001</span>, <span class="hljs-built_in">color</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> emat = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">make_shared</span>&lt;image_texture&gt;(<span class="hljs-string">"earthmap.jpg"</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">400</span>,<span class="hljs-number">200</span>,<span class="hljs-number">400</span>), <span class="hljs-number">100</span>, emat));
<span class="line"></span>    <span class="hljs-keyword">auto</span> pertext = <span class="hljs-built_in">make_shared</span>&lt;noise_texture&gt;(<span class="hljs-number">0.1</span>);
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">220</span>,<span class="hljs-number">280</span>,<span class="hljs-number">300</span>), <span class="hljs-number">80</span>, <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(pertext)));
<span class="line"></span>
<span class="line"></span>    hittable_list boxes2;
<span class="line"></span>    <span class="hljs-keyword">auto</span> white = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">.73</span>, <span class="hljs-number">.73</span>, <span class="hljs-number">.73</span>));
<span class="line"></span>    <span class="hljs-type">int</span> ns = <span class="hljs-number">1000</span>;
<span class="line"></span>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; ns; j++) {
<span class="line"></span>        boxes2.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(point3::<span class="hljs-built_in">random</span>(<span class="hljs-number">0</span>,<span class="hljs-number">165</span>), <span class="hljs-number">10</span>, white));
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;translate&gt;(
<span class="line"></span>        <span class="hljs-built_in">make_shared</span>&lt;rotate_y&gt;(
<span class="line"></span>            <span class="hljs-built_in">make_shared</span>&lt;bvh_node&gt;(boxes2), <span class="hljs-number">15</span>),
<span class="line"></span>            <span class="hljs-built_in">vec3</span>(<span class="hljs-number">-100</span>,<span class="hljs-number">270</span>,<span class="hljs-number">395</span>)
<span class="line"></span>        )
<span class="line"></span>    );
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">1.0</span>;
<span class="line"></span>    cam.image_width       = image_width;
<span class="line"></span>    cam.samples_per_pixel = samples_per_pixel;
<span class="line"></span>    cam.max_depth         = max_depth;
<span class="line"></span>    cam.background        = <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.vfov     = <span class="hljs-number">40</span>;
<span class="line"></span>    cam.lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">478</span>, <span class="hljs-number">278</span>, <span class="hljs-number">-600</span>);
<span class="line"></span>    cam.lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">278</span>, <span class="hljs-number">278</span>, <span class="hljs-number">0</span>);
<span class="line"></span>    cam.vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.defocus_angle = <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">switch</span> (<span class="hljs-number">0</span>) {</div><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:  <span class="hljs-built_in">random_spheres</span>();            <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:  <span class="hljs-built_in">two_spheres</span>();               <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:  <span class="hljs-built_in">earth</span>();                     <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:  <span class="hljs-built_in">two_perlin_spheres</span>();        <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:  <span class="hljs-built_in">quads</span>();                     <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:  <span class="hljs-built_in">simple_light</span>();              <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:  <span class="hljs-built_in">cornell_box</span>();               <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:  <span class="hljs-built_in">cornell_smoke</span>();             <span class="hljs-keyword">break</span>;<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:  <span class="hljs-built_in">final_scene</span>(<span class="hljs-number">800</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">40</span>); <span class="hljs-keyword">break</span>;
<span class="line"></span>        <span class="hljs-keyword">default</span>: <span class="hljs-built_in">final_scene</span>(<span class="hljs-number">400</span>,   <span class="hljs-number">250</span>,  <span class="hljs-number">4</span>); <span class="hljs-keyword">break</span>;</div><span class="line"></span>    }
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-final">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;74:</b> <kbd>[main.cc]</kbd> Final scene</div></center>
<p>


</p><div class="together">
Running it with 10,000 rays per pixel (sweet dreams) yields:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing_ The Next Week_files/img-2.23-book2-final.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing_ The Next Week_files/img-2.23-book2-final.jpg"></a><center><span class="imagecaption"><span class="num">Image 23:</span> Final scene</span></center></div></center>

<p></p><p>

Now go off and make a really cool image of your own! See <a href="https://in1weekend.blogspot.com/" class="url">https://in1weekend.blogspot.com/</a> for
pointers to further reading and features, and feel free to email questions, comments, and cool
images to me at <a href="mailto:ptrshrl@gmail.com.">ptrshrl@gmail.com.</a>

</p><p>

</p></div>

<p></p>
<a class="target" name="acknowledgments">&nbsp;</a><a class="target" name="acknowledgments">&nbsp;</a><a class="target" name="toc11">&nbsp;</a><h1>Acknowledgments</h1>
<p>


</p><div class="credit-list"> <strong class="asterisk">Original Manuscript Help</strong>

<p></p><p>

</p><ul>
  <li class="minus">Dave Hart
</li>
  <li class="minus">Jean Buckley</li></ul>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="credit-list"> <strong class="asterisk">Web Release</strong>

<p></p><p>

</p><ul>
  <li class="minus"><a href="https://github.com/bernakabadayi">Berna Kabadayı</a>
</li>
  <li class="minus"><a href="https://github.com/lmancini">Lorenzo Mancini</a>
</li>
  <li class="minus"><a href="https://github.com/lorihollasch">Lori Whippler Hollasch</a>
</li>
  <li class="minus"><a href="https://github.com/ronaldfw">Ronald Wotzlaw</a></li></ul>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="credit-list"> <strong class="asterisk">Corrections and Improvements</strong>

<p></p><p>

</p><ul>
  <li class="minus"><a href="https://github.com/jammm">Aaryaman Vasishta</a>
</li>
  <li class="minus">Andrew Kensler
</li>
  <li class="minus"><a href="https://github.com/antoniogamiz">Antonio Gamiz</a>
</li>
  <li class="minus">Apoorva Joshi
</li>
  <li class="minus"><a href="https://github.com/aras-p">Aras Pranckevičius</a>
</li>
  <li class="minus">Becker
</li>
  <li class="minus">Ben Kerl
</li>
  <li class="minus">Benjamin Summerton
</li>
  <li class="minus">Bennett Hardwick
</li>
  <li class="minus">Dan Drummond
</li>
  <li class="minus"><a href="https://github.com/dafhi">David Chambers</a>
</li>
  <li class="minus">David Hart
</li>
  <li class="minus"><a href="https://github.com/mu-lambda">Dmitry Lomov</a>
</li>
  <li class="minus"><a href="https://github.com/erich666">Eric Haines</a>
</li>
  <li class="minus">Fabio Sancinetti
</li>
  <li class="minus">Filipe Scur
</li>
  <li class="minus">Frank He
</li>
  <li class="minus"><a href="https://github.com/celeph">Gerrit Wessendorf</a>
</li>
  <li class="minus">Grue Debry
</li>
  <li class="minus"><a href="https://github.com/xaldew">Gustaf Waldemarson</a>
</li>
  <li class="minus">Ingo Wald
</li>
  <li class="minus">Jason Stone
</li>
  <li class="minus"><a href="https://github.com/JC-ProgJava">JC-ProgJava</a>
</li>
  <li class="minus">Jean Buckley
</li>
  <li class="minus">Joey Cho
</li>
  <li class="minus"><a href="https://github.com/rjkilpatrick">John Kilpatrick</a>
</li>
  <li class="minus"><a href="https://github.com/D-K-E">Kaan Eraslan</a>
</li>
  <li class="minus"><a href="https://github.com/lmancini">Lorenzo Mancini</a>
</li>
  <li class="minus"><a href="https://github.com/manas96">Manas Kale</a>
</li>
  <li class="minus">Marcus Ottosson
</li>
  <li class="minus"><a href="https://github.com/mrmcsoftware">Mark Craig</a>
</li>
  <li class="minus">Matthew Heimlich
</li>
  <li class="minus">Nakata Daisuke
</li>
  <li class="minus">Paul Melis
</li>
  <li class="minus">Phil Cristensen
</li>
  <li class="minus"><a href="https://github.com/LollipopFt">LollipopFt</a>
</li>
  <li class="minus"><a href="https://github.com/ronaldfw">Ronald Wotzlaw</a>
</li>
  <li class="minus"><a href="https://github.com/shaunplee">Shaun P. Lee</a>
</li>
  <li class="minus"><a href="https://github.com/estshorter">Shota Kawajiri</a>
</li>
  <li class="minus">Tatsuya Ogawa
</li>
  <li class="minus">Thiago Ize
</li>
  <li class="minus">Vahan Sosoyan
</li>
  <li class="minus"><a href="https://github.com/ymherklotz">Yann Herklotz</a>
</li>
  <li class="minus"><a href="https://github.com/oxine">ZeHao Chen</a></li></ul>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="credit-list"> <strong class="asterisk">Special Thanks</strong>

<p></p><p>

  </p><div class="indented">
  Thanks to the team at <a href="https://limnu.com/">Limnu</a> for help on the figures.

<p></p><p>

  These books are entirely written in Morgan McGuire's fantastic and free
  <a href="https://casual-effects.com/markdeep/">Markdeep</a> library. To see what this looks like, view the
  page source from your browser.

</p><p>

  Thanks to <a href="https://github.com/hhu">Helen Hu</a> for graciously donating her
  <a href="https://github.com/RayTracing/" class="url">https://github.com/RayTracing/</a> GitHub organization to this project.

</p><p>

  </p></div>
</div>

<p></p><p>

<link rel="stylesheet" href="./Ray Tracing_ The Next Week_files/book.css">

</p>
<a class="target" name="citingthisbook">&nbsp;</a><a class="target" name="citingthisbook">&nbsp;</a><a class="target" name="toc12">&nbsp;</a><h1>Citing This Book</h1>
<p>

Consistent citations make it easier to identify the source, location and versions of this work. If
you are citing this book, we ask that you try to use one of the following forms if possible.

</p>
<a class="target" name="basicdata">&nbsp;</a><a class="target" name="citingthisbook/basicdata">&nbsp;</a><a class="target" name="toc12.1">&nbsp;</a><h2>Basic Data</h2>
<p>


</p><ul>
  <li class="minus"><strong class="asterisk">Title (series)</strong>: “Ray Tracing in One Weekend Series”
</li>
  <li class="minus"><strong class="asterisk">Title (book)</strong>: “Ray Tracing: The Next Week”
</li>
  <li class="minus"><strong class="asterisk">Author</strong>: Peter Shirley, Trevor David Black, Steve Hollasch
</li>
  <li class="minus"><strong class="asterisk">Version/Edition</strong>: v4.0.0-alpha.1
</li>
  <li class="minus"><strong class="asterisk">Date</strong>: 2023-08-06
</li>
  <li class="minus"><strong class="asterisk">URL (series)</strong>: <a href="https://raytracing.github.io/" class="url">https://raytracing.github.io/</a>
</li>
  <li class="minus"><strong class="asterisk">URL (book)</strong>: <a href="https://raytracing.github.io/books/RayTracingTheNextWeek.html" class="url">https://raytracing.github.io/books/RayTracingTheNextWeek.html</a></li></ul>

<p></p>
<a class="target" name="snippets">&nbsp;</a><a class="target" name="citingthisbook/snippets">&nbsp;</a><a class="target" name="toc12.2">&nbsp;</a><h2>Snippets</h2>

<a class="target" name="markdown">&nbsp;</a><a class="target" name="citingthisbook/snippets/markdown">&nbsp;</a><a class="target" name="toc12.2.1">&nbsp;</a><h3>Markdown</h3>
<pre class="listing tilde"><code><span class="line"></span>[<span class="hljs-meta">_Ray Tracing: The Next Week_</span>](https:<span class="hljs-comment">//raytracing.github.io/books/RayTracingTheNextWeek.html)</span></code></pre>
<a class="target" name="html">&nbsp;</a><a class="target" name="citingthisbook/snippets/html">&nbsp;</a><a class="target" name="toc12.2.2">&nbsp;</a><h3>HTML</h3>
<pre class="listing tilde"><code><span class="line"></span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://raytracing.github.io/books/RayTracingTheNextWeek.html"</span>&gt;</span>
<span class="line"></span>    <span class="hljs-tag">&lt;<span class="hljs-name">cite</span>&gt;</span>Ray Tracing: The Next Week<span class="hljs-tag">&lt;/<span class="hljs-name">cite</span>&gt;</span>
<span class="line"></span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></code></pre>
<a class="target" name="latexandbibtex">&nbsp;</a><a class="target" name="citingthisbook/snippets/latexandbibtex">&nbsp;</a><a class="target" name="toc12.2.3">&nbsp;</a><h3>LaTeX and BibTex</h3>
<pre class="listing tilde"><code><span class="line"></span>~\cite{Shirley2023RTW2}
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">@misc</span>{Shirley2023RTW2,
<span class="line"></span>   title = {Ray Tracing: The Next Week},
<span class="line"></span>   author = {Peter Shirley, Trevor David Black, Steve Hollasch},
<span class="line"></span>   year = {<span class="hljs-number">2023</span>},
<span class="line"></span>   month = {August},
<span class="line"></span>   note = {\small \texttt{https:<span class="hljs-comment">//raytracing.github.io/books/RayTracingTheNextWeek.html}},</span>
<span class="line"></span>   url = {https:<span class="hljs-comment">//raytracing.github.io/books/RayTracingTheNextWeek.html}</span>
<span class="line"></span>}</code></pre>
<a class="target" name="biblatex">&nbsp;</a><a class="target" name="citingthisbook/snippets/biblatex">&nbsp;</a><a class="target" name="toc12.2.4">&nbsp;</a><h3>BibLaTeX</h3>
<pre class="listing tilde"><code><span class="line"></span>\usepackage{biblatex}
<span class="line"></span>
<span class="line"></span>~\cite{Shirley2023RTW2}
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">@online</span>{Shirley2023RTW2,
<span class="line"></span>   title = {Ray Tracing: The Next Week},
<span class="line"></span>   author = {Peter Shirley, Trevor David Black, Steve Hollasch},
<span class="line"></span>   year = {<span class="hljs-number">2023</span>},
<span class="line"></span>   month = {August},
<span class="line"></span>   url = {https:<span class="hljs-comment">//raytracing.github.io/books/RayTracingTheNextWeek.html}</span>
<span class="line"></span>}</code></pre>
<a class="target" name="ieee">&nbsp;</a><a class="target" name="citingthisbook/snippets/ieee">&nbsp;</a><a class="target" name="toc12.2.5">&nbsp;</a><h3>IEEE</h3>
<pre class="listing tilde"><code><span class="line"></span>“Ray Tracing: The Next Week.” raytracing.github.io/books/RayTracingTheNextWeek.html
<span class="line"></span>(accessed MMM. DD, YYYY)</code></pre>
<a class="target" name="mla:">&nbsp;</a><a class="target" name="citingthisbook/snippets/mla:">&nbsp;</a><a class="target" name="toc12.2.6">&nbsp;</a><h3>MLA:</h3>
<pre class="listing tilde"><code><span class="line"></span>Ray Tracing: The Next Week. raytracing.github.io/books/RayTracingTheNextWeek.html
<span class="line"></span>Accessed DD MMM. YYYY.</code></pre><p>











<link rel="stylesheet" href="./Ray Tracing_ The Next Week_files/book.css">

</p><p>

</p></span><div id="mdContextMenu" style="visibility:hidden"></div><div class="markdeepFooter"><i>formatted by <a href="https://casual-effects.com/markdeep" style="color:#999">Markdeep&nbsp;1.15&nbsp;&nbsp;</a></i><div style="display:inline-block;font-size:13px;font-family:&#39;Times New Roman&#39;,serif;vertical-align:middle;transform:translate(-3px,-1px)rotate(135deg);">✒</div></div><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; min-width: 0px; max-width: none; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Main-italic, sans-serif;"></div></div></body></html>